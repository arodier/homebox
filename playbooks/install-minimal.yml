---

## Main installation playbook

- name: Install Homebox
  hosts: homebox
  vars_files:
    - '{{ playbook_dir }}/../config/system.yml'
    - '{{ playbook_dir }}/../config/defaults.yml'
  roles:
    - role: load-defaults
      tags: always
    - role: external-ip-type
      tags: always
    - role: bootstrap
      tags: always
    - role: firewall
      tags: firewall
    - role: nginx
      tags: nginx
    - role: dns-server-pdns
      tags: pdns
    - role: dns-check-propagation
      tags: dns
    - role: certificates
      tags: cert
    - role: ldap
      tags: ldap
    - role: user-setup
      tags: user
    - role: rspamd
      when: mail.antispam.active
      tags: rspamd
    - role: clamav
      when: mail.antivirus.active
      tags: clamav
    - role: opendkim
      tags: dkim
    - role: opendmarc
      tags: dmarc
    - role: postfix
      tags: postfix
    - role: mta-sts
      tags: mta-sts
    - role: dovecot
      tags: dovecot
    - role: autodiscover
      when: mail.autodiscover
      tags: autodiscover
    - role: autoconfig
      when: mail.autoconfig
      tags: autoconfig
    - role: system-post-install
      tags: post-install
