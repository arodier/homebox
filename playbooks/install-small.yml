---

## Main installation playbook

- name: Install Homebox (Small version)
  hosts: homebox
  vars:
    backup_folder: '{{ playbook_dir }}/../backup/{{ network.domain }}/'
  vars_files:
    - '{{ playbook_dir }}/../config/system.yml'
    - '{{ playbook_dir }}/../config/defaults.yml'
  roles:
    - role: common-init
      tags: always
    - role: bootstrap
      tags: always
    - role: firewall
      tags: firewall
    - role: dns-pdns
      tags: dns
    - role: certificates
      tags: cert
    - role: ldap-openldap
      tags: ldap
    - role: user-setup
      tags: user
    - role: nginx
      tags: nginx
    - role: rspamd
      tags: rspamd
    - role: opendkim
      tags: dkim
    - role: opendmarc
      tags: dmarc
    - role: mta-sts
      tags: mta-sts
    - role: postfix
      tags: postfix
    - role: dovecot
      tags: dovecot
    - role: autoconfig
      tags: autoconfig
    - role: prometheus
      tags: prometheus
    - role: post-install
      tags: post-install
