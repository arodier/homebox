<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="André Rodier">
  
  <title>Firewall configuration - homebox installation</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link href="../css/extra.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Firewall configuration";
    var mkdocs_page_input_path = "firewall-configuration.md";
    var mkdocs_page_url = "/firewall-configuration/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> homebox installation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../features/">Features</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../prerequisites/">Before the installation</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../preseed/">Debian OS installation</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../installation/">Homebox Installation</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../email-configuration/">Email configuration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../webmail-roundcube/">Roundcube Webmail</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../groupware-sogo/">Sogo Groupware</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../email-access-monitoring/">Email access monitoring</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../antispam-rspamd/">Antispam configuration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../jabber-configuration/">Jabber configuration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../gogs-configuration/">Gogs configuration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../tor-privoxy-configuration/">Tor / privoxy configuration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Firewall configuration</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#default-firewall-configuration">Default firewall configuration</a></li>
                
            
                <li class="toctree-l3"><a href="#single-packet-authorization">Single Packet Authorization</a></li>
                
                    <li><a class="toctree-l4" href="#configuration-examples">Configuration examples</a></li>
                
                    <li><a class="toctree-l4" href="#keys-backup">Keys backup</a></li>
                
                    <li><a class="toctree-l4" href="#knocking-your-server">Knocking your server</a></li>
                
                    <li><a class="toctree-l4" href="#advanced">Advanced</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../security-configuration/">Security configuration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../transmission-configuration/">Transmission configuration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../bind-configuration/">DNS Server configuration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../external-accounts/">External accounts</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../backup-home/">Backup your home folders</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../backup-restore/">Backup restoration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../deployment-backup/">Backup your deployment</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../backup-server/">Backup server</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../zabbix/">Monitoring with Zabbix</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../maintenance/">Maintenance</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../development/">Testing and development</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../codeofconduct/">Code of conduct</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">homebox installation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Firewall configuration</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/progmaticltd/homebox/" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="default-firewall-configuration">Default firewall configuration</h1>
<div class="codehilite"><pre><span></span><span class="c1">###############################################################################</span>
<span class="c1"># Once the system is in place, it is possible to use &#39;limit&#39; for the rule,</span>
<span class="c1"># instead of allow. It is also possible to use fail2ban, which is installed anyway</span>
<span class="c1"># You can have as many sources as you want, with a comment to easily keep track</span>
<span class="c1"># of your rules</span>
<span class="l l-Scalar l-Scalar-Plain">firewall</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">fwknop</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">install</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">random</span>
  <span class="l l-Scalar l-Scalar-Plain">ssh</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">src</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">any</span>
      <span class="l l-Scalar l-Scalar-Plain">rule</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">allow</span>
      <span class="l l-Scalar l-Scalar-Plain">comment</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">allow SSH from anywhere</span>
  <span class="l l-Scalar l-Scalar-Plain">output</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">policy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">deny</span>
    <span class="l l-Scalar l-Scalar-Plain">rules</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dest</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">any</span>
        <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80,443</span>
        <span class="l l-Scalar l-Scalar-Plain">comment</span><span class="p p-Indicator">:</span> <span class="s">&#39;Allow</span><span class="nv"> </span><span class="s">web</span><span class="nv"> </span><span class="s">access&#39;</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dest</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">any</span>
        <span class="l l-Scalar l-Scalar-Plain">proto</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">udp</span>
        <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">53</span>
        <span class="l l-Scalar l-Scalar-Plain">comment</span><span class="p p-Indicator">:</span> <span class="s">&#39;Allow</span><span class="nv"> </span><span class="s">DNS</span><span class="nv"> </span><span class="s">requests&#39;</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dest</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">any</span>
        <span class="l l-Scalar l-Scalar-Plain">proto</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">udp</span>
        <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">123</span>
        <span class="l l-Scalar l-Scalar-Plain">comment</span><span class="p p-Indicator">:</span> <span class="s">&#39;Allow</span><span class="nv"> </span><span class="s">NTP</span><span class="nv"> </span><span class="s">requests&#39;</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dest</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">any</span>
        <span class="l l-Scalar l-Scalar-Plain">proto</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">udp</span>
        <span class="l l-Scalar l-Scalar-Plain">from_port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">68</span>
        <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">67</span>
        <span class="l l-Scalar l-Scalar-Plain">comment</span><span class="p p-Indicator">:</span> <span class="s">&#39;Allow</span><span class="nv"> </span><span class="s">DHCP</span><span class="nv"> </span><span class="s">requests&#39;</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dest</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">any</span>
        <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">25</span>
        <span class="l l-Scalar l-Scalar-Plain">comment</span><span class="p p-Indicator">:</span> <span class="s">&#39;Allow</span><span class="nv"> </span><span class="s">SMTP</span><span class="nv"> </span><span class="s">connections</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">servers&#39;</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">dest</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">any</span>
        <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">110,995,143,993</span>
        <span class="l l-Scalar l-Scalar-Plain">comment</span><span class="p p-Indicator">:</span> <span class="s">&#39;Allow</span><span class="nv"> </span><span class="s">the</span><span class="nv"> </span><span class="s">retrieval</span><span class="nv"> </span><span class="s">of</span><span class="nv"> </span><span class="s">emails</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">other</span><span class="nv"> </span><span class="s">servers</span><span class="nv"> </span><span class="s">(POP/IMAP)&#39;</span>
</pre></div>


<h1 id="single-packet-authorization">Single Packet Authorization</h1>
<p>This method of authorization is based around a default-drop packet filter and libpcap. SPA is essentially next
generation port knocking.</p>
<p>The fwknop client runs on Linux, Mac OS X, *BSD, and Windows.  In addition, there is a port of the client to both the
iPhone and Android phones.</p>
<ul>
<li>Supports HMAC authenticated encryption for both Rijndael and GnuPG. The order of operation is
  encrypt-then-authenticate to avoid various cryptanalytic problems.</li>
<li>Replay attacks are detected and thwarted by SHA-256 digest comparison of valid incoming SPA packets. SHA-1 and MD5 are
  also supported, but SHA-256 is the default.</li>
<li>SPA packets are passively sniffed from the wire via libpcap. The fwknop server can also acquire packet data from a
  file that is written to by a separate Ethernet sniffer (such as with &ldquo;tcpdump -w &lt;file>&ldquo;), or from the iptables ULOG
  pcap writer.</li>
<li>For iptables firewalls, ACCEPT rules added by fwknop are added and deleted (after a configurable timeout) from custom
  iptables chains so that fwknop does not interfere with any existing iptables policy.</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you don’t know what are you doing, be very careful, because one mistake will cause your SSH gone for good and
there will no chance how to manage your server.</p>
</div>
<p>More features detailed on the <a href="https://www.cipherdyne.org/fwknop/docs/features.html">fwknop features page</a>.</p>
<h2 id="configuration-examples">Configuration examples</h2>
<p>Alow direct SSH access from the local network, use fwknop otherwise. Monitor only queries sent to port number 33001.</p>
<div class="codehilite"><pre><span></span><span class="c1"># Allow SSH only from the LAN, otherwise use fwknop</span>
<span class="l l-Scalar l-Scalar-Plain">firewall</span><span class="p p-Indicator">:</span>
<span class="hll">  <span class="l l-Scalar l-Scalar-Plain">fwknop</span><span class="p p-Indicator">:</span>
</span><span class="hll">    <span class="l l-Scalar l-Scalar-Plain">install</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span class="hll">    <span class="l l-Scalar l-Scalar-Plain">nic</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">enp3s0</span>
</span><span class="hll">    <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">33001</span>
</span>  <span class="l l-Scalar l-Scalar-Plain">ssh</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">src</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.42.0/24</span>
      <span class="l l-Scalar l-Scalar-Plain">rule</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">allow</span>
      <span class="l l-Scalar l-Scalar-Plain">comment</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">allow SSH from the LAN only</span>
</pre></div>


<p>Only allow SSH access using fwknop.  Allow to send the query to a random port number, between 10000 and 65535 by
default.</p>
<div class="codehilite"><pre><span></span><span class="c1"># Allow SSH only from the LAN, otherwise use spa fwknopd</span>
<span class="l l-Scalar l-Scalar-Plain">firewall</span><span class="p p-Indicator">:</span>
<span class="hll">  <span class="l l-Scalar l-Scalar-Plain">fwknop</span><span class="p p-Indicator">:</span>
</span><span class="hll">    <span class="l l-Scalar l-Scalar-Plain">install</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span class="hll">    <span class="l l-Scalar l-Scalar-Plain">nic</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">eth0</span>
</span>  <span class="l l-Scalar l-Scalar-Plain">ssh</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">src</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">any</span>
      <span class="l l-Scalar l-Scalar-Plain">rule</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">deny</span>
      <span class="l l-Scalar l-Scalar-Plain">comment</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Do not allow SSH access except with fwknop</span>
</pre></div>


<h3 id="default-configuration">Default configuration</h3>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">firewall_default</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">fwknop</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">install</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="l l-Scalar l-Scalar-Plain">nic</span><span class="p p-Indicator">:</span> <span class="s">&#39;{{</span><span class="nv"> </span><span class="s">ansible_default_ipv4.interface</span><span class="nv"> </span><span class="s">}}&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">random</span>
  <span class="l l-Scalar l-Scalar-Plain">ssh</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">src</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">any</span>
      <span class="l l-Scalar l-Scalar-Plain">rule</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">allow</span>
      <span class="l l-Scalar l-Scalar-Plain">comment</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">allow SSH from anywhere</span>
</pre></div>


<h2 id="keys-backup">Keys backup</h2>
<p>When running the installation script, fwnkop credentials are stored in
your home folder, in a file named after your domain, like ~/.fwknop-main.<domain>.rc,
(e.g. ~/.fwknop-main.homebox.space.rc.)
A backup is copied in your installation backup folder, <code>fwknop/fwknoprc</code>.</p>
<p>Here an example:</p>
<div class="codehilite"><pre><span></span><span class="k">[default]</span>

<span class="k">[main.homebox.space]</span>
<span class="na">ACCESS                      tcp/22</span>
<span class="na">SPA_SERVER                  main.homebox.space</span>
<span class="na">KEY_BASE64                  TD/Tudvg9IIdS8DYAxDFYYqL6qlRR7N0F7PSWb6QSqo</span><span class="o">=</span>
<span class="na">HMAC_KEY_BASE64             mf1D7dIf2mMqgvnmeB8EosVDIEMlbHqJ1oKnW4TMmVWh4G7LHBbNzkBDvI+vw3f7TtdJYkYEjpc3JrHgA0QXYw</span><span class="o">=</span><span class="s">=</span>
<span class="na">USE_HMAC                    Y</span>
</pre></div>


<h2 id="knocking-your-server">Knocking your server</h2>
<h3 id="on-linux">On Linux</h3>
<p>Accessing your server, from the LAN or outside is slighly different</p>
<p>From the LAN, you can specify local IP address, here 192.168.66.33,
and the remote IP address, 192.168.66.1. For instance:</p>
<div class="codehilite"><pre><span></span>fwknop -v --rc-file ~/.fwknop-homebox.space.rc -a <span class="m">192</span>.168.66.33 -n main.homebox.space -D <span class="m">192</span>.168.66.1
ssh <span class="m">192</span>.168.66.1
</pre></div>


<p>From outside, you can use the automatic IP address lookup of www.cipherdyne.org:</p>
<div class="codehilite"><pre><span></span>fwknop -v --rc-file ~/.fwknop-homebox.space.rc -R --wget-cmd /usr/bin/wget -n main.homebox.space
ssh main.homebox.space
</pre></div>


<h3 id="on-android">On Android</h3>
<p>You can also ‘knock’ your server from Android, using the excellent
<a href="https://play.google.com/store/apps/details?id=org.cipherdyne.fwknop2">fwknop2 package</a>.</p>
<p>The configuration is simple, see the example: <a href="../img/fwknop/android-client.png">android client example</a></p>
<h2 id="advanced">Advanced</h2>
<h3 id="automatically-knocking-your-server-before-connecting">Automatically knocking your server before connecting</h3>
<p>While you can do this with a script, it is nicer to use the SSH ProxyCommand integration.
For instance, you can use this configuration on your <code>~/.ssh/config</code>:</p>
<div class="codehilite"><pre><span></span>Host homebox.space
  User root
  ProxyCommand sh -c &quot;fwknop -R -D main.homebox.space --rc-file ~/.fwknop-homebox.space.rc -n main.homebox.space ; /bin/nc %h %p&quot;
</pre></div>


<h3 id="using-the-port-knoker-with-ansible">Using the port knoker with Ansible</h3>
<p>It is possible to use fwknop during the development phase.
In this case, you should use fwknop client to knock the server, before the SSH connection.</p>
<p>Hopefully, homebox comes with a fwknop connection plugin for Ansible, ready to use.
There are two modifications to make:</p>
<p>The host file, specify the fwknop parameters:</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">all</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">hosts</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">homebox</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">ansible_host</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">homebox.example.home</span>
      <span class="l l-Scalar l-Scalar-Plain">ansible_user</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
      <span class="l l-Scalar l-Scalar-Plain">ansible_port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">22</span>
      <span class="c1"># special parameters when using fwknop port knocking</span>
      <span class="l l-Scalar l-Scalar-Plain">fwknop_src</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">192.168.14.55</span>   <span class="c1"># or &#39;auto&#39; when connecting to a remote host over internet.</span>
      <span class="l l-Scalar l-Scalar-Plain">fwknop_config_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">main.example.home</span>
      <span class="l l-Scalar l-Scalar-Plain">fwknop_dest</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">main.example.home</span>
      <span class="l l-Scalar l-Scalar-Plain">fwknop_rc_file</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">/home/andre/.fwknop-example.home.rc</span>
      <span class="l l-Scalar l-Scalar-Plain">fwknop_verbose</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>


<p>See the file <code>config/hosts-fwknop-example.yml</code> for a complete list of possible options.</p>
<p>Then, when running ansible, use the <code>-c</code> parameter to specify the connection method, and use ‘ssh_fwknop’.
The source code is in <code>common/connection_plugins</code>.</p>
<div class="codehilite"><pre><span></span>ansible-playbook -c ssh_fwknop -vvv -i ../config/hosts.yml playbooks/fwknop-server.yml
</pre></div>


<p>With the following output, for instance:</p>
<div class="codehilite"><pre><span></span>$ ansible-playbook -c ssh_fwknop -vvv -i ../config/hosts.yml playbooks/fwknop-server.yml
ansible-playbook <span class="m">2</span>.6.3
  config <span class="nv">file</span> <span class="o">=</span> /home/andre/Projects/homebox/install/ansible.cfg
  configured module search <span class="nv">path</span> <span class="o">=</span> <span class="o">[</span>u<span class="s1">&#39;/home/andre/.ansible/plugins/modules&#39;</span>, u<span class="s1">&#39;/usr/share/ansible/plugins/modules&#39;</span><span class="o">]</span>
  ansible python module <span class="nv">location</span> <span class="o">=</span> /usr/lib/python2.7/dist-packages/ansible
  executable <span class="nv">location</span> <span class="o">=</span> /usr/bin/ansible-playbook
  python <span class="nv">version</span> <span class="o">=</span> <span class="m">2</span>.7.13 <span class="o">(</span>default, Sep <span class="m">26</span> <span class="m">2018</span>, <span class="m">18</span>:42:22<span class="o">)</span> <span class="o">[</span>GCC <span class="m">6</span>.3.0 <span class="m">20170516</span><span class="o">]</span>
Using /home/andre/Projects/homebox/install/ansible.cfg as config file
Parsed /home/andre/Projects/homebox/config/hosts.yml inventory <span class="nb">source</span> with yaml plugin
Read vars_file <span class="s1">&#39;{{ playbook_dir }}/../../config/system.yml&#39;</span>
Read vars_file <span class="s1">&#39;{{ playbook_dir }}/../../config/defaults.yml&#39;</span>

PLAYBOOK: fwknop-server.yml ********************************
<span class="m">1</span> plays in playbooks/fwknop-server.yml
Read vars_file <span class="s1">&#39;{{ playbook_dir }}/../../config/system.yml&#39;</span>
Read vars_file <span class="s1">&#39;{{ playbook_dir }}/../../config/defaults.yml&#39;</span>

PLAY <span class="o">[</span>homebox<span class="o">]</span> *********************************************
Read vars_file <span class="s1">&#39;{{ playbook_dir }}/../../config/system.yml&#39;</span>
Read vars_file <span class="s1">&#39;{{ playbook_dir }}/../../config/defaults.yml&#39;</span>

TASK <span class="o">[</span>Gathering Facts<span class="o">]</span> *************************************
task path: /home/andre/Projects/homebox/install/playbooks/fwknop-server.yml:4
&lt;<span class="m">192</span>.168.63.100&gt; ssh_fwknop connection plugin is used <span class="k">for</span> this host
Running <span class="err">&#39;</span>/usr/bin/fwknop -v -a <span class="m">192</span>.168.64.55 -D main.homebox.space --rc-file /home/andre/.fwknop-homebox.space.rc -n main.homebox.space
SPA Field Values:
<span class="o">=================</span>
   Random Value: <span class="m">4839788853776469</span>
       Username: andre
      Timestamp: <span class="m">1540127737</span>
    FKO Version: <span class="m">3</span>.0.0
   Message Type: <span class="m">1</span> <span class="o">(</span>Access msg<span class="o">)</span>
 Message String: <span class="m">192</span>.168.64.55,tcp/22
     Nat Access: &lt;NULL&gt;
    Server Auth: &lt;NULL&gt;
 Client Timeout: <span class="m">0</span>
    Digest Type: <span class="m">3</span> <span class="o">(</span>SHA256<span class="o">)</span>
      HMAC Type: <span class="m">3</span> <span class="o">(</span>SHA256<span class="o">)</span>
Encryption Type: <span class="m">1</span> <span class="o">(</span>Rijndael<span class="o">)</span>
Encryption Mode: <span class="m">2</span> <span class="o">(</span>CBC<span class="o">)</span>
...
</pre></div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../security-configuration/" class="btn btn-neutral float-right" title="Security configuration">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../tor-privoxy-configuration/" class="btn btn-neutral" title="Tor / privoxy configuration"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Creative Commons Attribution-ShareAlike 4.0 International License</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/progmaticltd/homebox/" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../tor-privoxy-configuration/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../security-configuration/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
