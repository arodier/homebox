{
    "docs": [
        {
            "location": "/",
            "text": "This is the home documentation for \u201cHomebox\u201d, and set if Ansible scripts to deploy\na fully functional \nand\n secure mail server at home or online.\n\n\nThe source code is on \nGitHub\n.\n\n\nThis project is for you if:\n\n\n\n\nYou are interested to host your emails yourself, for privacy, security or any other reason.\n\n\nYou want your server to be secure against both physical and remote intrusion.\n\n\nYou want a low maintanance box that keep itself updated automatically.\n\n\nYou prefer security and stability over latest features.\n\n\nYou trust the Debian community to push security updates.\n\n\n\n\nPhilosophy\n\n\n\n\nYou should be able to upgrade anything installed via apt command. No git clone / wget / curl here, ever.\n\n\nIf you are using your own hardware, the disk will be fully encrypted using\n  \nLUKS\n. Nobody will be able to steal your hardware \nand\n your\n  information.\n\n\nAppArmor is activated on the first boot, and all the services are configured to support it. This makes your server\n  very safe against remote intrusion, even when using 0-day vulnerabilities.\n\n\nYou can set up multiple backup destination, local and remote, all encrypted.\n\n\nA lot of default choices made towards simplicity and \nKISS principle\n.\n  and safety.\n\n\nAttention to details, keep focused on the nitty-gritty features of self hosting, like full IPv6 support.\n\n\n\n\nMain components\n\n\n\n\nOperating System: Debian Stretch (stable)\n\n\nAuthentication: OpenLDAP\n\n\nMail transfer agent: Postfix\n\n\nMail delivery agent: Dovecot\n\n\nMonitoring: Zabbix\n\n\nAntispam: RSpamd\n\n\nAntivirus: ClamAV\n\n\nWebmail: RoundCube\n\n\nGroupware: Sogo\n\n\nJabber: ejabberd\n\n\nDNS: bind9\n\n\nGit server: gogs\n\n\nBittorrent station: transmission\n\n\nProxy: Privoxy / Tor\n\n\nBackup: Borgbackup\n\n\n\n\nOther projects to mention\n\n\nIf you are interested in self-hosting, you will find a lot of\ninteresting projects on internet, for instance:\n\n\n\n\nSovereign\n: A different\n  target, but a similar deployment approach using Ansible.\n\n\nyunohost\n: Contains a lot of plugins and\n  features, not all of them are stable, but it is worth testing.\n\n\nmailinabox\n, more oriented to online\n  hosting, but very good as well.\n\n\nand many\u2026\n\n\n\n\nAll have plenty of features, but maybe a different approach to\nself-hosting, though.",
            "title": "Home"
        },
        {
            "location": "/#philosophy",
            "text": "You should be able to upgrade anything installed via apt command. No git clone / wget / curl here, ever.  If you are using your own hardware, the disk will be fully encrypted using\n   LUKS . Nobody will be able to steal your hardware  and  your\n  information.  AppArmor is activated on the first boot, and all the services are configured to support it. This makes your server\n  very safe against remote intrusion, even when using 0-day vulnerabilities.  You can set up multiple backup destination, local and remote, all encrypted.  A lot of default choices made towards simplicity and  KISS principle .\n  and safety.  Attention to details, keep focused on the nitty-gritty features of self hosting, like full IPv6 support.",
            "title": "Philosophy"
        },
        {
            "location": "/#main-components",
            "text": "Operating System: Debian Stretch (stable)  Authentication: OpenLDAP  Mail transfer agent: Postfix  Mail delivery agent: Dovecot  Monitoring: Zabbix  Antispam: RSpamd  Antivirus: ClamAV  Webmail: RoundCube  Groupware: Sogo  Jabber: ejabberd  DNS: bind9  Git server: gogs  Bittorrent station: transmission  Proxy: Privoxy / Tor  Backup: Borgbackup",
            "title": "Main components"
        },
        {
            "location": "/#other-projects-to-mention",
            "text": "If you are interested in self-hosting, you will find a lot of\ninteresting projects on internet, for instance:   Sovereign : A different\n  target, but a similar deployment approach using Ansible.  yunohost : Contains a lot of plugins and\n  features, not all of them are stable, but it is worth testing.  mailinabox , more oriented to online\n  hosting, but very good as well.  and many\u2026   All have plenty of features, but maybe a different approach to\nself-hosting, though.",
            "title": "Other projects to mention"
        },
        {
            "location": "/features/",
            "text": "Backup and disaster recovery\n\n\nDebian ISO image builder\n\n\nYou can generate an ISO image to install Debian on your server, using a simple configuration file in YAML format.\n\n\nThis will make a quick re-installation disk for the system. It will configure for you full disk encryption and\n\nAppArmor\n support straight on the first boot. It is not made to install the software stack, that need to be deployed\nwith Ansible, from a remote workstation. Although it might be possible to integrate the deployment scripts into the ISO\nimage.\n\n\nBecause this feature can be useful to other projects, a dedicated project has been created on\n\ngithub\n.\n\n\nMultiple encrypted backups\n\n\nYou can setup multiple backups for your user\u2019s home folders, remote or local, with multiple frequencies as well. For\ninstance, one daily backup on your NAS using a Samba share, and a weekly backup on a remote server using SSH. All the\nbackups are encrypted and managed by the excellent \nborgbackup\n package. A \nsummary email\n is\nsent at the end of the backup process. If you have opted for the Jabber installation, a short message is sent as well,\nnotifying you of the job completion.\n\n\nDisaster recovery\n\n\nWhen you are deploying the system for the first time, all the information generated is saved on the deployment\nworkstation. This gives you a way to re-install your system from scratch, without loosing any information.\n\n\nIf you have specified an external backup location, for instance on a remote server through SSH or on Amazon S3, all your\nemails, address books and calendars will be automatically restored from the backup location of your choice.\n\n\nSecurity\n\n\nFull disk encryption\n\n\nWhen you are using the ISO image builder to install Debian, the server disk will be fully encrypted using LUKS, with the\npassphrase specified in a configuration file.\n\n\nThis make your server fully secure against physical intrusion, even if your hardware is lost or stolen.\n\n\nYou do not have to plug a screen and a keyboard to unlock your server. Once it is booted, the server starts a small SSH\nserver to connect, and let you enter the passphrase.\n\n\n\n\nNote\n\n\nThe SSH server started on boot share the same public key with OpenSSH. Therefore, you will not have the usual SSH\nwarnings staying the signature has changed.\n\n\n\n\n\n\nTip\n\n\nIt is also possible to use a \nYubikey\n, with or without a passphrase, to decrypt your drive. In\nthis case, a safe script to enroll your key is provided.\n\n\n\n\nAppArmor enforcement\n\n\nAll the daemons are carefully configured with an AppArmor profile, in enforce mode. This protects you against remote\nintrusion and 0-day vulnerabilities as well.\n\n\nFail2ban integration\n\n\nFail2ban is integrated and configured, to automatically blacklist IP addresses used by spammers to attack your\nserver. It makes this kind of attacks inefficient, and saves your bandwidth too. The duration of jail is customisable for\njabber and email services.\n\n\nLDAP Authentication\n\n\nOne password per user, for all the services. All the user accounts are saved in the LDAP database, using the OpenLDAP\npackage in Debian. A dedicated SSL certificate is created during the installation, allowing secure SSL and TLS\ncommunication with the server.\n\n\nPassword policies\n\n\nPassword complexity is enforced using the \npwquality module\n. You\ncan specify minimum length, mandatory characters like symbols and a mix of lowercase / uppercase letters. You can also\nremember the last passwords for each users, avoiding them to re-use the same passwords or use a password too similar\nthan the previous ones.\n\n\nAutomatic security update\n\n\nOnce your system is installed, any security update will be installed in background, without you having to do\nanything. This is set using the \nDebian unattended upgrades\n package.  If\nyou prefer to install security updates yourself, you can disable this behaviour in your system.yml file.\n\n\nOnly the security updates are installed, new packages versions still need to be installed manually.\n\n\nMonitoring\n\n\nThe installer can deploy a complete monitoring solution, \nZabbix\n.\n\n\n\n\nYou can set up email or XMPP alerts, on various events.\n\n\nYou can add other servers / machines to your monitoring server.\n\n\nYou can set-up SMS alerts if, for instance, your internet connection goes down.\n\n\n\n\nBy default, the guest account is deleted, and a strong password is generated.\n\n\nHigh profiles for SSL / HTTPS\n\n\nAll HTTPS sites are configured to use \nHSTS\n.  For nginx\nand dovecot, a 2048 Diffie-Helman parameter file is generated upon installation.  Ranked score A on\n\ngeekflare.com\n and A+ on \nssllabs.com\n.\n\n\nUnusual behaviour detection\n\n\nThis advanced feature is unique amongst both commercial and self-hosted solutions. It is actually restricted to IMAP,\nbut will be extended to other services. It is working by using a \u201cpoints\u201d system, where more points generate warnings or\neven deny the connection.\n\n\nThe following behaviour are detected, from the :\n\n\n\n\nAccess from a blacklisted IP address\n\n\nAccess from an IP address recently blacklisted by fail2ban\n\n\nAccess from a different country than the one the box is hosted\n\n\nAccess outside office hours\n\n\n\n\nAlthough the initial values should be accurate for standard usage, any of the previous checks can be tuned for a\nspecific usage. For instance, it is possible to:\n\n\n\n\nWhitelist / Blacklist countries, globally or per user.\n\n\nWhitelist / Blacklist IP addresses, globally or per user.\n\n\nSet office hours, globally only at this time.\n\n\n\n\nWarning and errors are sent in real time, using XMPP and email to the user and an external email address. Two factors\nauthentication on unusual behaviour will be implemented later, perhaps using google authenticator.\n\n\nEmail features\n\n\nDigital signature\n\n\nA DKIM certificate of 4096 bits is generated during the installation, and the associated public key is published on the\nDNS server. The DKIM key purpose is to mark emails coming from your domain as authentic.\n\n\nThe SPF and DMARC records are generated and published automatically as well. This will guarantee your emails being\nrecognised by other email servers without any problem.\n\n\nInternationalised email aliases\n\n\nYou can add as many email aliases as you want for your user accounts. Moreover, you will be able to add email addresses\nwith internationalised characters, using a standardised LDAP schema. You can then have email addresses like\nandr\u00e9@homebox.space.\n\n\nAddress extension\n\n\nWhen registering on a service, you can use address extensions, to directly receive emails in a specific folder. For\ninstance, emails to \njohn+lists@example.com\n will be directly saved into the \n\u2018lists\u2019\n folder of your IMAP server.\n\n\nEmail folders can be automatically created and subscribed as well, and you can use any character to separate your email\naddress. for instance \u2018:\u2019, \u2018~\u2019, \u2018/\u2019 etc.\n\n\nSieve filtering\n\n\nSieve filtering support, with automatic answering, vacation, regular expression, custom scripts support, etc. The web\ninterface to configure your filters is powerful but easy to use.\n\n\nYou can also access your sieve filters with the \nManageSieve\n protocol, and the \nThunderbird\nextension\n.\n\n\nFor instance, you can automatically:\n\n\n\n\nmove/copy messages to specified folder\n\n\nredirect/copy messages to another account\n\n\ndiscard messages with a specific error message\n\n\nreply automatically, using vacation at specific dates\n\n\ndelete messages\n\n\nsett flags (e.g. flag, mark as read, etc.)\n\n\n\n\nFull text search\n\n\nThe server implements full text search inside your emails \nand\n your attachments.  Full text search is also done inside\nattached archives (zip, rar, etc). The following attachments types are actually recognised:\n\n\n\n\nPDF files.\n\n\nText, XML and HTML files (various encoding)\n\n\nMicrosoft Office documents: doc, docx, xls, xlsx, pptx.\n\n\nLibreOffice/OpenOffice documents: ods, odt, odp, sxw.\n\n\nOther office documents: csv, rtf, gnumeric and abiword files\n\n\nE-Books (epub)\n\n\nAttached emails (eml)\n\n\nArchives: (zip, tar, rar, gzip)\n\n\nOld microsoft archive format: tnef (aka winmail.dat)\n\n\n\n\nArchives are opened recursively, until finding documents to parse.\n\n\nNotes and Limitations:\n\n\n\n\nAlthough encrypted archives cannot be opened, the file list is indexed.\n\n\nPowerpoint files before 2003 (.ppt) are not well supported.\n\n\n\n\nMaster user\n\n\nWhatever you use your email server for a community or a family, you can activate the \u201cimpersonate\u201d function. This\nfunction creates a \u201cmaster\u201d user, with an access to every other user\u2019s mail boxes.\n\n\nThis feature is disabled by default, it is meant to be useful for families with children with an email address or small\ncommunities.\n\n\nHowever, as soon as the master user is accessing someone\u2019s email address, the user receives an alert by XMPP and an\nemail is sent as well.\n\n\nAutomatic client configuration\n\n\nThe server supports \nMozilla Thunderbird\n, \nMicrosoft Outlook\n and other email clients automatic configuration. This\nmakes the life of your users easier. It creates and publish autoconfig.xml, autodiscover.xml and DNS records (\nRFC\n6186\n).\n\n\nAntivirus\n\n\nThe emails received are automatically checked for viruses, and are discarded by default if they are infected. The emails\nsent by your users are checked as well, avoiding your IP address to be blacklisted if one of your account is\ncompromised.\n\n\nYou can also choose to explicitly reject (bounce) emails containing viruses. In all case, the analysis is done after the\nemail queue, making the process non blocking and efficient on small resourced hardware.\n\n\nAntispam with automatic learning\n\n\nThe antispam integrated with the system is very easy to use. The automatic learning is done just by moving emails out or\nin the Junk email folder.\n\n\nIt is powered by rspamd, a pioneered application in term of junk email detection.\n\n\nExternal accounts import\n\n\nYou can add other email accounts (Yahoo, GMail, Outlook.com, etc.). The emails will be automatically downloaded and\nsynchronised when you connect with any client, and will appear in your account.\n\n\nBecause the folders hierarchy will be copied as well, it is possible to migrate from another account very easily.\n\n\nRoundcube Webmail\n\n\nThere are two webmail available. RoundCube, and SOGo.\n\n\nRoundCube, comes with the following plugins / features activated by default:\n\n\n\n\nArchive\n\n\nContext Menu\n\n\nEmoticons\n\n\nSieve Rules management, with vacation, automatic answers, etc\u2026\n\n\nMark as Junk\n\n\nNew mail desktop notification\n\n\nPassword modification\n\n\nIMAP Subscriptions management\n\n\nHotkeys support (Ctrl+Enter to send an email)\n\n\nLog the real client IP address to the mail server\n\n\n\n\nWhen the master user functionality has been activated, the impersonate plugin is also installed, allowing you to inspect\nany user\u2019s emails directly from the webmail.\n\n\nMore plugins can be activated very easily, just by specifying their name in the list of plugins.\n\n\nAutomatic copy to the sent folder\n\n\nYou do not need to configure your mail client to copy emails to the sent folder, this is done automatically for\nyou. This is a lot of time saved, especially when sending big emails with attachments: You don\u2019t need to upload an email\ntwice.\n\n\nEmail access logging\n\n\nEach access to the email server is logged in real time, and contains the following information:\n\n\n\n\nSource IP address\n\n\nCountry\n\n\nChannel (RoundCube, SOGo or IMAP)\n\n\netc\u2026\n\n\n\n\nA monthly report is sent to each user, the first of each month, with a summary of access and some statistics.\n\n\nPrivacy features\n\n\nWhen emails are sent, the user agent (i.e. Thunderbird, Evolution, etc\u2026) version is removed, both for security and\nprivacy.\n\n\nCalendars and address books\n\n\nSOGo groupware\n\n\nIt is also possible to install SOGo, which offer collaborative features, calendaring and address books. There are both\naccessible using respectively CalDAV and CardDAV standards.\n\n\nFeatures of SOGo activated:\n\n\n\n\nSend emails reminder on events\n\n\nVacation messages\n\n\nForward your messages to another email address\n\n\nSieve scripts editor\n\n\nUse the same web interface to access other emails\n\n\nChange your password from the web interface\n\n\n\n\nMore details on the \nSOGo home page\n and on the official \ndocumentation\npage\n.\n\n\nXMPP / Jabber server\n\n\nThe installation script can install an XMPP / Jabber server, by using \nejabberd\n,\na \u201c\nRock Solid, Massively Scalable, Infinitely Extensible XMPP Server\n\u201d.\n\n\nClient to Server\n\n\n\n\nThe authentication is using the LDAP server.\n\n\nGenerate a 2048 bits Diffie-Helman key.\n\n\nEncryption enforcement, at least TLS 1.2.\n\n\nJabber Fail2Ban integration\n\n\nGrade A on \nIM Observatory\n client and server reports.\n\n\nSOCKS5 Bytestreams file transfers with image thumbnails (pidgin, empathy, etc.).\n\n\nOffline file sending using https on a dedicated sub-domain (Android Conversations, etc.).\n\n\nAutomatically add contact (rosters) from the shared directory.\n\n\nVCard generation from the LDAP server.\n\n\nMessage archives on the server, with archive management from the client (MAM).\n\n\nUser avatars are stored on the server.\n\n\nConference / chat rooms between multiple domains.\n\n\n\n\nServer to Server\n\n\nThe installation scripts can also activates server to server communication (aka s2s).  This is optional but activated by\ndefault. It is also possible to restrict access to trusted servers, by specifying a list of domain names you want to\ntrust.\n\n\nSome clients: \nXMPP client software\n.\n\n\nOther features\n\n\nGogs git server\n\n\nYou can optionally install a small, fast and lightweight git server called \ngogs\n. The server is configured\nwith the following features:\n\n\n\n\nHTTPS certificate\n\n\nLDAP authentication\n\n\nAutomatic update\n\n\nTwo factors authentication\n\n\nRepository mirroring\n\n\n\n\nBittorrent download station\n\n\nYou can install the transmission bittorrent daemon, accessible over https on a dedicated domain.\n\n\n\n\nThe web interface and the RPC servers are protected with the LDAP credentials, unless you are at home.\n\n\nDownloaded files can be accessed directly from your web browser, still using the LDAP credentials if you are not at home.\n\n\nThe daemon runs in a proper AppArmor profile.\n\n\nEasy to use form to search downloaded files in your web browser.\n\n\nAutomatic firewall configuration to allow bittorrent both input and output.\n\n\nBlacklist support and automatic update.\n\n\n\n\nPrivoxy server\n\n\nThe platform configures Privoxy with an automatic import of adblock rules from easylist, updated every day. The following rules\nare activated by default:\n\n\n\n\nEasyList\n\n\nEasyPrivacy\n\n\nFanboy\u2019s Annoyance List\n\n\nFanboy\u2019s Social Blocking List\n\n\n\n\nTor server\n\n\nThe platform configures Tor as well, and allows you to ooverride any option. You can also chain privoxy and tor\ntogether.\n\n\nMultiple IP scheme\n\n\nHomebox can be configured with two static IP addresses, with a mix of IPv4 amd IPv6. This is useful if you are using a\nVPN that provides you a static IP address or if you are using 3G / 4G as a backup connection.\n\n\nIPv6 is actually tested on \nvultr.com\n, a provider that supports full IPv6, on virtual\nservers. Digital Ocean does not allows SMTP or Submission on IPv6.\n\n\nDNSSEC Support\n\n\nIf you need a higher level of security and a protection agains DNS cache poisoning, you can activate the DNSSEC\nextensions. Once the playbook has been run, an email is sent to postmaster, with the ZSK (Zone Signing Key) and KSK (Key\nSigning Key) attached.\n\n\nThe server installed is bind9. When activated, the server also publishes\n\nSSHFP\n records for extra security.\n\n\nSingle packet port knocking\n\n\nSPA is essentially next generation port knocking. It is using encryption and HMAC keys, to open your firewall for an SSH\nconnection.\n\n\n\n\nSupports HMAC authenticated encryption for both Rijndael and GnuPG.\n\n\nReplay attacks are detected and thwarted by SHA-256 digest comparison of valid incoming SPA packets.\n\n\n\n\nMore details explained on the \nComprehensive Guide\n.\n\n\nCertificates management\n\n\nAutomatically generate certificates for each services, using LetsEncrypt. The certificates are saved on the deployment\nworkstation as well, and reused if you are deploying your server again.\n\n\nBasic sites creation\n\n\nThe system can create a skeleton for a static web site for you, with two https certificates as well. The certificates\ncreated, for instance for the domain example.com, will be www.example.com and example.com.\n\n\nYou can also use \nHugo\n and its \nnumerous themes\n to create your\nsite. The nginx server will be configured as a reverse proxy for your site, using a systemd Hugo service.\n\n\nThe hugo web site content need to be placed in the backup folder:\n\n\nbackup/\\<domain-name\\>/website-hugo/\n\n\nThe site will be synchronised on the server, and served by Hugo systemd daemon, protected by AppArmor.\n\n\nModular components\n\n\nAlthough All the components are well integrated together, it is possible to replace them by another one, or to remove\nthem. For instance, the RoundCube webmail and SOGo groupware are optional, like the automatic configuration modules for\n\nMozilla Thunderbird\n and \nMicrosoft Outlook\n.\n\n\nDeveloper friendly\n\n\nIncluded debug\n\n\nWhen you will deploy the server for the first time, on when you are developing, you can set a global \u201cdebug\u201d flag. This\nwill activate the verbose or debug logging option of every service. Just using systemctl, you will be then able to\nfilter by service. Once everything is working, set the flag back to false, run the deployment script again, and you have\na sever ready for production.\n\n\nIntegrated testing\n\n\nUntil we have a full testing environment, perhaps based on virtualisation, you are already able to test the most\nimportant features of your server, automatically, with one command, with an Ansible playbook. This test playbook is\nrunning self diagnostic tasks on your server, and test the following:\n\n\n\n\nBasic OS tests\n\n\nLDAP server\n\n\nHome folders\n\n\nAntispam (rspamd)\n\n\nAntivirus (clamav)\n\n\nOpenDMARC\n\n\nCertificates for all services\n\n\nDKIM keys (opendkim)\n\n\nPostfix configuration\n\n\nIMAP access (dovecot)\n\n\nAutoconfig and Autodiscover\n\n\nDNS records and DNSSEC when the DNS server is installed\n\n\nPrivoxy and Tor configuration\n\n\nZabbix\n\n\n\n\nDevelopment support\n\n\nA playbook add support for development packages, necessary to debug and diagnostic the system while you are developing\nit, like SMTP or DNS tools. Once the development is finished, another playbook remove these packages and cleanup the\nsystem.",
            "title": "Features"
        },
        {
            "location": "/features/#backup-and-disaster-recovery",
            "text": "",
            "title": "Backup and disaster recovery"
        },
        {
            "location": "/features/#debian-iso-image-builder",
            "text": "You can generate an ISO image to install Debian on your server, using a simple configuration file in YAML format.  This will make a quick re-installation disk for the system. It will configure for you full disk encryption and AppArmor  support straight on the first boot. It is not made to install the software stack, that need to be deployed\nwith Ansible, from a remote workstation. Although it might be possible to integrate the deployment scripts into the ISO\nimage.  Because this feature can be useful to other projects, a dedicated project has been created on github .",
            "title": "Debian ISO image builder"
        },
        {
            "location": "/features/#multiple-encrypted-backups",
            "text": "You can setup multiple backups for your user\u2019s home folders, remote or local, with multiple frequencies as well. For\ninstance, one daily backup on your NAS using a Samba share, and a weekly backup on a remote server using SSH. All the\nbackups are encrypted and managed by the excellent  borgbackup  package. A  summary email  is\nsent at the end of the backup process. If you have opted for the Jabber installation, a short message is sent as well,\nnotifying you of the job completion.",
            "title": "Multiple encrypted backups"
        },
        {
            "location": "/features/#disaster-recovery",
            "text": "When you are deploying the system for the first time, all the information generated is saved on the deployment\nworkstation. This gives you a way to re-install your system from scratch, without loosing any information.  If you have specified an external backup location, for instance on a remote server through SSH or on Amazon S3, all your\nemails, address books and calendars will be automatically restored from the backup location of your choice.",
            "title": "Disaster recovery"
        },
        {
            "location": "/features/#security",
            "text": "",
            "title": "Security"
        },
        {
            "location": "/features/#full-disk-encryption",
            "text": "When you are using the ISO image builder to install Debian, the server disk will be fully encrypted using LUKS, with the\npassphrase specified in a configuration file.  This make your server fully secure against physical intrusion, even if your hardware is lost or stolen.  You do not have to plug a screen and a keyboard to unlock your server. Once it is booted, the server starts a small SSH\nserver to connect, and let you enter the passphrase.   Note  The SSH server started on boot share the same public key with OpenSSH. Therefore, you will not have the usual SSH\nwarnings staying the signature has changed.    Tip  It is also possible to use a  Yubikey , with or without a passphrase, to decrypt your drive. In\nthis case, a safe script to enroll your key is provided.",
            "title": "Full disk encryption"
        },
        {
            "location": "/features/#apparmor-enforcement",
            "text": "All the daemons are carefully configured with an AppArmor profile, in enforce mode. This protects you against remote\nintrusion and 0-day vulnerabilities as well.",
            "title": "AppArmor enforcement"
        },
        {
            "location": "/features/#fail2ban-integration",
            "text": "Fail2ban is integrated and configured, to automatically blacklist IP addresses used by spammers to attack your\nserver. It makes this kind of attacks inefficient, and saves your bandwidth too. The duration of jail is customisable for\njabber and email services.",
            "title": "Fail2ban integration"
        },
        {
            "location": "/features/#ldap-authentication",
            "text": "One password per user, for all the services. All the user accounts are saved in the LDAP database, using the OpenLDAP\npackage in Debian. A dedicated SSL certificate is created during the installation, allowing secure SSL and TLS\ncommunication with the server.",
            "title": "LDAP Authentication"
        },
        {
            "location": "/features/#password-policies",
            "text": "Password complexity is enforced using the  pwquality module . You\ncan specify minimum length, mandatory characters like symbols and a mix of lowercase / uppercase letters. You can also\nremember the last passwords for each users, avoiding them to re-use the same passwords or use a password too similar\nthan the previous ones.",
            "title": "Password policies"
        },
        {
            "location": "/features/#automatic-security-update",
            "text": "Once your system is installed, any security update will be installed in background, without you having to do\nanything. This is set using the  Debian unattended upgrades  package.  If\nyou prefer to install security updates yourself, you can disable this behaviour in your system.yml file.  Only the security updates are installed, new packages versions still need to be installed manually.",
            "title": "Automatic security update"
        },
        {
            "location": "/features/#monitoring",
            "text": "The installer can deploy a complete monitoring solution,  Zabbix .   You can set up email or XMPP alerts, on various events.  You can add other servers / machines to your monitoring server.  You can set-up SMS alerts if, for instance, your internet connection goes down.   By default, the guest account is deleted, and a strong password is generated.",
            "title": "Monitoring"
        },
        {
            "location": "/features/#high-profiles-for-ssl-https",
            "text": "All HTTPS sites are configured to use  HSTS .  For nginx\nand dovecot, a 2048 Diffie-Helman parameter file is generated upon installation.  Ranked score A on geekflare.com  and A+ on  ssllabs.com .",
            "title": "High profiles for SSL / HTTPS"
        },
        {
            "location": "/features/#unusual-behaviour-detection",
            "text": "This advanced feature is unique amongst both commercial and self-hosted solutions. It is actually restricted to IMAP,\nbut will be extended to other services. It is working by using a \u201cpoints\u201d system, where more points generate warnings or\neven deny the connection.  The following behaviour are detected, from the :   Access from a blacklisted IP address  Access from an IP address recently blacklisted by fail2ban  Access from a different country than the one the box is hosted  Access outside office hours   Although the initial values should be accurate for standard usage, any of the previous checks can be tuned for a\nspecific usage. For instance, it is possible to:   Whitelist / Blacklist countries, globally or per user.  Whitelist / Blacklist IP addresses, globally or per user.  Set office hours, globally only at this time.   Warning and errors are sent in real time, using XMPP and email to the user and an external email address. Two factors\nauthentication on unusual behaviour will be implemented later, perhaps using google authenticator.",
            "title": "Unusual behaviour detection"
        },
        {
            "location": "/features/#email-features",
            "text": "",
            "title": "Email features"
        },
        {
            "location": "/features/#digital-signature",
            "text": "A DKIM certificate of 4096 bits is generated during the installation, and the associated public key is published on the\nDNS server. The DKIM key purpose is to mark emails coming from your domain as authentic.  The SPF and DMARC records are generated and published automatically as well. This will guarantee your emails being\nrecognised by other email servers without any problem.",
            "title": "Digital signature"
        },
        {
            "location": "/features/#internationalised-email-aliases",
            "text": "You can add as many email aliases as you want for your user accounts. Moreover, you will be able to add email addresses\nwith internationalised characters, using a standardised LDAP schema. You can then have email addresses like\nandr\u00e9@homebox.space.",
            "title": "Internationalised email aliases"
        },
        {
            "location": "/features/#address-extension",
            "text": "When registering on a service, you can use address extensions, to directly receive emails in a specific folder. For\ninstance, emails to  john+lists@example.com  will be directly saved into the  \u2018lists\u2019  folder of your IMAP server.  Email folders can be automatically created and subscribed as well, and you can use any character to separate your email\naddress. for instance \u2018:\u2019, \u2018~\u2019, \u2018/\u2019 etc.",
            "title": "Address extension"
        },
        {
            "location": "/features/#sieve-filtering",
            "text": "Sieve filtering support, with automatic answering, vacation, regular expression, custom scripts support, etc. The web\ninterface to configure your filters is powerful but easy to use.  You can also access your sieve filters with the  ManageSieve  protocol, and the  Thunderbird\nextension .  For instance, you can automatically:   move/copy messages to specified folder  redirect/copy messages to another account  discard messages with a specific error message  reply automatically, using vacation at specific dates  delete messages  sett flags (e.g. flag, mark as read, etc.)",
            "title": "Sieve filtering"
        },
        {
            "location": "/features/#full-text-search",
            "text": "The server implements full text search inside your emails  and  your attachments.  Full text search is also done inside\nattached archives (zip, rar, etc). The following attachments types are actually recognised:   PDF files.  Text, XML and HTML files (various encoding)  Microsoft Office documents: doc, docx, xls, xlsx, pptx.  LibreOffice/OpenOffice documents: ods, odt, odp, sxw.  Other office documents: csv, rtf, gnumeric and abiword files  E-Books (epub)  Attached emails (eml)  Archives: (zip, tar, rar, gzip)  Old microsoft archive format: tnef (aka winmail.dat)   Archives are opened recursively, until finding documents to parse.  Notes and Limitations:   Although encrypted archives cannot be opened, the file list is indexed.  Powerpoint files before 2003 (.ppt) are not well supported.",
            "title": "Full text search"
        },
        {
            "location": "/features/#master-user",
            "text": "Whatever you use your email server for a community or a family, you can activate the \u201cimpersonate\u201d function. This\nfunction creates a \u201cmaster\u201d user, with an access to every other user\u2019s mail boxes.  This feature is disabled by default, it is meant to be useful for families with children with an email address or small\ncommunities.  However, as soon as the master user is accessing someone\u2019s email address, the user receives an alert by XMPP and an\nemail is sent as well.",
            "title": "Master user"
        },
        {
            "location": "/features/#automatic-client-configuration",
            "text": "The server supports  Mozilla Thunderbird ,  Microsoft Outlook  and other email clients automatic configuration. This\nmakes the life of your users easier. It creates and publish autoconfig.xml, autodiscover.xml and DNS records ( RFC\n6186 ).",
            "title": "Automatic client configuration"
        },
        {
            "location": "/features/#antivirus",
            "text": "The emails received are automatically checked for viruses, and are discarded by default if they are infected. The emails\nsent by your users are checked as well, avoiding your IP address to be blacklisted if one of your account is\ncompromised.  You can also choose to explicitly reject (bounce) emails containing viruses. In all case, the analysis is done after the\nemail queue, making the process non blocking and efficient on small resourced hardware.",
            "title": "Antivirus"
        },
        {
            "location": "/features/#antispam-with-automatic-learning",
            "text": "The antispam integrated with the system is very easy to use. The automatic learning is done just by moving emails out or\nin the Junk email folder.  It is powered by rspamd, a pioneered application in term of junk email detection.",
            "title": "Antispam with automatic learning"
        },
        {
            "location": "/features/#external-accounts-import",
            "text": "You can add other email accounts (Yahoo, GMail, Outlook.com, etc.). The emails will be automatically downloaded and\nsynchronised when you connect with any client, and will appear in your account.  Because the folders hierarchy will be copied as well, it is possible to migrate from another account very easily.",
            "title": "External accounts import"
        },
        {
            "location": "/features/#roundcube-webmail",
            "text": "There are two webmail available. RoundCube, and SOGo.  RoundCube, comes with the following plugins / features activated by default:   Archive  Context Menu  Emoticons  Sieve Rules management, with vacation, automatic answers, etc\u2026  Mark as Junk  New mail desktop notification  Password modification  IMAP Subscriptions management  Hotkeys support (Ctrl+Enter to send an email)  Log the real client IP address to the mail server   When the master user functionality has been activated, the impersonate plugin is also installed, allowing you to inspect\nany user\u2019s emails directly from the webmail.  More plugins can be activated very easily, just by specifying their name in the list of plugins.",
            "title": "Roundcube Webmail"
        },
        {
            "location": "/features/#automatic-copy-to-the-sent-folder",
            "text": "You do not need to configure your mail client to copy emails to the sent folder, this is done automatically for\nyou. This is a lot of time saved, especially when sending big emails with attachments: You don\u2019t need to upload an email\ntwice.",
            "title": "Automatic copy to the sent folder"
        },
        {
            "location": "/features/#email-access-logging",
            "text": "Each access to the email server is logged in real time, and contains the following information:   Source IP address  Country  Channel (RoundCube, SOGo or IMAP)  etc\u2026   A monthly report is sent to each user, the first of each month, with a summary of access and some statistics.",
            "title": "Email access logging"
        },
        {
            "location": "/features/#privacy-features",
            "text": "When emails are sent, the user agent (i.e. Thunderbird, Evolution, etc\u2026) version is removed, both for security and\nprivacy.",
            "title": "Privacy features"
        },
        {
            "location": "/features/#calendars-and-address-books",
            "text": "",
            "title": "Calendars and address books"
        },
        {
            "location": "/features/#sogo-groupware",
            "text": "It is also possible to install SOGo, which offer collaborative features, calendaring and address books. There are both\naccessible using respectively CalDAV and CardDAV standards.",
            "title": "SOGo groupware"
        },
        {
            "location": "/features/#features-of-sogo-activated",
            "text": "Send emails reminder on events  Vacation messages  Forward your messages to another email address  Sieve scripts editor  Use the same web interface to access other emails  Change your password from the web interface   More details on the  SOGo home page  and on the official  documentation\npage .",
            "title": "Features of SOGo activated:"
        },
        {
            "location": "/features/#xmpp-jabber-server",
            "text": "The installation script can install an XMPP / Jabber server, by using  ejabberd ,\na \u201c Rock Solid, Massively Scalable, Infinitely Extensible XMPP Server \u201d.",
            "title": "XMPP / Jabber server"
        },
        {
            "location": "/features/#client-to-server",
            "text": "The authentication is using the LDAP server.  Generate a 2048 bits Diffie-Helman key.  Encryption enforcement, at least TLS 1.2.  Jabber Fail2Ban integration  Grade A on  IM Observatory  client and server reports.  SOCKS5 Bytestreams file transfers with image thumbnails (pidgin, empathy, etc.).  Offline file sending using https on a dedicated sub-domain (Android Conversations, etc.).  Automatically add contact (rosters) from the shared directory.  VCard generation from the LDAP server.  Message archives on the server, with archive management from the client (MAM).  User avatars are stored on the server.  Conference / chat rooms between multiple domains.",
            "title": "Client to Server"
        },
        {
            "location": "/features/#server-to-server",
            "text": "The installation scripts can also activates server to server communication (aka s2s).  This is optional but activated by\ndefault. It is also possible to restrict access to trusted servers, by specifying a list of domain names you want to\ntrust.  Some clients:  XMPP client software .",
            "title": "Server to Server"
        },
        {
            "location": "/features/#other-features",
            "text": "",
            "title": "Other features"
        },
        {
            "location": "/features/#gogs-git-server",
            "text": "You can optionally install a small, fast and lightweight git server called  gogs . The server is configured\nwith the following features:   HTTPS certificate  LDAP authentication  Automatic update  Two factors authentication  Repository mirroring",
            "title": "Gogs git server"
        },
        {
            "location": "/features/#bittorrent-download-station",
            "text": "You can install the transmission bittorrent daemon, accessible over https on a dedicated domain.   The web interface and the RPC servers are protected with the LDAP credentials, unless you are at home.  Downloaded files can be accessed directly from your web browser, still using the LDAP credentials if you are not at home.  The daemon runs in a proper AppArmor profile.  Easy to use form to search downloaded files in your web browser.  Automatic firewall configuration to allow bittorrent both input and output.  Blacklist support and automatic update.",
            "title": "Bittorrent download station"
        },
        {
            "location": "/features/#privoxy-server",
            "text": "The platform configures Privoxy with an automatic import of adblock rules from easylist, updated every day. The following rules\nare activated by default:   EasyList  EasyPrivacy  Fanboy\u2019s Annoyance List  Fanboy\u2019s Social Blocking List",
            "title": "Privoxy server"
        },
        {
            "location": "/features/#tor-server",
            "text": "The platform configures Tor as well, and allows you to ooverride any option. You can also chain privoxy and tor\ntogether.",
            "title": "Tor server"
        },
        {
            "location": "/features/#multiple-ip-scheme",
            "text": "Homebox can be configured with two static IP addresses, with a mix of IPv4 amd IPv6. This is useful if you are using a\nVPN that provides you a static IP address or if you are using 3G / 4G as a backup connection.  IPv6 is actually tested on  vultr.com , a provider that supports full IPv6, on virtual\nservers. Digital Ocean does not allows SMTP or Submission on IPv6.",
            "title": "Multiple IP scheme"
        },
        {
            "location": "/features/#dnssec-support",
            "text": "If you need a higher level of security and a protection agains DNS cache poisoning, you can activate the DNSSEC\nextensions. Once the playbook has been run, an email is sent to postmaster, with the ZSK (Zone Signing Key) and KSK (Key\nSigning Key) attached.  The server installed is bind9. When activated, the server also publishes SSHFP  records for extra security.",
            "title": "DNSSEC Support"
        },
        {
            "location": "/features/#single-packet-port-knocking",
            "text": "SPA is essentially next generation port knocking. It is using encryption and HMAC keys, to open your firewall for an SSH\nconnection.   Supports HMAC authenticated encryption for both Rijndael and GnuPG.  Replay attacks are detected and thwarted by SHA-256 digest comparison of valid incoming SPA packets.   More details explained on the  Comprehensive Guide .",
            "title": "Single packet port knocking"
        },
        {
            "location": "/features/#certificates-management",
            "text": "Automatically generate certificates for each services, using LetsEncrypt. The certificates are saved on the deployment\nworkstation as well, and reused if you are deploying your server again.",
            "title": "Certificates management"
        },
        {
            "location": "/features/#basic-sites-creation",
            "text": "The system can create a skeleton for a static web site for you, with two https certificates as well. The certificates\ncreated, for instance for the domain example.com, will be www.example.com and example.com.  You can also use  Hugo  and its  numerous themes  to create your\nsite. The nginx server will be configured as a reverse proxy for your site, using a systemd Hugo service.  The hugo web site content need to be placed in the backup folder:  backup/\\<domain-name\\>/website-hugo/  The site will be synchronised on the server, and served by Hugo systemd daemon, protected by AppArmor.",
            "title": "Basic sites creation"
        },
        {
            "location": "/features/#modular-components",
            "text": "Although All the components are well integrated together, it is possible to replace them by another one, or to remove\nthem. For instance, the RoundCube webmail and SOGo groupware are optional, like the automatic configuration modules for Mozilla Thunderbird  and  Microsoft Outlook .",
            "title": "Modular components"
        },
        {
            "location": "/features/#developer-friendly",
            "text": "",
            "title": "Developer friendly"
        },
        {
            "location": "/features/#included-debug",
            "text": "When you will deploy the server for the first time, on when you are developing, you can set a global \u201cdebug\u201d flag. This\nwill activate the verbose or debug logging option of every service. Just using systemctl, you will be then able to\nfilter by service. Once everything is working, set the flag back to false, run the deployment script again, and you have\na sever ready for production.",
            "title": "Included debug"
        },
        {
            "location": "/features/#integrated-testing",
            "text": "Until we have a full testing environment, perhaps based on virtualisation, you are already able to test the most\nimportant features of your server, automatically, with one command, with an Ansible playbook. This test playbook is\nrunning self diagnostic tasks on your server, and test the following:   Basic OS tests  LDAP server  Home folders  Antispam (rspamd)  Antivirus (clamav)  OpenDMARC  Certificates for all services  DKIM keys (opendkim)  Postfix configuration  IMAP access (dovecot)  Autoconfig and Autodiscover  DNS records and DNSSEC when the DNS server is installed  Privoxy and Tor configuration  Zabbix",
            "title": "Integrated testing"
        },
        {
            "location": "/features/#development-support",
            "text": "A playbook add support for development packages, necessary to debug and diagnostic the system while you are developing\nit, like SMTP or DNS tools. Once the development is finished, another playbook remove these packages and cleanup the\nsystem.",
            "title": "Development support"
        },
        {
            "location": "/prerequisites/",
            "text": "Introduction\n\n\nThis section will explains all the necessary steps \nbefore\n the installation really starts, like the DNS records or your\nhome network set-up.\n\n\nIt is not a \u201cSelf hosting for newbies\u201d, but if you follow the instructions carefully, you do not need strong technical\nknowledge to achieve the above.\n\n\nYou still need some basic understanding though, like what is an IP address or a port, how to run Ansible in a console,\nhow to edit Yaml files, etc.\n\n\nHosting emails at home\n\n\nIf you want seriously host your emails at home, you will need the following:\n\n\n\n\nA static IP address from your ISP (Internet Service Provider).\n\n\nMake sure your port 25 is not blocked.\n\n\nA low power consumption hardware.\n\n\n\n\nPros:\n\n\n\n\nBetter privacy,\n\n\nCheaper if you already pay for broadband with a static IP address.\n\n\n\n\nCons:\n\n\n\n\nYour internet connection and electric providers need to be stable.\n\n\nMight be cumbersome when you are moving\n\n\n\n\nHosting emails online\n\n\nAny serious hosting platform can provide a server, virtual or physical, with an externally accessible IP address. Some\nproviders, however, are blocking the port 25 (e.g. Google cloud).\n\n\nBe careful, using a VPS (Virtual Private Server) is no more secure than hosting at your home.\n\n\nPros:\n\n\n\n\nDoes not rely on the reliability of your internet connection or your electricity provider\n\n\nYou can move to another address easily.\n\n\n\n\nCons:\n\n\n\n\nYou may not have control on the kernel installed. This is less secure than Homebox, which is by default configured to\n  run on AppArmor.\n\n\nYou will not be able to use Full Disk Encryption. Although there are some security measures in places, it is still\n  perfectly possible to extract data from your disk without your knowledge or consent.\n\n\nYou will not have the choice on when and which security updates are applied. Most hosting providers have specific time\n  windows to update the kernel images they use, which may not be as soon as you need, or even appropriate to you.\n\n\nMight be expensive, especially if you have a lot of data.\n\n\n\n\nPre-installation steps\n\n\nSet up your domain name\n\n\nThe first thing you need is a domain name and a DNS provider, there are many available. For instance, here a\n\nlist of other DNS providers\n you can use.\n\n\nThe screenshots and examples in this tutorial are specific to \nGandi\n, but the principles are\nthe same.\n\n\nOnce you have chosen the domain name, it is necessary to configure the associated DNS servers, and the \nglue records\n.\n\n\nFor instance, on Gandi, you will have to set up the glue records first and then the DNS servers used for your domain:\n\n\nGlue records\n\n\nCreate at least one record that points to your static IP address.\n\n\n\n\nDNS servers\n\n\nAdd the DNS server accordingly\n\n\n\n\nChoose the hardware\n\n\nAn old laptop should be enough to start, with the main advantage of being somewhat resilient to power failures. I also\nsuggest you to have a look on this Debian page: \nCheap Serverbox Hardware\n\nof the project freedombox, another excellent project.\n\n\nThe preseed configuration (see next step) provides an option to use software RAID, so you can use this as well if you\nprefer.\n\n\n\n\nWarning\n\n\nYou still need to regularly backup your data, even if you are using RAID.\n\n\n\n\nSet-up your home network\n\n\nThis is necessary only if you choose to use a home device to host your emails. If you are using an online server, you\ncan skip this section.\n\n\n\n\nIdeally, you will need to configure your router to redirect all the external traffic to your homebox using the \u201cDMZ\u201d\nfunctionality if there is one. The other option is to redirect only the ports you will need.\n\n\nInitially, the following TCP ports are required:\n\n\n\n\nTo obtain your certificates from LetsEncrypt, the port 80 need to be exposed.\n\n\nTo test sending and receiving emails, your system should be accessible on the port 25 as well.\n\n\nTo retrieve emails, your system should be accessible on ports 143, 993, 110, 995.\n\n\nTo send emails, your system should be accessible on ports 587 and/or 465.\n\n\nFor Thunderbird automatic configuration, your system should be accessible on port 80.\n\n\nOnce installed, SOGo and the webmail are accessible through https (port 443).\n\n\n\n\nThe next step is to link your domain name (e.g homebox.me) to your static IP address that has been assigned to you by\nyour ISP.\n\n\nPrepare your workstation\n\n\nAny workstation with a decent text editor like \nEmacs\n, \nVim\n or even Gedit should be enough. You will need to run the\nAnsible scripts, and perhaps to install some packages, like rsync. I recommend using Linux, any flavour. For instance,\non Debian or Ubuntu:\n\n\n$ sudo apt install ansible rsync\n\n\n\n\n\nIf you already have a Debian server (Stretch) installed, and you prefer to use it, it\u2019s fine, you can skip the next\nsection and start the \ninstallation\n directly. Otherwise, click on next to read the OS installation\npage.",
            "title": "Before the installation"
        },
        {
            "location": "/prerequisites/#introduction",
            "text": "This section will explains all the necessary steps  before  the installation really starts, like the DNS records or your\nhome network set-up.  It is not a \u201cSelf hosting for newbies\u201d, but if you follow the instructions carefully, you do not need strong technical\nknowledge to achieve the above.  You still need some basic understanding though, like what is an IP address or a port, how to run Ansible in a console,\nhow to edit Yaml files, etc.",
            "title": "Introduction"
        },
        {
            "location": "/prerequisites/#hosting-emails-at-home",
            "text": "If you want seriously host your emails at home, you will need the following:   A static IP address from your ISP (Internet Service Provider).  Make sure your port 25 is not blocked.  A low power consumption hardware.   Pros:   Better privacy,  Cheaper if you already pay for broadband with a static IP address.   Cons:   Your internet connection and electric providers need to be stable.  Might be cumbersome when you are moving",
            "title": "Hosting emails at home"
        },
        {
            "location": "/prerequisites/#hosting-emails-online",
            "text": "Any serious hosting platform can provide a server, virtual or physical, with an externally accessible IP address. Some\nproviders, however, are blocking the port 25 (e.g. Google cloud).  Be careful, using a VPS (Virtual Private Server) is no more secure than hosting at your home.  Pros:   Does not rely on the reliability of your internet connection or your electricity provider  You can move to another address easily.   Cons:   You may not have control on the kernel installed. This is less secure than Homebox, which is by default configured to\n  run on AppArmor.  You will not be able to use Full Disk Encryption. Although there are some security measures in places, it is still\n  perfectly possible to extract data from your disk without your knowledge or consent.  You will not have the choice on when and which security updates are applied. Most hosting providers have specific time\n  windows to update the kernel images they use, which may not be as soon as you need, or even appropriate to you.  Might be expensive, especially if you have a lot of data.",
            "title": "Hosting emails online"
        },
        {
            "location": "/prerequisites/#pre-installation-steps",
            "text": "",
            "title": "Pre-installation steps"
        },
        {
            "location": "/prerequisites/#set-up-your-domain-name",
            "text": "The first thing you need is a domain name and a DNS provider, there are many available. For instance, here a list of other DNS providers  you can use.  The screenshots and examples in this tutorial are specific to  Gandi , but the principles are\nthe same.  Once you have chosen the domain name, it is necessary to configure the associated DNS servers, and the  glue records .  For instance, on Gandi, you will have to set up the glue records first and then the DNS servers used for your domain:",
            "title": "Set up your domain name"
        },
        {
            "location": "/prerequisites/#glue-records",
            "text": "Create at least one record that points to your static IP address.",
            "title": "Glue records"
        },
        {
            "location": "/prerequisites/#dns-servers",
            "text": "Add the DNS server accordingly",
            "title": "DNS servers"
        },
        {
            "location": "/prerequisites/#choose-the-hardware",
            "text": "An old laptop should be enough to start, with the main advantage of being somewhat resilient to power failures. I also\nsuggest you to have a look on this Debian page:  Cheap Serverbox Hardware \nof the project freedombox, another excellent project.  The preseed configuration (see next step) provides an option to use software RAID, so you can use this as well if you\nprefer.   Warning  You still need to regularly backup your data, even if you are using RAID.",
            "title": "Choose the hardware"
        },
        {
            "location": "/prerequisites/#set-up-your-home-network",
            "text": "This is necessary only if you choose to use a home device to host your emails. If you are using an online server, you\ncan skip this section.   Ideally, you will need to configure your router to redirect all the external traffic to your homebox using the \u201cDMZ\u201d\nfunctionality if there is one. The other option is to redirect only the ports you will need.  Initially, the following TCP ports are required:   To obtain your certificates from LetsEncrypt, the port 80 need to be exposed.  To test sending and receiving emails, your system should be accessible on the port 25 as well.  To retrieve emails, your system should be accessible on ports 143, 993, 110, 995.  To send emails, your system should be accessible on ports 587 and/or 465.  For Thunderbird automatic configuration, your system should be accessible on port 80.  Once installed, SOGo and the webmail are accessible through https (port 443).   The next step is to link your domain name (e.g homebox.me) to your static IP address that has been assigned to you by\nyour ISP.",
            "title": "Set-up your home network"
        },
        {
            "location": "/prerequisites/#prepare-your-workstation",
            "text": "Any workstation with a decent text editor like  Emacs ,  Vim  or even Gedit should be enough. You will need to run the\nAnsible scripts, and perhaps to install some packages, like rsync. I recommend using Linux, any flavour. For instance,\non Debian or Ubuntu:  $ sudo apt install ansible rsync  If you already have a Debian server (Stretch) installed, and you prefer to use it, it\u2019s fine, you can skip the next\nsection and start the  installation  directly. Otherwise, click on next to read the OS installation\npage.",
            "title": "Prepare your workstation"
        },
        {
            "location": "/preseed/",
            "text": "Introduction\n\n\nThis step is only required if you want to build a Debian installation disc - before running the Ansible scripts. It does\nnot install the homebox server software stack.\n\n\n\n\nThe disc created does not install the mail server, only the Debian distribution. However, there are two features\nautomatically installed and easily configured: AppArmor and Full Disc Encryption with LUKS. This will protect you\nboth against remote and physical intrusion.\n\n\nIt is also copying your public SSH key onto the installation disc, so you can directly connect to your server\nsecurely with your SSH key.\n\n\nThe installer runs with Ansible, as the root user. A flag can be set  to completely disable remote root login, and to\nenforce sudo usage, once the installation is finished.\n\n\nThere are actually three flavours. The first one is a fully encrypted drive with a passphrase; the second one installs\non a machine with two drives and software RAID; the last one is using LVM only.\n\n\nThis script can be used both for development with a virtual machine or for production to install the operating system\nbase.\n\n\nSteps to do\n\n\n1. Install Docker CE\n\n\nDocker will only be used to create an automatic installer as an ISO image. You can use this ISO image both at home or\nwith a VPS that supports ISO image installation.\n\n\n\n\nOn Debian: \nGet Docker CE for Debian\n.\n\n\nOn Ubuntu: \nGet Docker CE for Ubuntu\n.\n\n\n\n\nIf you did not use docker before, you may need to add your user to the docker group, and restart your session. You can\ndo the former using the terminal:\n\n\n$ sudo adduser bob docker\n\n\n\n\n\n2. Configure your system\n\n\nCopy system-example.yml to system.yml, and modify the values accordingly:\n\n\ncd\n preseed\ncp system-example.yml system.yml\nnano system.yml\n\n\n\n\n\nThe file is self-explanatory. A content example is shown below:\n\n\nsystem\n:\n\n  \nhostname\n:\n \nmail\n\n  \npassphrase\n:\n \nCorrect horse battery stapple\n\n  \npreseed\n:\n \nluks\n\n  \nversion\n:\n \n9.9\n\n  \narch\n:\n \namd64\n\n  \nboot_timeout\n:\n \n5\n   \n# In seconds\n\n\n\nnetwork\n:\n\n  \ndomain\n:\n \nexample.com\n\n  \niface\n:\n \nauto\n            \n# or use eth0, ens3, etc...\n\n\n\n# Country and locales definition\n\n\ncountry\n:\n\n  \ncode\n:\n \nuk\n\n  \ntimezone\n:\n \nEurope/London\n\n\n\nlocale\n:\n\n  \nid\n:\n \nen_GB\n\n  \nlanguage\n:\n \nen\n\n  \ncountry\n:\n \nUK\n\n  \ncharset\n:\n \nUTF-8\n\n  \nkeymap\n:\n \ngb\n\n\n\n# Repository specific values\n\n\nrepo\n:\n\n  \nrelease\n:\n \nstretch\n\n  \nmain\n:\n \nftp.uk.debian.org\n\n  \nsecurity\n:\n \nsecurity.debian.org\n\n  \nsections\n:\n \nmain contrib non-free\n\n\n\n# Clock parameters\n\n\nclock\n:\n\n  \nutc\n:\n \ntrue\n\n  \nntp\n:\n \ntrue\n\n\n\n# Accounts informations\n\n\n# You can choose a strong password here,\n\n\nroot\n:\n\n  \npassword\n:\n \nTr0ub4dor&3\n\n\n\n# Debug: As it states\n\n\ndebug\n:\n \ntrue\n\n\n\n\n\n\n\n\nTip\n\n\nIf you do not have physical access to your box, don\u2019t worry, you will be able to enter the passphrase remotely over\nSSH.\n\n\n\n\n3. Set up remote access\n\n\nThe second thing to do is to copy your SSH public key into the folder \nconfig/authorized_key\n. This file will be copied\ninto the \n/root/.ssh/authorized_keys\n by the automatic installer. This setup is absolutely required for Ansible to work.\n\n\nFor instance:\n\n\n$ cat ~/.ssh/*.pub >config/authorized_key\n\n\n\n\n\n4. Build the ISO image\n\n\nYou are now ready to build the ISO image, run this command:\n\n\ncd\n preseed\n./build.sh\n\n\n\n\n\nThis will create the ISO image in \n/tmp/build-${hostname}/${hostname}-install.iso\n folder, for instance\n\n/tmp/homebox/homebox-install.iso\n\n\n5. Boot the system\n\n\nThe whole installation should be automatic, both with LVM and software RAID. For LVM, there is a volume called \u201creserved\u201d\nyou can remove. This will let you resize the other volumes according to your needs.\n\n\nIf anything goes wrong, use issues on \nGithub project page\n for support.\n\n\n\n\nNote\n\n\nThe installer has been tested both on a virtual and a physical machine. In the second case, the hardware differences\nsometimes stops and the installer asks questions. Just answer appropriately, and the installation procedure will\ncontinue further. Do not hesitate to send feedback about the questions asked.\n\n\n\n\n\n\nTip\n\n\nIf the installation crashes in the middle, try to disable ACPI, add/or the following boot parameters in the\ninstaller:\n\n\nintel_idle.max_cstate=1\n\n\n\n\nThe next step is detailed in the \ninstallation\n section, and is really the installation procedure.\n\n\nDisk scheme options\n\n\nFull disk encryption\n\n\nThis is the recommended one. Use \npreseed: luks\n. Once installed, the system drive will be fully encrypted with\n\nLUKS\n.\n\n\nIf you are interested, you can achieve redundancy of the system drive, using a hardware RAID enclosure.\n\n\nSoftware RAID\n\n\nUse \npreseed: raid\n. Please, note that if you are using software RAID, the drives won\u2019t be encrypted. There are some\nconsiderations to use file level encryption, but this is not implemented and might not be at all.\n\n\nLVM only\n\n\nUse \npreseed: lvm\n. No redundancy and no encryption. This is probably not what you want for a live system, but might be\nuseful for debugging.",
            "title": "Debian OS installation"
        },
        {
            "location": "/preseed/#introduction",
            "text": "This step is only required if you want to build a Debian installation disc - before running the Ansible scripts. It does\nnot install the homebox server software stack.   The disc created does not install the mail server, only the Debian distribution. However, there are two features\nautomatically installed and easily configured: AppArmor and Full Disc Encryption with LUKS. This will protect you\nboth against remote and physical intrusion.  It is also copying your public SSH key onto the installation disc, so you can directly connect to your server\nsecurely with your SSH key.  The installer runs with Ansible, as the root user. A flag can be set  to completely disable remote root login, and to\nenforce sudo usage, once the installation is finished.  There are actually three flavours. The first one is a fully encrypted drive with a passphrase; the second one installs\non a machine with two drives and software RAID; the last one is using LVM only.  This script can be used both for development with a virtual machine or for production to install the operating system\nbase.",
            "title": "Introduction"
        },
        {
            "location": "/preseed/#steps-to-do",
            "text": "",
            "title": "Steps to do"
        },
        {
            "location": "/preseed/#1-install-docker-ce",
            "text": "Docker will only be used to create an automatic installer as an ISO image. You can use this ISO image both at home or\nwith a VPS that supports ISO image installation.   On Debian:  Get Docker CE for Debian .  On Ubuntu:  Get Docker CE for Ubuntu .   If you did not use docker before, you may need to add your user to the docker group, and restart your session. You can\ndo the former using the terminal:  $ sudo adduser bob docker",
            "title": "1. Install Docker CE"
        },
        {
            "location": "/preseed/#2-configure-your-system",
            "text": "Copy system-example.yml to system.yml, and modify the values accordingly:  cd  preseed\ncp system-example.yml system.yml\nnano system.yml  The file is self-explanatory. A content example is shown below:  system : \n   hostname :   mail \n   passphrase :   Correct horse battery stapple \n   preseed :   luks \n   version :   9.9 \n   arch :   amd64 \n   boot_timeout :   5     # In seconds  network : \n   domain :   example.com \n   iface :   auto              # or use eth0, ens3, etc...  # Country and locales definition  country : \n   code :   uk \n   timezone :   Europe/London  locale : \n   id :   en_GB \n   language :   en \n   country :   UK \n   charset :   UTF-8 \n   keymap :   gb  # Repository specific values  repo : \n   release :   stretch \n   main :   ftp.uk.debian.org \n   security :   security.debian.org \n   sections :   main contrib non-free  # Clock parameters  clock : \n   utc :   true \n   ntp :   true  # Accounts informations  # You can choose a strong password here,  root : \n   password :   Tr0ub4dor&3  # Debug: As it states  debug :   true    Tip  If you do not have physical access to your box, don\u2019t worry, you will be able to enter the passphrase remotely over\nSSH.",
            "title": "2. Configure your system"
        },
        {
            "location": "/preseed/#3-set-up-remote-access",
            "text": "The second thing to do is to copy your SSH public key into the folder  config/authorized_key . This file will be copied\ninto the  /root/.ssh/authorized_keys  by the automatic installer. This setup is absolutely required for Ansible to work.  For instance:  $ cat ~/.ssh/*.pub >config/authorized_key",
            "title": "3. Set up remote access"
        },
        {
            "location": "/preseed/#4-build-the-iso-image",
            "text": "You are now ready to build the ISO image, run this command:  cd  preseed\n./build.sh  This will create the ISO image in  /tmp/build-${hostname}/${hostname}-install.iso  folder, for instance /tmp/homebox/homebox-install.iso",
            "title": "4. Build the ISO image"
        },
        {
            "location": "/preseed/#5-boot-the-system",
            "text": "The whole installation should be automatic, both with LVM and software RAID. For LVM, there is a volume called \u201creserved\u201d\nyou can remove. This will let you resize the other volumes according to your needs.  If anything goes wrong, use issues on  Github project page  for support.   Note  The installer has been tested both on a virtual and a physical machine. In the second case, the hardware differences\nsometimes stops and the installer asks questions. Just answer appropriately, and the installation procedure will\ncontinue further. Do not hesitate to send feedback about the questions asked.    Tip  If the installation crashes in the middle, try to disable ACPI, add/or the following boot parameters in the\ninstaller:  intel_idle.max_cstate=1   The next step is detailed in the  installation  section, and is really the installation procedure.",
            "title": "5. Boot the system"
        },
        {
            "location": "/preseed/#disk-scheme-options",
            "text": "",
            "title": "Disk scheme options"
        },
        {
            "location": "/preseed/#full-disk-encryption",
            "text": "This is the recommended one. Use  preseed: luks . Once installed, the system drive will be fully encrypted with LUKS .  If you are interested, you can achieve redundancy of the system drive, using a hardware RAID enclosure.",
            "title": "Full disk encryption"
        },
        {
            "location": "/preseed/#software-raid",
            "text": "Use  preseed: raid . Please, note that if you are using software RAID, the drives won\u2019t be encrypted. There are some\nconsiderations to use file level encryption, but this is not implemented and might not be at all.",
            "title": "Software RAID"
        },
        {
            "location": "/preseed/#lvm-only",
            "text": "Use  preseed: lvm . No redundancy and no encryption. This is probably not what you want for a live system, but might be\nuseful for debugging.",
            "title": "LVM only"
        },
        {
            "location": "/installation/",
            "text": "Installation steps\n\n\nStep 1: Locate is your system\n\n\nWhatever you chose to host your system at home, or to use a VPS, you need to be specify its location to Ansible.\n\n\ncd\n install/config\ncp hosts-example.yml hosts.yml\nnano hosts.yml\n\n\n\n\n\nHere an example on your LAN:\n\n\nall\n:\n\n  \nhosts\n:\n\n    \nhomebox\n:\n\n\n      \nansible_host\n:\n \n192.168.1.254\n\n\n      \nansible_user\n:\n \nroot\n\n      \nansible_port\n:\n \n22\n\n\n\n\n\n\nUsing root during the installation process is a requirement. However, the system can be configured to use sudo once\ninstalled. See the security section, \nDefining administrators\n.\n\n\nStep 2: Describe your system\n\n\nThe main configuration file to create is in the config folder. There is an example named system-example.yml ready to\ncopy to customise. There is also a configuration file defaults.yml. This file contains all the possible options.\n\n\ncd\n config\ncp system-example.yml system.yml\nnano system.yml\n\n\n\n\n\nThe system configuration file is a complete YAML configuration file containing all your settings:\n\n\n\n\nNetwork information, specifically your domain name.\n\n\nUser and group details, like email addresses and aliases.\n\n\nEmail parameters, like maximum attachment size, antivirus options, etc.\n\n\nSome password policies, like minimum length and complexity.\n\n\nWebmail settings (roundcube or SOGo).\n\n\nLow level system settings, mainly used during the development phase.\n\n\nFirewall policies, especially SSH access.\n\n\nSecurity settings.\n\n\nBackup strategies.\n\n\n\n\nThe most important settings are the first two sections, the others can be left to their default values.\n\n\nOnce you have modified the file, you are ready to start the installation.\n\n\n\n\nTip\n\n\nThe system.yml file is merged with the default configuration on deployment. Therefore, you can override any default\nvalue without having to copy entire branches.\n\n\n\n\n\n\nWarning\n\n\nBe careful with the indentation in your Yaml file, the number of spaces is significant.\n\n\n\n\nStep 3: Start the installation\n\n\ncd\n install\nansible-playbook -i ../config/hosts.yml playbooks/main.yml\n\n\n\n\n\nMost important sections\n\n\nNetwork configuration\n\n\nDomain name and host name\n\n\nEvery network subdomain entries, email addresses, etc\u2026 will include the domain name, so this is important you put the\nreal value here:\n\n\nnetwork\n:\n\n  \ndomain\n:\n \nhomebox.space\n\n  \nhostname\n:\n \nmail.homebox.space\n\n  \nexternal_ip\n:\n \nauto\n\n  \nbackup_ip\n:\n \n~\n\n\n\n\n\n\nThe hostname is important, use the real one. If you used the preseed configuration, it should be just mail and your\nnetwork domain.\n\n\nExternal IP address detection\n\n\nThe external IP address is normally automatically detected. If this is not the case, you can specify it manually. If\nyour server has a second IP address, you can specify it here as well. By default, none is defined. You can mix IPv4\nand IPv6 addresses. DNS entries will be added accordingly.\n\n\nnetwork\n:\n\n  \ndomain\n:\n \nhomebox.space\n\n  \nhostname\n:\n \nmail.homebox.space\n\n  \nexternal_ip\n:\n \n12.34.56.78\n\n  \nbackup_ip\n:\n \n2001:15f0:5502:bf1:5400:01ff:feca:dea6\n\n\n\n\n\n\nIf you have a server with both an IPv4 and an IPv6, it can be detected automatically using this syntax:\n\n\nnetwork\n:\n\n  \ndomain\n:\n \nhomebox.space\n\n  \nhostname\n:\n \nmail.homebox.space\n\n  \nexternal_ip\n:\n \nauto\n\n  \nbackup_ip\n:\n \nauto_ipv6\n\n\n\n\n\n\n\n\nWarning\n\n\nIf you have two IP addresses of the same type (e.g. 2 x IPv4), you canot ask the installation script to detect them\nautomatically. You will have to specify them manually.\n\n\n\n\n\n\nTip\n\n\nIf you do not have a backup IP address, use \u201c~\u201d like the example.\n\n\n\n\nUsers list\n\n\nThe file format should be self explanatory. The other piece of information you need to fill first is the user list. In\nits simplest form, you will have something like this:\n\n\nusers\n:\n\n\n-\n \nuid\n:\n \njohn\n\n  \ncn\n:\n \nJohn Doe\n\n  \nfirst_name\n:\n \nJohn\n\n  \nlast_name\n:\n \nDoe\n\n  \nmail\n:\n \njohn.doe@example.com\n\n  \npassword\n:\n \n'xIlm*uu7'\n\n  \naliases\n:\n\n    \n-\n \njohn@homebox.space\n\n    \n-\n \njohny@homebox.space\n\n    \n-\n \njohny-be-good@homebox.space\n\n\n-\n \nuid\n:\n \njane\n\n  \ncn\n:\n \nJane Doe\n\n  \nfirst_name\n:\n \nJane\n\n  \nlast_name\n:\n \nDoe\n\n  \nmail\n:\n \njane.doe@example.com\n\n  \naliases\n:\n\n    \n-\n \njane@homebox.space\n\n\n\n\n\n\nThe email aliases are the other email addresses that belongs to the same user.\n\n\nYou can also add more advanced features, like:\n\n\n\n\nImport emails from other accounts\n.\n\n\nDefine some users as administrators\n\n\nGrant remote access to certain users\n\n\n\n\n\n\nNote\n\n\nYou do not have to set the passwords for each user if you don\u2019t want to. In this case, a random password will be\ngenerated, and saved in the deployment backup directory, in the ldap folder. In this case, there will be one file\ncalled \u2018jane.pwd\u2019. Otherwise, you can specify the password in clear text. For complex passwords, use quotes\n\n\n\n\nEmail options\n\n\nThis is the second most important settings. Here an example of the email options you can override:\n\n\nmail\n:\n\n  \nmax_attachment_size\n:\n \n25\n   \n# In megabytes\n\n  \nautoconfig\n:\n \ntrue\n          \n# Support Thunderbird automatic configuration\n\n  \nautodiscover\n:\n \nfalse\n       \n# Support MS Outlook automatic configuration (uses https)\n\n  \nquota\n:\n\n    \ndefault\n:\n \n1G\n             \n# Maximum allowed mailbox size for your users.\n\n\n\n\n\n\nAll options are detailed on the \nemail configuration\n page.\n\n\nFirewall configuration\n\n\nThe firewall is configured by default to deny everything except what is permitted, both in input and output. The backend\nused is \u201cufw\u201d. If you have specific requirements, you can define the initial rules yourself.\nSee the \nfirewall configuration\n page for details.\n\n\nBy default, a firewall rule is automatically added to allow SSH connections from the IP address used for the\ninstallation. This should prevent being locked out of your system. You can remove this rule at the end of the playbook,\nespecially if you are \nusing fwknop\n to access your system.\n\n\nSecurity options\n\n\nSecurity options are detailed on the \nsecurity page\n.\nThe default settings are\n\n\n\n\nAutomatically install security updates using unattended upgrades.\n\n\nSend alerts to the postmaster.\n\n\nForce root SSH login to use public key cryptography, and not a password.\n\n\nDisable the root password.\n\n\n\n\nOther options are possible, see the security page for details.\n\n\nWebmail\n\n\nBy default, the installation script installs Roundcube, but you can disable it if you want. For instance, SOGo is\navailable as well, with calendars and address books.\n\n\nwebmail\n:\n\n  \ninstall\n:\n \ntrue\n\n  \ntype\n:\n \nroundcube\n\n\n\n\n\n\nMore details on the \nwebmail roundcube\n page.\n\n\nBackup configuration\n\n\nIt is possible to regularly backup your emails, for instance locally on a NAS drive, or on internet, using various\nmethods.\n\n\nBy default, the whole home partition is back up, but you can add or exclude more folders. The detailed instructions are\non the \nbackup documentation\n page.\n\n\nDNS server configuration\n\n\nThe recommended way is to use the internal DNS server, with a minimal configuration like this:\n\n\nbind\n:\n\n  \ninstall\n:\n \ntrue\n\n  \nforward\n:\n\n    \n-\n \n8.8.8.8\n\n    \n-\n \n8.8.4.4\n\n    \n-\n \n2001:4860:4860::8888\n\n    \n-\n \n2001:4860:4860::8844\n\n\n\n\n\n\nYou can also use \nOpenDNS servers\n for forward.\n\n\nOnce your DNS set up is complete, you can monitor the \nworld wide propagation\n.\n\n\nExtra certificates\n\n\nIt is possible to generate more SSL certificates, for instance if you want to deploy other services and want\nthe certificates to be generated and renewed automatically.\n\n\nYou only have to add one variable \nextra-certs\n in your configuration file, for instance:\n\n\nextra_certs\n:\n\n  \n-\n \ntype\n:\n \ngitlab\n\n    \nredirect\n:\n \ntrue\n\n  \n-\n \ntype\n:\n \npackages\n\n    \nredirect\n:\n \ntrue\n\n\n\n\n\n\nBy adding these lines, certificates will be automatically generated for the sub domains \u201cgitlab\u201d and \u201cpackages\u201d, using\nletsencrypt.\n\n\n\n\nTip\n\n\nThe flag \u201credirect\u201d means the users will be automatically redirect from http to https when entering the address.",
            "title": "Homebox Installation"
        },
        {
            "location": "/installation/#installation-steps",
            "text": "",
            "title": "Installation steps"
        },
        {
            "location": "/installation/#step-1-locate-is-your-system",
            "text": "Whatever you chose to host your system at home, or to use a VPS, you need to be specify its location to Ansible.  cd  install/config\ncp hosts-example.yml hosts.yml\nnano hosts.yml  Here an example on your LAN:  all : \n   hosts : \n     homebox :         ansible_host :   192.168.1.254         ansible_user :   root \n       ansible_port :   22   Using root during the installation process is a requirement. However, the system can be configured to use sudo once\ninstalled. See the security section,  Defining administrators .",
            "title": "Step 1: Locate is your system"
        },
        {
            "location": "/installation/#step-2-describe-your-system",
            "text": "The main configuration file to create is in the config folder. There is an example named system-example.yml ready to\ncopy to customise. There is also a configuration file defaults.yml. This file contains all the possible options.  cd  config\ncp system-example.yml system.yml\nnano system.yml  The system configuration file is a complete YAML configuration file containing all your settings:   Network information, specifically your domain name.  User and group details, like email addresses and aliases.  Email parameters, like maximum attachment size, antivirus options, etc.  Some password policies, like minimum length and complexity.  Webmail settings (roundcube or SOGo).  Low level system settings, mainly used during the development phase.  Firewall policies, especially SSH access.  Security settings.  Backup strategies.   The most important settings are the first two sections, the others can be left to their default values.  Once you have modified the file, you are ready to start the installation.   Tip  The system.yml file is merged with the default configuration on deployment. Therefore, you can override any default\nvalue without having to copy entire branches.    Warning  Be careful with the indentation in your Yaml file, the number of spaces is significant.",
            "title": "Step 2: Describe your system"
        },
        {
            "location": "/installation/#step-3-start-the-installation",
            "text": "cd  install\nansible-playbook -i ../config/hosts.yml playbooks/main.yml",
            "title": "Step 3: Start the installation"
        },
        {
            "location": "/installation/#most-important-sections",
            "text": "",
            "title": "Most important sections"
        },
        {
            "location": "/installation/#network-configuration",
            "text": "",
            "title": "Network configuration"
        },
        {
            "location": "/installation/#domain-name-and-host-name",
            "text": "Every network subdomain entries, email addresses, etc\u2026 will include the domain name, so this is important you put the\nreal value here:  network : \n   domain :   homebox.space \n   hostname :   mail.homebox.space \n   external_ip :   auto \n   backup_ip :   ~   The hostname is important, use the real one. If you used the preseed configuration, it should be just mail and your\nnetwork domain.",
            "title": "Domain name and host name"
        },
        {
            "location": "/installation/#external-ip-address-detection",
            "text": "The external IP address is normally automatically detected. If this is not the case, you can specify it manually. If\nyour server has a second IP address, you can specify it here as well. By default, none is defined. You can mix IPv4\nand IPv6 addresses. DNS entries will be added accordingly.  network : \n   domain :   homebox.space \n   hostname :   mail.homebox.space \n   external_ip :   12.34.56.78 \n   backup_ip :   2001:15f0:5502:bf1:5400:01ff:feca:dea6   If you have a server with both an IPv4 and an IPv6, it can be detected automatically using this syntax:  network : \n   domain :   homebox.space \n   hostname :   mail.homebox.space \n   external_ip :   auto \n   backup_ip :   auto_ipv6    Warning  If you have two IP addresses of the same type (e.g. 2 x IPv4), you canot ask the installation script to detect them\nautomatically. You will have to specify them manually.    Tip  If you do not have a backup IP address, use \u201c~\u201d like the example.",
            "title": "External IP address detection"
        },
        {
            "location": "/installation/#users-list",
            "text": "The file format should be self explanatory. The other piece of information you need to fill first is the user list. In\nits simplest form, you will have something like this:  users :  -   uid :   john \n   cn :   John Doe \n   first_name :   John \n   last_name :   Doe \n   mail :   john.doe@example.com \n   password :   'xIlm*uu7' \n   aliases : \n     -   john@homebox.space \n     -   johny@homebox.space \n     -   johny-be-good@homebox.space  -   uid :   jane \n   cn :   Jane Doe \n   first_name :   Jane \n   last_name :   Doe \n   mail :   jane.doe@example.com \n   aliases : \n     -   jane@homebox.space   The email aliases are the other email addresses that belongs to the same user.  You can also add more advanced features, like:   Import emails from other accounts .  Define some users as administrators  Grant remote access to certain users    Note  You do not have to set the passwords for each user if you don\u2019t want to. In this case, a random password will be\ngenerated, and saved in the deployment backup directory, in the ldap folder. In this case, there will be one file\ncalled \u2018jane.pwd\u2019. Otherwise, you can specify the password in clear text. For complex passwords, use quotes",
            "title": "Users list"
        },
        {
            "location": "/installation/#email-options",
            "text": "This is the second most important settings. Here an example of the email options you can override:  mail : \n   max_attachment_size :   25     # In megabytes \n   autoconfig :   true            # Support Thunderbird automatic configuration \n   autodiscover :   false         # Support MS Outlook automatic configuration (uses https) \n   quota : \n     default :   1G               # Maximum allowed mailbox size for your users.   All options are detailed on the  email configuration  page.",
            "title": "Email options"
        },
        {
            "location": "/installation/#firewall-configuration",
            "text": "The firewall is configured by default to deny everything except what is permitted, both in input and output. The backend\nused is \u201cufw\u201d. If you have specific requirements, you can define the initial rules yourself.\nSee the  firewall configuration  page for details.  By default, a firewall rule is automatically added to allow SSH connections from the IP address used for the\ninstallation. This should prevent being locked out of your system. You can remove this rule at the end of the playbook,\nespecially if you are  using fwknop  to access your system.",
            "title": "Firewall configuration"
        },
        {
            "location": "/installation/#security-options",
            "text": "Security options are detailed on the  security page .\nThe default settings are   Automatically install security updates using unattended upgrades.  Send alerts to the postmaster.  Force root SSH login to use public key cryptography, and not a password.  Disable the root password.   Other options are possible, see the security page for details.",
            "title": "Security options"
        },
        {
            "location": "/installation/#webmail",
            "text": "By default, the installation script installs Roundcube, but you can disable it if you want. For instance, SOGo is\navailable as well, with calendars and address books.  webmail : \n   install :   true \n   type :   roundcube   More details on the  webmail roundcube  page.",
            "title": "Webmail"
        },
        {
            "location": "/installation/#backup-configuration",
            "text": "It is possible to regularly backup your emails, for instance locally on a NAS drive, or on internet, using various\nmethods.  By default, the whole home partition is back up, but you can add or exclude more folders. The detailed instructions are\non the  backup documentation  page.",
            "title": "Backup configuration"
        },
        {
            "location": "/installation/#dns-server-configuration",
            "text": "The recommended way is to use the internal DNS server, with a minimal configuration like this:  bind : \n   install :   true \n   forward : \n     -   8.8.8.8 \n     -   8.8.4.4 \n     -   2001:4860:4860::8888 \n     -   2001:4860:4860::8844   You can also use  OpenDNS servers  for forward.  Once your DNS set up is complete, you can monitor the  world wide propagation .",
            "title": "DNS server configuration"
        },
        {
            "location": "/installation/#extra-certificates",
            "text": "It is possible to generate more SSL certificates, for instance if you want to deploy other services and want\nthe certificates to be generated and renewed automatically.  You only have to add one variable  extra-certs  in your configuration file, for instance:  extra_certs : \n   -   type :   gitlab \n     redirect :   true \n   -   type :   packages \n     redirect :   true   By adding these lines, certificates will be automatically generated for the sub domains \u201cgitlab\u201d and \u201cpackages\u201d, using\nletsencrypt.   Tip  The flag \u201credirect\u201d means the users will be automatically redirect from http to https when entering the address.",
            "title": "Extra certificates"
        },
        {
            "location": "/email-configuration/",
            "text": "Automatic clients configuration\n\n\nmail_default\n:\n\n  \nmax_attachment_size\n:\n \n25\n   \n# In megabytes\n\n  \nautoconfig\n:\n \ntrue\n          \n# Support Thunderbird automatic configuration\n\n  \nautodiscover\n:\n \nfalse\n       \n# Support MS Outlook automatic configuration (uses https)\n\n\n\n\n\n\nThe option \u201cautoconfig\u201d allows your users to automatically configure their email parameters in \nMozilla Thunderbird\n.\n\n\nFor instance, for the domain homebox.space, this will create a subdomain entry \u201cautoconfig.homebox.space\u201d\n\n\nThe option \u201cautodiscover\u201d allows your _Microsoft Outlook_users to automatically configure their email parameters. For\ninstance, for the domain homebox.space, this will create a subdomain entry \u201cautodiscover.homebox.space\u201d, accessible in\nhttps, with a dedicated SSL certificate.\n\n\nAntivirus configuration\n\n\nmail\n:\n\n  \n...\n\n  \nantivirus\n:\n                \n# Check inbound and outbound emails for viruses\n\n    \nport\n:\n \n34000\n             \n# port to use for the antivirus daemon\n\n    \nactive\n:\n \ntrue\n            \n# or false\n\n    \naction\n:\n \ndrop\n            \n# Action to do when a virus is found in an email: bounce or drop\n\n                            \n# be careful, bouncing external emails is a way to expose clamav usage\n\n    \nquarantine\n:\n \nyes\n         \n# Place emails with a virus in quarantine, for further analysis\n\n    \nuse_proxy\n:\n \nfalse\n        \n# use tor / privoxy to dowload updates\n\n\n\n\n\n\nThe platform can scan the emails received and sent, using \nClamAV\n.\n\n\n\n\nYou can disable the antivirus, by setting \u2018active\u2019 to false.\n\n\nBy default, emails with viruses are dropped silently, but you can set the action to \u2018bounce\u2019 if you wish to send an\n  alert to the external senders.\n\n\n\n\nMaster users\n\n\nAs Dovecot is used, it is possible to activate the \u201cimpersonate\u201d or \nmaster users\n feature.  If you activate this\noption, a \nmaster\n user will be created, allowing you to logon as any user.  The RoundCube impersonate plugin will be\nactivated as well.\n\n\nExample with this configuration:\n\n\nmail\n:\n\n  \n\u2026\n\n  \nimpersonate\n:\n\n    \nactive\n:\n \ntrue\n\n    \nmaster\n:\n \nmaster\n\n    \nseparator\n:\n \n'/'\n\n\n\n\n\n\nIf one user is called john, you can now login as john, using \u201cjohn/master\u201d and the master user password.\n\n\nThe password is automatically generated, and saved in the backup folder, in the file \nldap/master.pwd\n.\n\n\n\n\nWarning\n\n\nEvery time the \nmaster account\n feature is used, a notice is sent to the original user, both by email and with\nJabber when installed.\n\n\n\n\nImport external accounts\n\n\nThere are two ways of importing other emails. The easiest way is to use SOGo web interface. In this case, you will see\nyour other account emails in the web interface.\n\n\nThe other option is to use the yaml configuration file. The advantage is once this set up, external emails will be\nautomatically imported in your main account, regardless of the client you are using.\n\n\nThis is detailed in the section \nExternal accounts\n.\n\n\n\n\nNote\n\n\nOne important thing to know is that this feature automatically creates a Dovecot \nmaster user\n, that will be used to\nimport the emails into the folders. However, this master user can only log in from the system itself, so there is no\ndanger of using the import user to access someone\u2019s emails. If someone tried the use the import account, the\nconnection would be refused, and an email alert will be sent to the postmaster.\n\n\n\n\nAdvanced features\n\n\nWhen this flag is set to true, some advanced features will be\navailable, and a more recent version of Dovecot will be installed,\nfrom the Debian backports repository.\n\n\nInternational email addresses\n\n\nYour main email address should be without ASCII characters only, but the aliases can contains accents,\nfor instance:\n\n\nusers\n:\n\n\n-\n \nuid\n:\n \nandre\n\n  \ncn\n:\n \nAndr\u00e9 Rodier\n\n  \nfirst_name\n:\n \nAndr\u00e9\n\n  \nlast_name\n:\n \nRodier\n\n  \nmail\n:\n \nandre@homebox.space\n\n  \npassword\n:\n \nXhlojwei$u987%\n\n  \naliases\n:\n\n\n    \n-\n \nandr\u00e9.rodier@homebox.space\n\n\n    \n-\n \nandr\u00e9@homebox.space\n\n\n\n\n\n\n\n\nNote\n\n\nThis is possible if all the software and the platforms involved support it. Not all major email providers are supporting\nthis, Yahoo mail, for instance, does not even let you send an email with an internationalised user name.\nThis feature is not entirely tested yet, but is working so far between two homebox servers and SOGo or evolution.\n\n\n\n\nEmail addresses extensions\n\n\nThe flag \u201crecipient_delimiter\u201d let you send an email directly to a folder, by using a character to separate the email\naddress and the folder name with a character. The most common character is \u201c+\u201d although you can use any character.\n\n\nExample with this configuration:\n\n\nmail\n:\n\n  \nrecipient_delimiter\n:\n \n'+'\n\n\n\n\n\n\nFor a user with an email address like \njohn@homebox.space\n, any email sent to \njohn+lists@homebox.space\n will be\nstored in the folder \u201clists\u201d.\n\n\n\n\nNote\n\n\nIf the folder does not exists, the email will be placed in your INBOX.\n\n\n\n\nCustom Postfix options\n\n\nYou can add any compatible postfix configuration, by defining the variable \u201cextra-settings\u201d into your system.yml\nfile. In this case, anything this variable contains will be added into the main.cf file.  The \npostfix\ndocumentation\n should help you.\n\n\nExample: You want to send a copy of any email received to another external address, and allow the VRFY command:\n\n\nmail\n:\n\n  \npostfix\n:\n\n\n    \nextra_settings\n:\n \n|\n\n\n      \nalways_bcc = spyme@fbi.gov.us\n\n\n      \ndisable_vrfy_command = no",
            "title": "Email configuration"
        },
        {
            "location": "/email-configuration/#automatic-clients-configuration",
            "text": "mail_default : \n   max_attachment_size :   25     # In megabytes \n   autoconfig :   true            # Support Thunderbird automatic configuration \n   autodiscover :   false         # Support MS Outlook automatic configuration (uses https)   The option \u201cautoconfig\u201d allows your users to automatically configure their email parameters in  Mozilla Thunderbird .  For instance, for the domain homebox.space, this will create a subdomain entry \u201cautoconfig.homebox.space\u201d  The option \u201cautodiscover\u201d allows your _Microsoft Outlook_users to automatically configure their email parameters. For\ninstance, for the domain homebox.space, this will create a subdomain entry \u201cautodiscover.homebox.space\u201d, accessible in\nhttps, with a dedicated SSL certificate.",
            "title": "Automatic clients configuration"
        },
        {
            "location": "/email-configuration/#antivirus-configuration",
            "text": "mail : \n   ... \n   antivirus :                  # Check inbound and outbound emails for viruses \n     port :   34000               # port to use for the antivirus daemon \n     active :   true              # or false \n     action :   drop              # Action to do when a virus is found in an email: bounce or drop \n                             # be careful, bouncing external emails is a way to expose clamav usage \n     quarantine :   yes           # Place emails with a virus in quarantine, for further analysis \n     use_proxy :   false          # use tor / privoxy to dowload updates   The platform can scan the emails received and sent, using  ClamAV .   You can disable the antivirus, by setting \u2018active\u2019 to false.  By default, emails with viruses are dropped silently, but you can set the action to \u2018bounce\u2019 if you wish to send an\n  alert to the external senders.",
            "title": "Antivirus configuration"
        },
        {
            "location": "/email-configuration/#master-users",
            "text": "As Dovecot is used, it is possible to activate the \u201cimpersonate\u201d or  master users  feature.  If you activate this\noption, a  master  user will be created, allowing you to logon as any user.  The RoundCube impersonate plugin will be\nactivated as well.  Example with this configuration:  mail : \n   \u2026 \n   impersonate : \n     active :   true \n     master :   master \n     separator :   '/'   If one user is called john, you can now login as john, using \u201cjohn/master\u201d and the master user password.  The password is automatically generated, and saved in the backup folder, in the file  ldap/master.pwd .   Warning  Every time the  master account  feature is used, a notice is sent to the original user, both by email and with\nJabber when installed.",
            "title": "Master users"
        },
        {
            "location": "/email-configuration/#import-external-accounts",
            "text": "There are two ways of importing other emails. The easiest way is to use SOGo web interface. In this case, you will see\nyour other account emails in the web interface.  The other option is to use the yaml configuration file. The advantage is once this set up, external emails will be\nautomatically imported in your main account, regardless of the client you are using.  This is detailed in the section  External accounts .   Note  One important thing to know is that this feature automatically creates a Dovecot  master user , that will be used to\nimport the emails into the folders. However, this master user can only log in from the system itself, so there is no\ndanger of using the import user to access someone\u2019s emails. If someone tried the use the import account, the\nconnection would be refused, and an email alert will be sent to the postmaster.",
            "title": "Import external accounts"
        },
        {
            "location": "/email-configuration/#advanced-features",
            "text": "When this flag is set to true, some advanced features will be\navailable, and a more recent version of Dovecot will be installed,\nfrom the Debian backports repository.",
            "title": "Advanced features"
        },
        {
            "location": "/email-configuration/#international-email-addresses",
            "text": "Your main email address should be without ASCII characters only, but the aliases can contains accents,\nfor instance:  users :  -   uid :   andre \n   cn :   Andr\u00e9 Rodier \n   first_name :   Andr\u00e9 \n   last_name :   Rodier \n   mail :   andre@homebox.space \n   password :   Xhlojwei$u987% \n   aliases :       -   andr\u00e9.rodier@homebox.space       -   andr\u00e9@homebox.space    Note  This is possible if all the software and the platforms involved support it. Not all major email providers are supporting\nthis, Yahoo mail, for instance, does not even let you send an email with an internationalised user name.\nThis feature is not entirely tested yet, but is working so far between two homebox servers and SOGo or evolution.",
            "title": "International email addresses"
        },
        {
            "location": "/email-configuration/#email-addresses-extensions",
            "text": "The flag \u201crecipient_delimiter\u201d let you send an email directly to a folder, by using a character to separate the email\naddress and the folder name with a character. The most common character is \u201c+\u201d although you can use any character.  Example with this configuration:  mail : \n   recipient_delimiter :   '+'   For a user with an email address like  john@homebox.space , any email sent to  john+lists@homebox.space  will be\nstored in the folder \u201clists\u201d.   Note  If the folder does not exists, the email will be placed in your INBOX.",
            "title": "Email addresses extensions"
        },
        {
            "location": "/email-configuration/#custom-postfix-options",
            "text": "You can add any compatible postfix configuration, by defining the variable \u201cextra-settings\u201d into your system.yml\nfile. In this case, anything this variable contains will be added into the main.cf file.  The  postfix\ndocumentation  should help you.  Example: You want to send a copy of any email received to another external address, and allow the VRFY command:  mail : \n   postfix :       extra_settings :   |         always_bcc = spyme@fbi.gov.us         disable_vrfy_command = no",
            "title": "Custom Postfix options"
        },
        {
            "location": "/webmail-roundcube/",
            "text": "Presentation\n\n\nRoundcube is a free and open source webmail solution with a desktop-like user interface. The skins use the latest web\nstandards to render a functional and customizable UI.\n\n\nDefault configuration\n\n\nBy default, roundcube is installed with the following plugins\n\n\n\n\narchive\n\n\nautologon\n\n\ncontextmenu\n\n\ndovecot_impersonate\n\n\nemoticons\n\n\nfilesystem_attachments\n\n\njqueryui\n\n\nkeyboard_shortcuts\n\n\nmanagesieve\n\n\nmarkasjunk\n\n\nnewmail_notifier\n\n\nnew_user_identity\n\n\npassword\n\n\nsubscriptions_option\n\n\n\n\nOther plugins availables\n\n\nThe following plugins are available:\n\n\n\n\ndkimstatus\n\n\nhide_blockquote\n\n\nenigma\n\n\nzipdownload\n\n\nnew_user_dialog\n\n\nadditional_message_headers\n\n\nacl\n\n\ndatabase_attachments\n\n\ndebug_logger\n\n\nfilesystem_attachments\n\n\nhelp\n\n\nhide_blockquote\n\n\nhttp_authentication\n\n\nshow_additional_headers\n\n\nsquirrelmail_usercopy\n\n\nthunderbird_labels\n\n\nuserinfo\n\n\nvcard_attachments\n\n\nvirtuser_file\n\n\nvirtuser_query\n\n\n\n\nNot all plugins can be installed right away, you may have to modify your system manually for some of them.\n\n\n\n\nroundcube-plugins\n\n\nroundcube-plugins-extra",
            "title": "Roundcube Webmail"
        },
        {
            "location": "/webmail-roundcube/#presentation",
            "text": "Roundcube is a free and open source webmail solution with a desktop-like user interface. The skins use the latest web\nstandards to render a functional and customizable UI.",
            "title": "Presentation"
        },
        {
            "location": "/webmail-roundcube/#default-configuration",
            "text": "By default, roundcube is installed with the following plugins   archive  autologon  contextmenu  dovecot_impersonate  emoticons  filesystem_attachments  jqueryui  keyboard_shortcuts  managesieve  markasjunk  newmail_notifier  new_user_identity  password  subscriptions_option",
            "title": "Default configuration"
        },
        {
            "location": "/webmail-roundcube/#other-plugins-availables",
            "text": "The following plugins are available:   dkimstatus  hide_blockquote  enigma  zipdownload  new_user_dialog  additional_message_headers  acl  database_attachments  debug_logger  filesystem_attachments  help  hide_blockquote  http_authentication  show_additional_headers  squirrelmail_usercopy  thunderbird_labels  userinfo  vcard_attachments  virtuser_file  virtuser_query   Not all plugins can be installed right away, you may have to modify your system manually for some of them.   roundcube-plugins  roundcube-plugins-extra",
            "title": "Other plugins availables"
        },
        {
            "location": "/groupware-sogo/",
            "text": "Presentation\n\n\nSOGo is a fully supported and trusted groupware server with a focus on scalability and open standards.\n\n\nSOGo provides a rich AJAX-based Web interface and supports multiple native clients through the use of standard protocols\nsuch as CalDAV, CardDAV and GroupDAV, as well as Microsoft ActiveSync.\n\n\nSOGo offers multiple ways to access calendaring and messaging data. Your users can either use a web browser, Microsoft\nOutlook, Mozilla Thunderbird, Apple iCal, or a mobile device to access the same information.\n\n\nDefault settings\n\n\nThese settings are loaded by default when installing SOGo:\n\n\nsogo\n:\n\n  \nappointment_send_emails\n:\n \ntrue\n\n  \nvacation\n:\n \ntrue\n\n  \nforward\n:\n \ntrue\n\n  \nsieve_scripts\n:\n \ntrue\n\n  \nfirst_day_of_week\n:\n \n1\n \n# 1 is Monday\n\n  \nday_start_time\n:\n \n9\n\n  \nday_end_time\n:\n \n17\n\n  \ntime_format\n:\n \n'%H:%M'\n\n  \nrefresh_view_check\n:\n \nevery_minute\n\n  \nauxiliary_accounts\n:\n \nfalse\n\n  \nlanguage\n:\n \nEnglish\n\n  \nenable_public_access\n:\n \nfalse\n\n  \npassword_change\n:\n \ntrue\n\n  \nauxiliary_accounts\n:\n \ntrue\n\n\n\n\n\n\n\n\n\n\n\n\nFlag\n\n\nRole\n\n\n\n\n\n\n\n\n\n\nappointment_send_emails\n\n\nSend emails when apointments are created.\n\n\n\n\n\n\nvacation\n\n\nActivate vacation functionality in the web interface.\n\n\n\n\n\n\nforward\n\n\nActivate automatic forward functionality in the web interface.\n\n\n\n\n\n\nsieve_scripts\n\n\nAllow you to filter your emails using advanced server side filters.\n\n\n\n\n\n\nfirst_day_of_week\n\n\nSet the first day of the week in the interface. Default is Monday, 1. Set it to 0 for Sunday.\n\n\n\n\n\n\nday_start_time / day_end_time\n\n\nThe working hours, in 24h notation.\n\n\n\n\n\n\ntime_format\n\n\nThe format used to display the time. See the \nstrftime\n function for format.\n\n\n\n\n\n\nrefresh_view_check\n\n\nThe time interval to check for new emails.\n\n\n\n\n\n\nauxiliary_accounts\n\n\nAllow you to retrieve emails from external accounts, directly from the web interface.\n\n\n\n\n\n\nlanguage\n\n\nThe defaut language of the web interface\u00b9\n\n\n\n\n\n\nenable_public_access\n\n\nAllow public access to your calendars and address books, using a specific URL.\n\n\n\n\n\n\npassword_change\n\n\nAllow you to change your passwors from the web interface.\n\n\n\n\n\n\n\n\n Notes \n\n\n\n\nPossible values are defined in the\n\nSOGo installation guide\n\n\n\n\nClients\n\n\nYou can use any client compatible with these standards:\n\n\nOn Linux\n\n\n\n\nEvolution\n\n\nThunderbird\n\n\n\n\nOn Windows\n\n\n\n\nThunderbird\n\n\neM Client\n (Not open source)\n\n\nMicrosoft Outlook (Not open source)\n\n\n\n\nOn Android\n\n\n\n\nDavDroid\n\n\nCalDAV Sync\n\n\nCardDAV sync\n\n\nOpenTasks\n\n\n\n\nOn MacOS / iOS\n\n\n\n\nApple Calendar\n\n\nContacts.app\n\n\nThunderbird\n\n\neM Client",
            "title": "Sogo Groupware"
        },
        {
            "location": "/groupware-sogo/#presentation",
            "text": "SOGo is a fully supported and trusted groupware server with a focus on scalability and open standards.  SOGo provides a rich AJAX-based Web interface and supports multiple native clients through the use of standard protocols\nsuch as CalDAV, CardDAV and GroupDAV, as well as Microsoft ActiveSync.  SOGo offers multiple ways to access calendaring and messaging data. Your users can either use a web browser, Microsoft\nOutlook, Mozilla Thunderbird, Apple iCal, or a mobile device to access the same information.",
            "title": "Presentation"
        },
        {
            "location": "/groupware-sogo/#default-settings",
            "text": "These settings are loaded by default when installing SOGo:  sogo : \n   appointment_send_emails :   true \n   vacation :   true \n   forward :   true \n   sieve_scripts :   true \n   first_day_of_week :   1   # 1 is Monday \n   day_start_time :   9 \n   day_end_time :   17 \n   time_format :   '%H:%M' \n   refresh_view_check :   every_minute \n   auxiliary_accounts :   false \n   language :   English \n   enable_public_access :   false \n   password_change :   true \n   auxiliary_accounts :   true      Flag  Role      appointment_send_emails  Send emails when apointments are created.    vacation  Activate vacation functionality in the web interface.    forward  Activate automatic forward functionality in the web interface.    sieve_scripts  Allow you to filter your emails using advanced server side filters.    first_day_of_week  Set the first day of the week in the interface. Default is Monday, 1. Set it to 0 for Sunday.    day_start_time / day_end_time  The working hours, in 24h notation.    time_format  The format used to display the time. See the  strftime  function for format.    refresh_view_check  The time interval to check for new emails.    auxiliary_accounts  Allow you to retrieve emails from external accounts, directly from the web interface.    language  The defaut language of the web interface\u00b9    enable_public_access  Allow public access to your calendars and address books, using a specific URL.    password_change  Allow you to change your passwors from the web interface.      Notes    Possible values are defined in the SOGo installation guide",
            "title": "Default settings"
        },
        {
            "location": "/groupware-sogo/#clients",
            "text": "You can use any client compatible with these standards:",
            "title": "Clients"
        },
        {
            "location": "/groupware-sogo/#on-linux",
            "text": "Evolution  Thunderbird",
            "title": "On Linux"
        },
        {
            "location": "/groupware-sogo/#on-windows",
            "text": "Thunderbird  eM Client  (Not open source)  Microsoft Outlook (Not open source)",
            "title": "On Windows"
        },
        {
            "location": "/groupware-sogo/#on-android",
            "text": "DavDroid  CalDAV Sync  CardDAV sync  OpenTasks",
            "title": "On Android"
        },
        {
            "location": "/groupware-sogo/#on-macos-ios",
            "text": "Apple Calendar  Contacts.app  Thunderbird  eM Client",
            "title": "On MacOS / iOS"
        },
        {
            "location": "/email-access-monitoring/",
            "text": "Email access monitoring\n\n\nThis optional feature is for users who are genuinely concerned about the confidentiality of their emails, and want to be\naware as soon as someone else is opening their emails.\n\n\nThe default settings should be appropriate for most users. However, the users who have unusual habits will be able to\ntune the system according to their needs.\n\n\n\n\nIt can send you warning, in real time, when something unusual is happening, which is explained below.\n\n\nIt can block the connection, for instance from blacklisted IP addresses, and send you a warning in real time.\n\n\nIt logs all your connection information in a small database. Each user can then do some querying and reporting easily.\n\n\nA monthly report is sent the first day of every month, containing the analysis of the previous month.\n\n\nWhen the \u201cimpersonate\u201d feature is used to access one user\u2019s emails, an alert is sent in real time to this user.\n\n\n\n\n\n\nNote\n\n\nReal time alerts are sent by email and XMPP, to your account or an external account if configured so.\n\n\n\n\nScoring system\n\n\nWhen this feature is activated, every time your emails are accessed, a sequence of analysis is executed. Every violation\nof a rule increase a score by a number of points. Above a certain score, a warning is sent. Above another score, the\nconnection is denied.\n\n\n\n\nThe scoring system can be easily customised, globally or per user.\n\n\nOnly one warning is sent per day, per connection.\n\n\nWhen a connection is denied, email alerts are limited to one per hour.\n\n\n\n\nThe default points should be satisfactory for the standard needs, so it is better to tune other parameters, like\nwhitelisting IP addresses or countries.\n\n\nAny customisation should be done in the Homebox configuration directory \n~/.config/homebox/\n.\n\n\nDefault settings\n\n\n\n\nWarning score: 40\n\n\nDeny score: 120\n\n\n\n\nUnusual behaviours\n\n\nUnusual behaviours are defined below, from the highest score to the lowest.\n\n\nConnection from a blacklisted IP address\n\n\nIf you are checking your emails from another place, the system will check the reputation of the IP address, and will\nwarn you if the place is not safe. The software used is \nrblcheck\n. The more an IP\naddress is blacklisted, the more you are likely to receive a warning.\n\n\nPoints: 60 points per blacklist record.\n\n\nBy default, the following lists are checked:\n\n\n\n\nsbl.spamhaus.org\n\n\nxbl.spamhaus.org\n\n\npbl.spamhaus.org\n\n\nbl.spamcop.net\n\n\npsbl.surriel.com\n\n\ndul.dnsbl.sorbs.net\n\n\n\n\n\n\nWarning\n\n\nWhen an IP address is blacklisted two times, the connection will be denied.\n\n\n\n\nCustomisation\n\n\nIf for any reason, you need to connect from an IP address you know is blacklisted, you can whitelist the IP address, by\ncreating a file \nip-whitelist.txt\n inside your homebox configuration directory \n~/.config/homebox\n.\n\n\nThis file can look like this:\n\n\n# Budapest UPC Magyarorszag Kft:\n176.63.24.0/21\n\n# Swiss ressort\n81.17.27.131\n\n\n\n\n\nComments and blank lines are not mandatory and are ignored. You can also whitelist entire networks using CIDR blocks.\n\n\nAlthough it is not recommended, you can also change the blacklisting score globally:\n\n\naccess_check\n:\n\n  \nip\n:\n\n\n    \nrbl_malus\n:\n \n40\n\n\n\n\n\n\nIP addresses blacklisted by fail2ban\n\n\nIf an IP address has been before blacklisted by fail2ban, a score of 10 will be added per blacklist. So, if an IP\naddress has been banned 5 time in the last log file, the score will be 50 points.\n\n\nThis is a safeguard to ensure a brute force attack against your email account is rejected, even if the password has been\nfound.\n\n\nIf you want to tune this, you can change the fail2ban score to another value, or even to 0 to disable it\nentirely:\n\n\naccess_check\n:\n\n  \nip\n:\n\n\n    \nfail2ban_malus\n:\n \n5\n\n\n\n\n\n\nConnection from a foreign country\n\n\nIf for instance you are living in France, there is no reason you would connect from China or Russia, except if you are\noften travelling in these countries. In this case, you can add the country code to the list of trusted countries.\n\n\nYou can trust some countries for the whole system, by changing the access_check.countries.trust values:\n\n\naccess_check\n:\n\n  \ncountries\n:\n\n\n    \ntrust\n:\n \n[\n \n'FR'\n,\n \n'DE'\n,\n \n'GB'\n,\n \n'ES'\n \n]\n\n\n\n\n\n\nIf you prefer to do it for one user only you can define a list of \u201ctrusted\u201d countries, in the user\u2019s configuration file.\n\n\nThe user configuration file should be called \naccess-check.conf\n, inside the folder \n~/.config/homebox\n.\n\n\n# A comma separated list of country codes to trust (e.g. FR,DE,GB)\n\n\nCOUNTRIES_TRUST\n=\n'RU,DE,FR'\n\n\n\n\n\n\nFor instance, in a family, parents are travelling more than children, so it make more sense to do it per users.\n\n\nConnection at unusual time\n\n\nThis is a minor check, but it helps to warns you, especially when this fact is happening along with other suspicious\nbehaviours. For instance, accessing your emails at midnight, from an IP address that is blacklisted will definitely\ngenerate a warning.\n\n\nPoints: 10 points per hour outside the working hours. For instance, if you defined your working hours from 9am to 6pm, a\nconnection at 2am will generate 70 points, and a warning will be sent.\n\n\n\n\nNote\n\n\nWarnings are limited to one per day only.\n\n\n\n\nIf you have unusual working hours, or if you want to disable this entirely, you can set for instance 0-23. Times are\nspecified in 24h mode.\n\n\naccess_check\n:\n\n\n  \ntime\n:\n\n\n    \nstart\n:\n \n9\n\n\n    \nend\n:\n \n22\n\n\n\n\n\n\nOther considerations\n\n\nConnections from LAN\n\n\nConnections from your local network are actually trusted, but logged. Other scripts might be added later to offer more\ncontrol.\n\n\nBlacklisting countries\n\n\nYou can blacklist entire countries, but system wide only for now.\n\n\nFor instance, here how to deny all IMAP connections, on the whole system, to Russia and China:\n\n\naccess_check\n:\n\n  \ncountries\n:\n\n    \nblacklist\n:\n \n[\n \n'RU'\n,\n \n'CN'\n \n]\n\n\n\n\n\n\nCustomising the alert address\n\n\nBy defaults, the alerts will be sent to the postmaster \nand\n the user under attack, using both email and XMPP.\n\n\nYou can also use an external email address, by specifying the address globally, in the system.yml file:\n\n\naccess_check\n:\n\n  \n...\n\n\n  \nalert_address\n:\n \njohn.doe@protonmail.com\n\n\n  \n...\n\n\n\n\n\n\nFinally, this can be done per user as well, by modifying the \naccess-check.conf\n file, inside the folder\n\n~/.config/homebox\n:\n\n\n# Send alerts and XMPP warnings to an external address:\n\n\nALERT_ADDRESS\n=\n'other@protonmail.com'\n\n\n\n\n\n\nIt is advised to use an external address, to be sure a compromised account cannot be cleared from its alerts.\n\n\nDetailed settings\n\n\nThese settings are visible in the defaults.yml file, in the repository:\n\n\naccess_check_default\n:\n\n  \nactive\n:\n \nfalse\n\n  \nwhitelist_bonus\n:\n \n255\n        \n# Bonus to apply when an IP or country is whitelisted. Max value is 255\n\n  \nblacklist_malus\n:\n \n255\n        \n# Malus to apply when an IP or country is blacklisted. Max value is 255\n\n  \nwarning_score\n:\n \n40\n           \n# Score threshold to generate a warning\n\n  \ndenied_score\n:\n \n120\n           \n# Score threshold to deny a connection\n\n  \ndisplay_score\n:\n \nfalse\n        \n# # Should we display the scores in the alerts ?\n\n                              \n# It is more informative for development\n\n                              \n# but it might be confusing for new users\n\n  \ntime\n:\n                       \n# Standard time range you are normally checking your emails.\n\n    \nzone\n:\n \nauto\n                \n# The timezone to consider when checking the access time.\n\n    \nstart\n:\n \n8\n                  \n# start-end:  the more you are outside this range, the more malus points\n\n    \nend\n:\n \n18\n                   \n#   are added. 10 points per hour outside the range\n\n                              \n#   Perhaps this will generate one warning if you check your emails\n\n                              \n#   from home at midnight or at 2am.\n\n  \ncountries\n:\n                  \n# Countries check parameters\n\n    \ntrust\n:\n \n[]\n                 \n# A list of additional countries to trust, i.e. that will not generate points.\n\n                              \n#   However, other restrictions are still applying (e.g. blacklisted IP address)\n\n    \nblacklist\n:\n \n[]\n             \n# A list of blacklisted countries. Connections from these countries will be denied.\n\n    \ntrust_home\n:\n \ntrue\n          \n# Trust home country by default (the country where the box is hosted)\n\n    \nforeign_malus\n:\n \n40\n         \n# The number of points added when connecting from a foreign country\n\n    \nunknown_malus\n:\n \n40\n         \n# The number of points added when the country cannot be identified\n\n  \nip\n:\n\n    \nrbl_malus\n:\n \n60\n             \n# The number of points added to the score when an IP address is blacklisted\n\n    \nfail2ban_malus\n:\n \n10\n        \n# Malus to apply each time an IP address has blacklisted by fail2ban\n\n    \ntrust_home\n:\n \ntrue\n          \n# Trust local network by default (e.g. 192.168.1.0/24)\n\n\n\n\n\n\nDo not change the blacklist and whitelist scores, unless you know what you are doing. Due to Posix limitations, the\nmaximum number returned by a script is 255. However, this number is internally evaluated to 1000, to make sure\nwhitelisting an IP address is respected.\n\n\nExample of messages\n\n\nAll messages are sent both by email and using XMPP if the Jabber server has been selected for installation.\n\n\nThis is the content of a message when an unusual connection has been detected. In this first example, the points are\ndetailed, because the system has been configured with the option \ndisplay_score\n to true.\n\n\nIMAP connection warning\n- User: andre (andre@homebox.space)\n- IP Address: 81.17.27.131\n- Source: Roundcube\n- Final score: 60 points\n\nDetails:\n- This IP address is blacklisted 1 times. (+60 points)\n\nIP Details: https://duckduckgo.com/?q=whois+81.17.27.131\n\n\n\n\n\nThe second example, this is a message when a connection has been denied, this time without the point details:\n\n\nIMAP connection denied\n- User: andre (andre@homebox.space)\n- IP Address: 176.63.27.111\n- Source: Roundcube\n\nDetails:\n- This IP address is blacklisted 3 times.\n- Unusual early connection for Europe/Budapest (06:46)\n\nIP Details: https://duckduckgo.com/?q=whois+176.63.27.111\n\n\n\n\n\nLast example, this is a message sent to a user, when the master account is used to access their emails:\n\n\nYour emails are opened by the master user\n- IP Address: 176.63.27.152\n- Access: warning\n- Source: Roundcube\n- Status: warning\n\nIP Details: https://duckduckgo.com/?q=whois+176.63.27.152\n\n\n\n\n\nCustomised access-check.conf\n\n\nThis file will be stored in \n~/.config/homebox/access-check.conf\n\n\n# Access check policy for Homebox\n\n\n\n# I will travel in these countries for a few months\n\n\nCOUNTRIES_TRUST\n=\n'FR,DE,ES'\n\n\n\n# I am travelling, so don't trust home till I come back\n\n\nCOUNTRIES_TRUST_HOME\n=\n'NO'\n\n\n\n\n\n\nMonthly reports\n\n\nThe report can contains the following sections:\n\n\n\n\nConnections per country, if you are travelling.\n\n\nUnknown countries, with the IP addresses identified.\n\n\nWarned and denied connections, with the details of the warnings.\n\n\nLocal access\n\n\nClient statustics (Roundcube / SOGo / IMAP)\n\n\nStatistics per hour of the day\n\n\n\n\nExample of report",
            "title": "Email access monitoring"
        },
        {
            "location": "/email-access-monitoring/#email-access-monitoring",
            "text": "This optional feature is for users who are genuinely concerned about the confidentiality of their emails, and want to be\naware as soon as someone else is opening their emails.  The default settings should be appropriate for most users. However, the users who have unusual habits will be able to\ntune the system according to their needs.   It can send you warning, in real time, when something unusual is happening, which is explained below.  It can block the connection, for instance from blacklisted IP addresses, and send you a warning in real time.  It logs all your connection information in a small database. Each user can then do some querying and reporting easily.  A monthly report is sent the first day of every month, containing the analysis of the previous month.  When the \u201cimpersonate\u201d feature is used to access one user\u2019s emails, an alert is sent in real time to this user.    Note  Real time alerts are sent by email and XMPP, to your account or an external account if configured so.",
            "title": "Email access monitoring"
        },
        {
            "location": "/email-access-monitoring/#scoring-system",
            "text": "When this feature is activated, every time your emails are accessed, a sequence of analysis is executed. Every violation\nof a rule increase a score by a number of points. Above a certain score, a warning is sent. Above another score, the\nconnection is denied.   The scoring system can be easily customised, globally or per user.  Only one warning is sent per day, per connection.  When a connection is denied, email alerts are limited to one per hour.   The default points should be satisfactory for the standard needs, so it is better to tune other parameters, like\nwhitelisting IP addresses or countries.  Any customisation should be done in the Homebox configuration directory  ~/.config/homebox/ .",
            "title": "Scoring system"
        },
        {
            "location": "/email-access-monitoring/#default-settings",
            "text": "Warning score: 40  Deny score: 120",
            "title": "Default settings"
        },
        {
            "location": "/email-access-monitoring/#unusual-behaviours",
            "text": "Unusual behaviours are defined below, from the highest score to the lowest.",
            "title": "Unusual behaviours"
        },
        {
            "location": "/email-access-monitoring/#connection-from-a-blacklisted-ip-address",
            "text": "If you are checking your emails from another place, the system will check the reputation of the IP address, and will\nwarn you if the place is not safe. The software used is  rblcheck . The more an IP\naddress is blacklisted, the more you are likely to receive a warning.  Points: 60 points per blacklist record.  By default, the following lists are checked:   sbl.spamhaus.org  xbl.spamhaus.org  pbl.spamhaus.org  bl.spamcop.net  psbl.surriel.com  dul.dnsbl.sorbs.net    Warning  When an IP address is blacklisted two times, the connection will be denied.",
            "title": "Connection from a blacklisted IP address"
        },
        {
            "location": "/email-access-monitoring/#customisation",
            "text": "If for any reason, you need to connect from an IP address you know is blacklisted, you can whitelist the IP address, by\ncreating a file  ip-whitelist.txt  inside your homebox configuration directory  ~/.config/homebox .  This file can look like this:  # Budapest UPC Magyarorszag Kft:\n176.63.24.0/21\n\n# Swiss ressort\n81.17.27.131  Comments and blank lines are not mandatory and are ignored. You can also whitelist entire networks using CIDR blocks.  Although it is not recommended, you can also change the blacklisting score globally:  access_check : \n   ip :       rbl_malus :   40",
            "title": "Customisation"
        },
        {
            "location": "/email-access-monitoring/#ip-addresses-blacklisted-by-fail2ban",
            "text": "If an IP address has been before blacklisted by fail2ban, a score of 10 will be added per blacklist. So, if an IP\naddress has been banned 5 time in the last log file, the score will be 50 points.  This is a safeguard to ensure a brute force attack against your email account is rejected, even if the password has been\nfound.  If you want to tune this, you can change the fail2ban score to another value, or even to 0 to disable it\nentirely:  access_check : \n   ip :       fail2ban_malus :   5",
            "title": "IP addresses blacklisted by fail2ban"
        },
        {
            "location": "/email-access-monitoring/#connection-from-a-foreign-country",
            "text": "If for instance you are living in France, there is no reason you would connect from China or Russia, except if you are\noften travelling in these countries. In this case, you can add the country code to the list of trusted countries.  You can trust some countries for the whole system, by changing the access_check.countries.trust values:  access_check : \n   countries :       trust :   [   'FR' ,   'DE' ,   'GB' ,   'ES'   ]   If you prefer to do it for one user only you can define a list of \u201ctrusted\u201d countries, in the user\u2019s configuration file.  The user configuration file should be called  access-check.conf , inside the folder  ~/.config/homebox .  # A comma separated list of country codes to trust (e.g. FR,DE,GB)  COUNTRIES_TRUST = 'RU,DE,FR'   For instance, in a family, parents are travelling more than children, so it make more sense to do it per users.",
            "title": "Connection from a foreign country"
        },
        {
            "location": "/email-access-monitoring/#connection-at-unusual-time",
            "text": "This is a minor check, but it helps to warns you, especially when this fact is happening along with other suspicious\nbehaviours. For instance, accessing your emails at midnight, from an IP address that is blacklisted will definitely\ngenerate a warning.  Points: 10 points per hour outside the working hours. For instance, if you defined your working hours from 9am to 6pm, a\nconnection at 2am will generate 70 points, and a warning will be sent.   Note  Warnings are limited to one per day only.   If you have unusual working hours, or if you want to disable this entirely, you can set for instance 0-23. Times are\nspecified in 24h mode.  access_check :     time :       start :   9       end :   22",
            "title": "Connection at unusual time"
        },
        {
            "location": "/email-access-monitoring/#other-considerations",
            "text": "",
            "title": "Other considerations"
        },
        {
            "location": "/email-access-monitoring/#connections-from-lan",
            "text": "Connections from your local network are actually trusted, but logged. Other scripts might be added later to offer more\ncontrol.",
            "title": "Connections from LAN"
        },
        {
            "location": "/email-access-monitoring/#blacklisting-countries",
            "text": "You can blacklist entire countries, but system wide only for now.  For instance, here how to deny all IMAP connections, on the whole system, to Russia and China:  access_check : \n   countries : \n     blacklist :   [   'RU' ,   'CN'   ]",
            "title": "Blacklisting countries"
        },
        {
            "location": "/email-access-monitoring/#customising-the-alert-address",
            "text": "By defaults, the alerts will be sent to the postmaster  and  the user under attack, using both email and XMPP.  You can also use an external email address, by specifying the address globally, in the system.yml file:  access_check : \n   ...     alert_address :   john.doe@protonmail.com     ...   Finally, this can be done per user as well, by modifying the  access-check.conf  file, inside the folder ~/.config/homebox :  # Send alerts and XMPP warnings to an external address:  ALERT_ADDRESS = 'other@protonmail.com'   It is advised to use an external address, to be sure a compromised account cannot be cleared from its alerts.",
            "title": "Customising the alert address"
        },
        {
            "location": "/email-access-monitoring/#detailed-settings",
            "text": "These settings are visible in the defaults.yml file, in the repository:  access_check_default : \n   active :   false \n   whitelist_bonus :   255          # Bonus to apply when an IP or country is whitelisted. Max value is 255 \n   blacklist_malus :   255          # Malus to apply when an IP or country is blacklisted. Max value is 255 \n   warning_score :   40             # Score threshold to generate a warning \n   denied_score :   120             # Score threshold to deny a connection \n   display_score :   false          # # Should we display the scores in the alerts ? \n                               # It is more informative for development \n                               # but it might be confusing for new users \n   time :                         # Standard time range you are normally checking your emails. \n     zone :   auto                  # The timezone to consider when checking the access time. \n     start :   8                    # start-end:  the more you are outside this range, the more malus points \n     end :   18                     #   are added. 10 points per hour outside the range \n                               #   Perhaps this will generate one warning if you check your emails \n                               #   from home at midnight or at 2am. \n   countries :                    # Countries check parameters \n     trust :   []                   # A list of additional countries to trust, i.e. that will not generate points. \n                               #   However, other restrictions are still applying (e.g. blacklisted IP address) \n     blacklist :   []               # A list of blacklisted countries. Connections from these countries will be denied. \n     trust_home :   true            # Trust home country by default (the country where the box is hosted) \n     foreign_malus :   40           # The number of points added when connecting from a foreign country \n     unknown_malus :   40           # The number of points added when the country cannot be identified \n   ip : \n     rbl_malus :   60               # The number of points added to the score when an IP address is blacklisted \n     fail2ban_malus :   10          # Malus to apply each time an IP address has blacklisted by fail2ban \n     trust_home :   true            # Trust local network by default (e.g. 192.168.1.0/24)   Do not change the blacklist and whitelist scores, unless you know what you are doing. Due to Posix limitations, the\nmaximum number returned by a script is 255. However, this number is internally evaluated to 1000, to make sure\nwhitelisting an IP address is respected.",
            "title": "Detailed settings"
        },
        {
            "location": "/email-access-monitoring/#example-of-messages",
            "text": "All messages are sent both by email and using XMPP if the Jabber server has been selected for installation.  This is the content of a message when an unusual connection has been detected. In this first example, the points are\ndetailed, because the system has been configured with the option  display_score  to true.  IMAP connection warning\n- User: andre (andre@homebox.space)\n- IP Address: 81.17.27.131\n- Source: Roundcube\n- Final score: 60 points\n\nDetails:\n- This IP address is blacklisted 1 times. (+60 points)\n\nIP Details: https://duckduckgo.com/?q=whois+81.17.27.131  The second example, this is a message when a connection has been denied, this time without the point details:  IMAP connection denied\n- User: andre (andre@homebox.space)\n- IP Address: 176.63.27.111\n- Source: Roundcube\n\nDetails:\n- This IP address is blacklisted 3 times.\n- Unusual early connection for Europe/Budapest (06:46)\n\nIP Details: https://duckduckgo.com/?q=whois+176.63.27.111  Last example, this is a message sent to a user, when the master account is used to access their emails:  Your emails are opened by the master user\n- IP Address: 176.63.27.152\n- Access: warning\n- Source: Roundcube\n- Status: warning\n\nIP Details: https://duckduckgo.com/?q=whois+176.63.27.152",
            "title": "Example of messages"
        },
        {
            "location": "/email-access-monitoring/#customised-access-checkconf",
            "text": "This file will be stored in  ~/.config/homebox/access-check.conf  # Access check policy for Homebox  # I will travel in these countries for a few months  COUNTRIES_TRUST = 'FR,DE,ES'  # I am travelling, so don't trust home till I come back  COUNTRIES_TRUST_HOME = 'NO'",
            "title": "Customised access-check.conf"
        },
        {
            "location": "/email-access-monitoring/#monthly-reports",
            "text": "The report can contains the following sections:   Connections per country, if you are travelling.  Unknown countries, with the IP addresses identified.  Warned and denied connections, with the details of the warnings.  Local access  Client statustics (Roundcube / SOGo / IMAP)  Statistics per hour of the day",
            "title": "Monthly reports"
        },
        {
            "location": "/email-access-monitoring/#example-of-report",
            "text": "",
            "title": "Example of report"
        },
        {
            "location": "/antispam-rspamd/",
            "text": "Default configuration\n\n\nBy default, the mail server is protected against spam with rspamd.\n\n\nThe web user interface is accessible from the LAN:\n\n\n  \nantispam\n:\n                 \n# Check inbound and outbound emails for virusesyaml\n\n    \nport\n:\n \n33000\n             \n# port to use for the antivirus daemon\n\n    \nwebui\n:\n                  \n# rspamd web interface\n\n      \nactive\n:\n \ntrue\n          \n# Activate or not\n\n      \nallow\n:\n                \n# a list of IP address that can access the web interface\n\n        \n-\n \n192.168.0.0/16\n    \n# RFC1918 local networks\n\n        \n-\n \n172.16.0.0/12\n\n        \n-\n \n10.0.0.0/8\n\n\n\n\n\n\nA strong password is generated for the administrator account. After\nthe deployment, the password is stored in the deployment backup\nfolder, in \nrspamd/admin.pwd\n.",
            "title": "Antispam configuration"
        },
        {
            "location": "/antispam-rspamd/#default-configuration",
            "text": "By default, the mail server is protected against spam with rspamd.  The web user interface is accessible from the LAN:     antispam :                   # Check inbound and outbound emails for virusesyaml \n     port :   33000               # port to use for the antivirus daemon \n     webui :                    # rspamd web interface \n       active :   true            # Activate or not \n       allow :                  # a list of IP address that can access the web interface \n         -   192.168.0.0/16      # RFC1918 local networks \n         -   172.16.0.0/12 \n         -   10.0.0.0/8   A strong password is generated for the administrator account. After\nthe deployment, the password is stored in the deployment backup\nfolder, in  rspamd/admin.pwd .",
            "title": "Default configuration"
        },
        {
            "location": "/jabber-configuration/",
            "text": "Default configuration\n\n\nThe default configuration for the Jabber server comes with the following options:\n\n\n\n\nInstalled by default\n\n\nServer to server communication active and public by default\n\n\nSocks proxy to transfer file\n\n\nHTTP upload for offline file transfer\n\n\n\n\nDefault options for the Jabber server:\n\n\nejabberd\n:\n\n  \ninstall\n:\n \ntrue\n\n  \nallow_contrib_modules\n:\n \nfalse\n\n  \n# Server-to-server communication\n\n  \ns2s\n:\n\n    \nactive\n:\n \ntrue\n\n    \nuse_starttls\n:\n \nrequired_trusted\n\n    \npublic\n:\n \ntrue\n\n    \ntrust\n:\n\n      \n-\n \njabber.org\n\n  \n# https upload module\n\n  \nhttp_upload\n:\n\n    \nport\n:\n \n5443\n\n    \nsecret_length\n:\n \n40\n\n    \nmax_size\n:\n \n104857600\n\n    \nthumbnail\n:\n \ntrue\n\n  \n# direct file transfer\n\n  \nfile_transfer\n:\n\n    \nport\n:\n \n7778\n\n  \n# traffic shaper\n\n  \nshaper\n:\n\n    \nnormal\n:\n \n1000\n\n    \nfast\n:\n \n50000\n\n    \nproxyrate\n:\n \n10240\n \n# file transfer proxy\n\n\n\n\n\n\nCertificates created\n\n\nTwo certificates are created to ensure proper communication with clients and other servers.\n\n\n\n\n\n\n\n\nRecord\n\n\nType\n\n\nPurpose\n\n\nExample\n\n\n\n\n\n\n\n\n\n\n@\n\n\nA\n\n\nDefault certificate used by the server\n\n\nhomebox.space\n\n\n\n\n\n\nxmpp\n\n\nA\n\n\nHandle file transfer over https\n\n\nxmpp.homebox.space\n\n\n\n\n\n\nconference\n\n\nA\n\n\nS2S conference public URL\n\n\nconference.homebox.space\n\n\n\n\n\n\n\n\nFine tuning\n\n\nDisabling server to server communication\n\n\nTo disable s2s communication, set the flag install to false:\n\n\nejabberd\n:\n\n  \ninstall\n:\n \ntrue\n\n  \nallow_contrib_modules\n:\n \nfalse\n\n  \n# Server-to-server communication\n\n\n  \ns2s\n:\n\n\n    \nactive\n:\n \nfalse\n\n\n\n\n\n\nRestrict access to only a few servers\n\n\nYou can restrict access to a few trusted domains, for instance:\n\n\nejabberd\n:\n\n  \ninstall\n:\n \ntrue\n\n  \nallow_contrib_modules\n:\n \nfalse\n\n  \n# Server-to-server communication\n\n  \ns2s\n:\n\n    \nactive\n:\n \ntrue\n\n    \nuse_starttls\n:\n \nrequired_trusted\n\n    \npublic\n:\n \nfalse\n\n\n    \ntrust\n:\n\n\n      \n-\n \njabber.org\n\n\n      \n-\n \nexemple.com\n\n\n\n\n\n\nTraffic shapper\n\n\nThe traffic shapper values are useful to limit the bandwidth, especially during file transfers:\n\n\nejabberd\n:\n\n  \nshaper\n:\n\n    \nnormal\n:\n \n1000\n\n    \nfast\n:\n \n50000\n\n    \nproxyrate\n:\n \n10240\n \n# file transfer proxy\n\n\n\n\n\n\nThe values are in bytes per second.",
            "title": "Jabber configuration"
        },
        {
            "location": "/jabber-configuration/#default-configuration",
            "text": "The default configuration for the Jabber server comes with the following options:   Installed by default  Server to server communication active and public by default  Socks proxy to transfer file  HTTP upload for offline file transfer   Default options for the Jabber server:  ejabberd : \n   install :   true \n   allow_contrib_modules :   false \n   # Server-to-server communication \n   s2s : \n     active :   true \n     use_starttls :   required_trusted \n     public :   true \n     trust : \n       -   jabber.org \n   # https upload module \n   http_upload : \n     port :   5443 \n     secret_length :   40 \n     max_size :   104857600 \n     thumbnail :   true \n   # direct file transfer \n   file_transfer : \n     port :   7778 \n   # traffic shaper \n   shaper : \n     normal :   1000 \n     fast :   50000 \n     proxyrate :   10240   # file transfer proxy",
            "title": "Default configuration"
        },
        {
            "location": "/jabber-configuration/#certificates-created",
            "text": "Two certificates are created to ensure proper communication with clients and other servers.     Record  Type  Purpose  Example      @  A  Default certificate used by the server  homebox.space    xmpp  A  Handle file transfer over https  xmpp.homebox.space    conference  A  S2S conference public URL  conference.homebox.space",
            "title": "Certificates created"
        },
        {
            "location": "/jabber-configuration/#fine-tuning",
            "text": "",
            "title": "Fine tuning"
        },
        {
            "location": "/jabber-configuration/#disabling-server-to-server-communication",
            "text": "To disable s2s communication, set the flag install to false:  ejabberd : \n   install :   true \n   allow_contrib_modules :   false \n   # Server-to-server communication     s2s :       active :   false",
            "title": "Disabling server to server communication"
        },
        {
            "location": "/jabber-configuration/#restrict-access-to-only-a-few-servers",
            "text": "You can restrict access to a few trusted domains, for instance:  ejabberd : \n   install :   true \n   allow_contrib_modules :   false \n   # Server-to-server communication \n   s2s : \n     active :   true \n     use_starttls :   required_trusted \n     public :   false       trust :         -   jabber.org         -   exemple.com",
            "title": "Restrict access to only a few servers"
        },
        {
            "location": "/jabber-configuration/#traffic-shapper",
            "text": "The traffic shapper values are useful to limit the bandwidth, especially during file transfers:  ejabberd : \n   shaper : \n     normal :   1000 \n     fast :   50000 \n     proxyrate :   10240   # file transfer proxy   The values are in bytes per second.",
            "title": "Traffic shapper"
        },
        {
            "location": "/gogs-configuration/",
            "text": "Default configuration\n\n\nThe default configuration for the Gogs server comes with the following options:\n\n\n\n\nNot installed by default\n\n\nURL not public by default, only accessible from a local network\n\n\n\n\nDefault options for the Gogs server:\n\n\ngogs\n:\n\n\n  \ninstall\n:\n \nfalse\n\n\n  \npublic\n:\n \nfalse\n         \n# not open to public by default\n\n  \nallow\n:\n                \n# a list of IP address that can access the web interface\n\n    \n-\n \n192.168.0.0/16\n    \n# RFC1918 local networks\n\n    \n-\n \n172.16.0.0/12\n\n    \n-\n \n10.0.0.0/8\n\n\n\n\n\n\nBy default, the gogs server is not installed.\nIf you install the git server, you can choose to restrict it to your local network (by default),\nor to make your git repository public.\n\n\nCertificates created\n\n\nTwo certificates are created to ensure proper communication with clients and other servers.\n\n\n\n\n\n\n\n\nRecord\n\n\nType\n\n\nPurpose\n\n\nExample\n\n\n\n\n\n\n\n\n\n\ngogs\n\n\nA\n\n\nHandle repository access over https\n\n\ngogs.homebox.space",
            "title": "Gogs configuration"
        },
        {
            "location": "/gogs-configuration/#default-configuration",
            "text": "The default configuration for the Gogs server comes with the following options:   Not installed by default  URL not public by default, only accessible from a local network   Default options for the Gogs server:  gogs :     install :   false     public :   false           # not open to public by default \n   allow :                  # a list of IP address that can access the web interface \n     -   192.168.0.0/16      # RFC1918 local networks \n     -   172.16.0.0/12 \n     -   10.0.0.0/8   By default, the gogs server is not installed.\nIf you install the git server, you can choose to restrict it to your local network (by default),\nor to make your git repository public.",
            "title": "Default configuration"
        },
        {
            "location": "/gogs-configuration/#certificates-created",
            "text": "Two certificates are created to ensure proper communication with clients and other servers.     Record  Type  Purpose  Example      gogs  A  Handle repository access over https  gogs.homebox.space",
            "title": "Certificates created"
        },
        {
            "location": "/tor-privoxy-configuration/",
            "text": "The \nOnion Router\n Tor, can be installed, along with \nPrivoxy\n, in a very simplistic configuration.\nPrivoxy is a free non-caching web proxy with filtering capabilities for enhancing privacy.\n\n\nIt provides a basic privacy protection, alongside wih some browsers extensions. More information on\nthis page: \nhttps://restoreprivacy.com/firefox-privacy/\n.\n\n\nYou may also want to select an alternative search engine like \nDuckDuckGo\n.\n\n\nMinimal configuration\n\n\n# Secure / Anonymous proxy\n\n\ntor\n:\n\n  \ninstall\n:\n \ntrue\n\n\n\nprivoxy\n:\n\n  \ninstall\n:\n \ntrue\n\n\n\n\n\n\nPrivoxy adblock lists synchronisation\n\n\nprivoxy\n:\n\n  \ninstall\n:\n \ntrue\n\n  \ntor_forward\n:\n \ntrue\n\n\n  \nadblock_rules\n:\n\n\n    \ninstall\n:\n \ntrue\n\n\n    \nlist\n:\n\n\n      \n-\n \nhttps://easylist.to/easylist/easylist.txt\n\n\n      \n-\n \nhttps://easylist.to/easylist/easyprivacy.txt\n\n\n      \n-\n \nhttps://easylist.to/easylist/fanboy-annoyance.txt\n\n\n      \n-\n \nhttps://easylist.to/easylist/fanboy-social.txt\n\n\n      \n-\n \nhttps://easylist-downloads.adblockplus.org/liste_fr.txt\n\n\n\n\n\n\nThe privoxy server can be synchronised daily with easylists networks, to protect both your privacy\nand your network bandwidth. The default rules are:\n\n\nEasyList\n\n\nEasyList is the primary filter list that removes most adverts from international webpages, including\nunwanted frames, images and objects. It is the most popular list used by many ad blockers and forms\nthe basis of over a dozen combination and supplementary filter lists.\n\n\nEasyPrivacy\n\n\nEasyPrivacy is an optional supplementary filter list that completely removes all forms of tracking\nfrom the internet, including web bugs, tracking scripts and information collectors, thereby\nprotecting your personal data.\n\n\nFanboy\u2019s Annoyance List\n\n\nFanboy\u2019s Annoyance List blocks Social Media content, in-page pop-ups and other annoyances; thereby\nsubstantially decreasing web page loading times and uncluttering them. Fanboy\u2019s Social Blocking List\nis already included, there is no need to subscribe to it if you already have Fanboy\u2019s Annoyance\nList.\n\n\nFanboy\u2019s Social Blocking List\n\n\nFanboy\u2019s Social Blocking List solely removes Social Media content on web pages such as the Facebook\nlike button and other widgets.\n\n\nOther filter Lists and variants\n\n\nOther lists can be downloaded on the easylist web site: \nsupplementary filter lists and variants\npage\n.\n\n\nDefault configuration\n\n\nThe configuration actually installed is the default one on Debian, but you can easily customise it using the standard\nTor or Privoxy options. Tor is not accessible externally. Privoxy is listening on port 8118, on the LAN by default.\n\n\n# The onion router\n\n\ntor\n:\n\n  \ninstall\n:\n \nfalse\n\n  \nport\n:\n \n9050\n\n  \naccept_from\n:\n\n    \n-\n \n127.0.0.1\n\n\n\n# Privoxy privacy proxy\n\n\nprivoxy\n:\n\n  \ninstall\n:\n \nfalse\n\n  \ntor_forward\n:\n \nfalse\n\n  \nport\n:\n \n8118\n\n  \naccept_from\n:\n\n    \n-\n \n10.0.0.0/8\n\n    \n-\n \n192.168.0.0/16\n\n    \n-\n \n172.16.0.0/20\n\n  \nadblock_rules\n:\n\n    \ninstall\n:\n \ntrue\n\n    \nlist\n:\n\n      \n-\n \nhttps://easylist.to/easylist/easylist.txt\n\n      \n-\n \nhttps://easylist.to/easylist/easyprivacy.txt\n\n      \n-\n \nhttps://easylist.to/easylist/fanboy-annoyance.txt\n\n      \n-\n \nhttps://easylist.to/easylist/fanboy-social.txt\n\n\n  \ncustom_settings\n:\n \n|\n\n\n    \n# Put anything you want here,\n\n\n    \n# even on multiple lines\n\n\n\n\n\n\nChaining privoxy and Tor\n\n\nIt is possible to chain privoxy and tor, to use both proxies at the same time. If you have activated the easyprivacy\nlist of privoxy, this will give you a good anonymous and privacy filter, even for devices that don\u2019t support Tor or\nSOCKS proxy natively. For instance:\n\n\nprivoxy\n:\n\n  \ninstall\n:\n \ntrue\n\n\n  \ntor_forward\n:\n \ntrue",
            "title": "Tor / privoxy configuration"
        },
        {
            "location": "/tor-privoxy-configuration/#minimal-configuration",
            "text": "# Secure / Anonymous proxy  tor : \n   install :   true  privoxy : \n   install :   true",
            "title": "Minimal configuration"
        },
        {
            "location": "/tor-privoxy-configuration/#privoxy-adblock-lists-synchronisation",
            "text": "privoxy : \n   install :   true \n   tor_forward :   true     adblock_rules :       install :   true       list :         -   https://easylist.to/easylist/easylist.txt         -   https://easylist.to/easylist/easyprivacy.txt         -   https://easylist.to/easylist/fanboy-annoyance.txt         -   https://easylist.to/easylist/fanboy-social.txt         -   https://easylist-downloads.adblockplus.org/liste_fr.txt   The privoxy server can be synchronised daily with easylists networks, to protect both your privacy\nand your network bandwidth. The default rules are:  EasyList  EasyList is the primary filter list that removes most adverts from international webpages, including\nunwanted frames, images and objects. It is the most popular list used by many ad blockers and forms\nthe basis of over a dozen combination and supplementary filter lists.  EasyPrivacy  EasyPrivacy is an optional supplementary filter list that completely removes all forms of tracking\nfrom the internet, including web bugs, tracking scripts and information collectors, thereby\nprotecting your personal data.  Fanboy\u2019s Annoyance List  Fanboy\u2019s Annoyance List blocks Social Media content, in-page pop-ups and other annoyances; thereby\nsubstantially decreasing web page loading times and uncluttering them. Fanboy\u2019s Social Blocking List\nis already included, there is no need to subscribe to it if you already have Fanboy\u2019s Annoyance\nList.  Fanboy\u2019s Social Blocking List  Fanboy\u2019s Social Blocking List solely removes Social Media content on web pages such as the Facebook\nlike button and other widgets.",
            "title": "Privoxy adblock lists synchronisation"
        },
        {
            "location": "/tor-privoxy-configuration/#other-filter-lists-and-variants",
            "text": "Other lists can be downloaded on the easylist web site:  supplementary filter lists and variants\npage .",
            "title": "Other filter Lists and variants"
        },
        {
            "location": "/tor-privoxy-configuration/#default-configuration",
            "text": "The configuration actually installed is the default one on Debian, but you can easily customise it using the standard\nTor or Privoxy options. Tor is not accessible externally. Privoxy is listening on port 8118, on the LAN by default.  # The onion router  tor : \n   install :   false \n   port :   9050 \n   accept_from : \n     -   127.0.0.1  # Privoxy privacy proxy  privoxy : \n   install :   false \n   tor_forward :   false \n   port :   8118 \n   accept_from : \n     -   10.0.0.0/8 \n     -   192.168.0.0/16 \n     -   172.16.0.0/20 \n   adblock_rules : \n     install :   true \n     list : \n       -   https://easylist.to/easylist/easylist.txt \n       -   https://easylist.to/easylist/easyprivacy.txt \n       -   https://easylist.to/easylist/fanboy-annoyance.txt \n       -   https://easylist.to/easylist/fanboy-social.txt     custom_settings :   |       # Put anything you want here,       # even on multiple lines",
            "title": "Default configuration"
        },
        {
            "location": "/tor-privoxy-configuration/#chaining-privoxy-and-tor",
            "text": "It is possible to chain privoxy and tor, to use both proxies at the same time. If you have activated the easyprivacy\nlist of privoxy, this will give you a good anonymous and privacy filter, even for devices that don\u2019t support Tor or\nSOCKS proxy natively. For instance:  privoxy : \n   install :   true     tor_forward :   true",
            "title": "Chaining privoxy and Tor"
        },
        {
            "location": "/firewall-configuration/",
            "text": "Default firewall configuration\n\n\n###############################################################################\n\n\n# Once the system is in place, it is possible to use 'limit' for the rule,\n\n\n# instead of allow. It is also possible to use fail2ban, which is installed anyway\n\n\n# You can have as many sources as you want, with a comment to easily keep track\n\n\n# of your rules\n\n\nfirewall\n:\n\n  \nfwknop\n:\n\n    \ninstall\n:\n \nfalse\n\n    \nport\n:\n \nrandom\n\n  \nssh\n:\n\n    \n-\n \nsrc\n:\n \nany\n\n      \nrule\n:\n \nallow\n\n      \ncomment\n:\n \nallow SSH from anywhere\n\n  \noutput\n:\n\n    \npolicy\n:\n \ndeny\n\n    \nrules\n:\n\n      \n-\n \ndest\n:\n \nany\n\n        \nport\n:\n \n80,443\n\n        \ncomment\n:\n \n'Allow\n \nweb\n \naccess'\n\n      \n-\n \ndest\n:\n \nany\n\n        \nproto\n:\n \nudp\n\n        \nport\n:\n \n53\n\n        \ncomment\n:\n \n'Allow\n \nDNS\n \nrequests'\n\n      \n-\n \ndest\n:\n \nany\n\n        \nproto\n:\n \nudp\n\n        \nport\n:\n \n123\n\n        \ncomment\n:\n \n'Allow\n \nNTP\n \nrequests'\n\n      \n-\n \ndest\n:\n \nany\n\n        \nproto\n:\n \nudp\n\n        \nfrom_port\n:\n \n68\n\n        \nport\n:\n \n67\n\n        \ncomment\n:\n \n'Allow\n \nDHCP\n \nrequests'\n\n      \n-\n \ndest\n:\n \nany\n\n        \nport\n:\n \n25\n\n        \ncomment\n:\n \n'Allow\n \nSMTP\n \nconnections\n \nto\n \nother\n \nservers'\n\n      \n-\n \ndest\n:\n \nany\n\n        \nport\n:\n \n110,995,143,993\n\n        \ncomment\n:\n \n'Allow\n \nthe\n \nretrieval\n \nof\n \nemails\n \nfrom\n \nother\n \nservers\n \n(POP/IMAP)'\n\n\n\n\n\n\nSingle Packet Authorization\n\n\nThis method of authorization is based around a default-drop packet filter and libpcap. SPA is essentially next\ngeneration port knocking.\n\n\nThe fwknop client runs on Linux, Mac OS X, *BSD, and Windows.  In addition, there is a port of the client to both the\niPhone and Android phones.\n\n\n\n\nSupports HMAC authenticated encryption for both Rijndael and GnuPG. The order of operation is\n  encrypt-then-authenticate to avoid various cryptanalytic problems.\n\n\nReplay attacks are detected and thwarted by SHA-256 digest comparison of valid incoming SPA packets. SHA-1 and MD5 are\n  also supported, but SHA-256 is the default.\n\n\nSPA packets are passively sniffed from the wire via libpcap. The fwknop server can also acquire packet data from a\n  file that is written to by a separate Ethernet sniffer (such as with \u201ctcpdump -w <file>\u201c), or from the iptables ULOG\n  pcap writer.\n\n\nFor iptables firewalls, ACCEPT rules added by fwknop are added and deleted (after a configurable timeout) from custom\n  iptables chains so that fwknop does not interfere with any existing iptables policy.\n\n\n\n\n\n\nWarning\n\n\nIf you don\u2019t know what are you doing, be very careful, because one mistake will cause your SSH gone for good and\nthere will no chance how to manage your server.\n\n\n\n\nMore features detailed on the \nfwknop features page\n.\n\n\nConfiguration examples\n\n\nAlow direct SSH access from the local network, use fwknop otherwise. Monitor only queries sent to port number 33001.\n\n\n# Allow SSH only from the LAN, otherwise use fwknop\n\n\nfirewall\n:\n\n\n  \nfwknop\n:\n\n\n    \ninstall\n:\n \ntrue\n\n\n    \nnic\n:\n \nenp3s0\n\n\n    \nport\n:\n \n33001\n\n\n  \nssh\n:\n\n    \n-\n \nsrc\n:\n \n192.168.42.0/24\n\n      \nrule\n:\n \nallow\n\n      \ncomment\n:\n \nallow SSH from the LAN only\n\n\n\n\n\n\nOnly allow SSH access using fwknop.  Allow to send the query to a random port number, between 10000 and 65535 by\ndefault.\n\n\n# Allow SSH only from the LAN, otherwise use spa fwknopd\n\n\nfirewall\n:\n\n\n  \nfwknop\n:\n\n\n    \ninstall\n:\n \ntrue\n\n\n    \nnic\n:\n \neth0\n\n\n  \nssh\n:\n\n    \n-\n \nsrc\n:\n \nany\n\n      \nrule\n:\n \ndeny\n\n      \ncomment\n:\n \nDo not allow SSH access except with fwknop\n\n\n\n\n\n\nDefault configuration\n\n\nfirewall_default\n:\n\n  \nfwknop\n:\n\n    \ninstall\n:\n \nfalse\n\n    \nnic\n:\n \n'{{\n \nansible_default_ipv4.interface\n \n}}'\n\n    \nport\n:\n \nrandom\n\n  \nssh\n:\n\n    \n-\n \nsrc\n:\n \nany\n\n      \nrule\n:\n \nallow\n\n      \ncomment\n:\n \nallow SSH from anywhere\n\n\n\n\n\n\nKeys backup\n\n\nWhen running the installation script, fwnkop credentials are stored in\nyour home folder, in a file named after your domain, like ~/.fwknop-main.\n.rc,\n(e.g. ~/.fwknop-main.homebox.space.rc.)\nA backup is copied in your installation backup folder, \nfwknop/fwknoprc\n.\n\n\nHere an example:\n\n\n[default]\n\n\n\n[main.homebox.space]\n\n\nACCESS                      tcp/22\n\n\nSPA_SERVER                  main.homebox.space\n\n\nKEY_BASE64                  TD/Tudvg9IIdS8DYAxDFYYqL6qlRR7N0F7PSWb6QSqo\n=\n\n\nHMAC_KEY_BASE64             mf1D7dIf2mMqgvnmeB8EosVDIEMlbHqJ1oKnW4TMmVWh4G7LHBbNzkBDvI+vw3f7TtdJYkYEjpc3JrHgA0QXYw\n=\n=\n\n\nUSE_HMAC                    Y\n\n\n\n\n\n\nKnocking your server\n\n\nOn Linux\n\n\nAccessing your server, from the LAN or outside is slighly different\n\n\nFrom the LAN, you can specify local IP address, here 192.168.66.33,\nand the remote IP address, 192.168.66.1. For instance:\n\n\nfwknop -v --rc-file ~/.fwknop-homebox.space.rc -a \n192\n.168.66.33 -n main.homebox.space -D \n192\n.168.66.1\nssh \n192\n.168.66.1\n\n\n\n\n\nFrom outside, you can use the automatic IP address lookup of www.cipherdyne.org:\n\n\nfwknop -v --rc-file ~/.fwknop-homebox.space.rc -R --wget-cmd /usr/bin/wget -n main.homebox.space\nssh main.homebox.space\n\n\n\n\n\nOn Android\n\n\nYou can also \u2018knock\u2019 your server from Android, using the excellent\n\nfwknop2 package\n.\n\n\nThe configuration is simple, see the example: \nandroid client example\n\n\nAdvanced\n\n\nAutomatically knocking your server before connecting\n\n\nWhile you can do this with a script, it is nicer to use the SSH ProxyCommand integration.\nFor instance, you can use this configuration on your \n~/.ssh/config\n:\n\n\nHost homebox.space\n  User root\n  ProxyCommand sh -c \"fwknop -R -D main.homebox.space --rc-file ~/.fwknop-homebox.space.rc -n main.homebox.space ; /bin/nc %h %p\"\n\n\n\n\n\nUsing the port knoker with Ansible\n\n\nIt is possible to use fwknop during the development phase.\nIn this case, you should use fwknop client to knock the server, before the SSH connection.\n\n\nHopefully, homebox comes with a fwknop connection plugin for Ansible, ready to use.\nThere are two modifications to make:\n\n\nThe host file, specify the fwknop parameters:\n\n\nall\n:\n\n  \nhosts\n:\n\n    \nhomebox\n:\n\n      \nansible_host\n:\n \nhomebox.example.home\n\n      \nansible_user\n:\n \nroot\n\n      \nansible_port\n:\n \n22\n\n      \n# special parameters when using fwknop port knocking\n\n      \nfwknop_src\n:\n \n192.168.14.55\n   \n# or 'auto' when connecting to a remote host over internet.\n\n      \nfwknop_config_name\n:\n \nmain.example.home\n\n      \nfwknop_dest\n:\n \nmain.example.home\n\n      \nfwknop_rc_file\n:\n \n/home/andre/.fwknop-example.home.rc\n\n      \nfwknop_verbose\n:\n \ntrue\n\n\n\n\n\n\nSee the file \nconfig/hosts-fwknop-example.yml\n for a complete list of possible options.\n\n\nThen, when running ansible, use the \n-c\n parameter to specify the connection method, and use \u2018ssh_fwknop\u2019.\nThe source code is in \ncommon/connection_plugins\n.\n\n\nansible-playbook -c ssh_fwknop -vvv -i ../config/hosts.yml playbooks/fwknop-server.yml\n\n\n\n\n\nWith the following output, for instance:\n\n\n$ ansible-playbook -c ssh_fwknop -vvv -i ../config/hosts.yml playbooks/fwknop-server.yml\nansible-playbook \n2\n.6.3\n  config \nfile\n \n=\n /home/andre/Projects/homebox/install/ansible.cfg\n  configured module search \npath\n \n=\n \n[\nu\n'/home/andre/.ansible/plugins/modules'\n, u\n'/usr/share/ansible/plugins/modules'\n]\n\n  ansible python module \nlocation\n \n=\n /usr/lib/python2.7/dist-packages/ansible\n  executable \nlocation\n \n=\n /usr/bin/ansible-playbook\n  python \nversion\n \n=\n \n2\n.7.13 \n(\ndefault, Sep \n26\n \n2018\n, \n18\n:42:22\n)\n \n[\nGCC \n6\n.3.0 \n20170516\n]\n\nUsing /home/andre/Projects/homebox/install/ansible.cfg as config file\nParsed /home/andre/Projects/homebox/config/hosts.yml inventory \nsource\n with yaml plugin\nRead vars_file \n'{{ playbook_dir }}/../../config/system.yml'\n\nRead vars_file \n'{{ playbook_dir }}/../../config/defaults.yml'\n\n\nPLAYBOOK: fwknop-server.yml ********************************\n\n1\n plays in playbooks/fwknop-server.yml\nRead vars_file \n'{{ playbook_dir }}/../../config/system.yml'\n\nRead vars_file \n'{{ playbook_dir }}/../../config/defaults.yml'\n\n\nPLAY \n[\nhomebox\n]\n *********************************************\nRead vars_file \n'{{ playbook_dir }}/../../config/system.yml'\n\nRead vars_file \n'{{ playbook_dir }}/../../config/defaults.yml'\n\n\nTASK \n[\nGathering Facts\n]\n *************************************\ntask path: /home/andre/Projects/homebox/install/playbooks/fwknop-server.yml:4\n<\n192\n.168.63.100> ssh_fwknop connection plugin is used \nfor\n this host\nRunning \n'\n/usr/bin/fwknop -v -a \n192\n.168.64.55 -D main.homebox.space --rc-file /home/andre/.fwknop-homebox.space.rc -n main.homebox.space\nSPA Field Values:\n\n=================\n\n   Random Value: \n4839788853776469\n\n       Username: andre\n      Timestamp: \n1540127737\n\n    FKO Version: \n3\n.0.0\n   Message Type: \n1\n \n(\nAccess msg\n)\n\n Message String: \n192\n.168.64.55,tcp/22\n     Nat Access: <NULL>\n    Server Auth: <NULL>\n Client Timeout: \n0\n\n    Digest Type: \n3\n \n(\nSHA256\n)\n\n      HMAC Type: \n3\n \n(\nSHA256\n)\n\nEncryption Type: \n1\n \n(\nRijndael\n)\n\nEncryption Mode: \n2\n \n(\nCBC\n)\n\n...",
            "title": "Firewall configuration"
        },
        {
            "location": "/firewall-configuration/#default-firewall-configuration",
            "text": "###############################################################################  # Once the system is in place, it is possible to use 'limit' for the rule,  # instead of allow. It is also possible to use fail2ban, which is installed anyway  # You can have as many sources as you want, with a comment to easily keep track  # of your rules  firewall : \n   fwknop : \n     install :   false \n     port :   random \n   ssh : \n     -   src :   any \n       rule :   allow \n       comment :   allow SSH from anywhere \n   output : \n     policy :   deny \n     rules : \n       -   dest :   any \n         port :   80,443 \n         comment :   'Allow   web   access' \n       -   dest :   any \n         proto :   udp \n         port :   53 \n         comment :   'Allow   DNS   requests' \n       -   dest :   any \n         proto :   udp \n         port :   123 \n         comment :   'Allow   NTP   requests' \n       -   dest :   any \n         proto :   udp \n         from_port :   68 \n         port :   67 \n         comment :   'Allow   DHCP   requests' \n       -   dest :   any \n         port :   25 \n         comment :   'Allow   SMTP   connections   to   other   servers' \n       -   dest :   any \n         port :   110,995,143,993 \n         comment :   'Allow   the   retrieval   of   emails   from   other   servers   (POP/IMAP)'",
            "title": "Default firewall configuration"
        },
        {
            "location": "/firewall-configuration/#single-packet-authorization",
            "text": "This method of authorization is based around a default-drop packet filter and libpcap. SPA is essentially next\ngeneration port knocking.  The fwknop client runs on Linux, Mac OS X, *BSD, and Windows.  In addition, there is a port of the client to both the\niPhone and Android phones.   Supports HMAC authenticated encryption for both Rijndael and GnuPG. The order of operation is\n  encrypt-then-authenticate to avoid various cryptanalytic problems.  Replay attacks are detected and thwarted by SHA-256 digest comparison of valid incoming SPA packets. SHA-1 and MD5 are\n  also supported, but SHA-256 is the default.  SPA packets are passively sniffed from the wire via libpcap. The fwknop server can also acquire packet data from a\n  file that is written to by a separate Ethernet sniffer (such as with \u201ctcpdump -w <file>\u201c), or from the iptables ULOG\n  pcap writer.  For iptables firewalls, ACCEPT rules added by fwknop are added and deleted (after a configurable timeout) from custom\n  iptables chains so that fwknop does not interfere with any existing iptables policy.    Warning  If you don\u2019t know what are you doing, be very careful, because one mistake will cause your SSH gone for good and\nthere will no chance how to manage your server.   More features detailed on the  fwknop features page .",
            "title": "Single Packet Authorization"
        },
        {
            "location": "/firewall-configuration/#configuration-examples",
            "text": "Alow direct SSH access from the local network, use fwknop otherwise. Monitor only queries sent to port number 33001.  # Allow SSH only from the LAN, otherwise use fwknop  firewall :     fwknop :       install :   true       nic :   enp3s0       port :   33001     ssh : \n     -   src :   192.168.42.0/24 \n       rule :   allow \n       comment :   allow SSH from the LAN only   Only allow SSH access using fwknop.  Allow to send the query to a random port number, between 10000 and 65535 by\ndefault.  # Allow SSH only from the LAN, otherwise use spa fwknopd  firewall :     fwknop :       install :   true       nic :   eth0     ssh : \n     -   src :   any \n       rule :   deny \n       comment :   Do not allow SSH access except with fwknop",
            "title": "Configuration examples"
        },
        {
            "location": "/firewall-configuration/#default-configuration",
            "text": "firewall_default : \n   fwknop : \n     install :   false \n     nic :   '{{   ansible_default_ipv4.interface   }}' \n     port :   random \n   ssh : \n     -   src :   any \n       rule :   allow \n       comment :   allow SSH from anywhere",
            "title": "Default configuration"
        },
        {
            "location": "/firewall-configuration/#keys-backup",
            "text": "When running the installation script, fwnkop credentials are stored in\nyour home folder, in a file named after your domain, like ~/.fwknop-main. .rc,\n(e.g. ~/.fwknop-main.homebox.space.rc.)\nA backup is copied in your installation backup folder,  fwknop/fwknoprc .  Here an example:  [default]  [main.homebox.space]  ACCESS                      tcp/22  SPA_SERVER                  main.homebox.space  KEY_BASE64                  TD/Tudvg9IIdS8DYAxDFYYqL6qlRR7N0F7PSWb6QSqo =  HMAC_KEY_BASE64             mf1D7dIf2mMqgvnmeB8EosVDIEMlbHqJ1oKnW4TMmVWh4G7LHBbNzkBDvI+vw3f7TtdJYkYEjpc3JrHgA0QXYw = =  USE_HMAC                    Y",
            "title": "Keys backup"
        },
        {
            "location": "/firewall-configuration/#knocking-your-server",
            "text": "",
            "title": "Knocking your server"
        },
        {
            "location": "/firewall-configuration/#on-linux",
            "text": "Accessing your server, from the LAN or outside is slighly different  From the LAN, you can specify local IP address, here 192.168.66.33,\nand the remote IP address, 192.168.66.1. For instance:  fwknop -v --rc-file ~/.fwknop-homebox.space.rc -a  192 .168.66.33 -n main.homebox.space -D  192 .168.66.1\nssh  192 .168.66.1  From outside, you can use the automatic IP address lookup of www.cipherdyne.org:  fwknop -v --rc-file ~/.fwknop-homebox.space.rc -R --wget-cmd /usr/bin/wget -n main.homebox.space\nssh main.homebox.space",
            "title": "On Linux"
        },
        {
            "location": "/firewall-configuration/#on-android",
            "text": "You can also \u2018knock\u2019 your server from Android, using the excellent fwknop2 package .  The configuration is simple, see the example:  android client example",
            "title": "On Android"
        },
        {
            "location": "/firewall-configuration/#advanced",
            "text": "",
            "title": "Advanced"
        },
        {
            "location": "/firewall-configuration/#automatically-knocking-your-server-before-connecting",
            "text": "While you can do this with a script, it is nicer to use the SSH ProxyCommand integration.\nFor instance, you can use this configuration on your  ~/.ssh/config :  Host homebox.space\n  User root\n  ProxyCommand sh -c \"fwknop -R -D main.homebox.space --rc-file ~/.fwknop-homebox.space.rc -n main.homebox.space ; /bin/nc %h %p\"",
            "title": "Automatically knocking your server before connecting"
        },
        {
            "location": "/firewall-configuration/#using-the-port-knoker-with-ansible",
            "text": "It is possible to use fwknop during the development phase.\nIn this case, you should use fwknop client to knock the server, before the SSH connection.  Hopefully, homebox comes with a fwknop connection plugin for Ansible, ready to use.\nThere are two modifications to make:  The host file, specify the fwknop parameters:  all : \n   hosts : \n     homebox : \n       ansible_host :   homebox.example.home \n       ansible_user :   root \n       ansible_port :   22 \n       # special parameters when using fwknop port knocking \n       fwknop_src :   192.168.14.55     # or 'auto' when connecting to a remote host over internet. \n       fwknop_config_name :   main.example.home \n       fwknop_dest :   main.example.home \n       fwknop_rc_file :   /home/andre/.fwknop-example.home.rc \n       fwknop_verbose :   true   See the file  config/hosts-fwknop-example.yml  for a complete list of possible options.  Then, when running ansible, use the  -c  parameter to specify the connection method, and use \u2018ssh_fwknop\u2019.\nThe source code is in  common/connection_plugins .  ansible-playbook -c ssh_fwknop -vvv -i ../config/hosts.yml playbooks/fwknop-server.yml  With the following output, for instance:  $ ansible-playbook -c ssh_fwknop -vvv -i ../config/hosts.yml playbooks/fwknop-server.yml\nansible-playbook  2 .6.3\n  config  file   =  /home/andre/Projects/homebox/install/ansible.cfg\n  configured module search  path   =   [ u '/home/andre/.ansible/plugins/modules' , u '/usr/share/ansible/plugins/modules' ] \n  ansible python module  location   =  /usr/lib/python2.7/dist-packages/ansible\n  executable  location   =  /usr/bin/ansible-playbook\n  python  version   =   2 .7.13  ( default, Sep  26   2018 ,  18 :42:22 )   [ GCC  6 .3.0  20170516 ] \nUsing /home/andre/Projects/homebox/install/ansible.cfg as config file\nParsed /home/andre/Projects/homebox/config/hosts.yml inventory  source  with yaml plugin\nRead vars_file  '{{ playbook_dir }}/../../config/system.yml' \nRead vars_file  '{{ playbook_dir }}/../../config/defaults.yml' \n\nPLAYBOOK: fwknop-server.yml ******************************** 1  plays in playbooks/fwknop-server.yml\nRead vars_file  '{{ playbook_dir }}/../../config/system.yml' \nRead vars_file  '{{ playbook_dir }}/../../config/defaults.yml' \n\nPLAY  [ homebox ]  *********************************************\nRead vars_file  '{{ playbook_dir }}/../../config/system.yml' \nRead vars_file  '{{ playbook_dir }}/../../config/defaults.yml' \n\nTASK  [ Gathering Facts ]  *************************************\ntask path: /home/andre/Projects/homebox/install/playbooks/fwknop-server.yml:4\n< 192 .168.63.100> ssh_fwknop connection plugin is used  for  this host\nRunning  ' /usr/bin/fwknop -v -a  192 .168.64.55 -D main.homebox.space --rc-file /home/andre/.fwknop-homebox.space.rc -n main.homebox.space\nSPA Field Values: ================= \n   Random Value:  4839788853776469 \n       Username: andre\n      Timestamp:  1540127737 \n    FKO Version:  3 .0.0\n   Message Type:  1   ( Access msg ) \n Message String:  192 .168.64.55,tcp/22\n     Nat Access: <NULL>\n    Server Auth: <NULL>\n Client Timeout:  0 \n    Digest Type:  3   ( SHA256 ) \n      HMAC Type:  3   ( SHA256 ) \nEncryption Type:  1   ( Rijndael ) \nEncryption Mode:  2   ( CBC ) \n...",
            "title": "Using the port knoker with Ansible"
        },
        {
            "location": "/security-configuration/",
            "text": "Default security settings\n\n\nThe default settings are\n\n\n\n\nAutomatically install security updates using unattended upgrades.\n\n\nSend alerts to the postmaster.\n\n\nForce root SSH login to use public key cryptography, and not a password.\n\n\nDisable the root password.\n\n\n\n\n###############################################################################\n\n\n# Extra security values\n\n\nsecurity_default\n:\n\n  \nauto_update\n:\n \ntrue\n                             \n# Install security updates automatically, using unattended-upgrades\n\n  \nssh_disable_root_access_with_password\n:\n \ntrue\n   \n# Force SSH authentication to use public / private key\n\n  \nssh_disable_root_access\n:\n \nfalse\n                \n# At the end of the installation, completely disable remote\n\n                                                \n# root access via SSH and force the use of sudo for the administrators\n\n  \nlock_root_password\n:\n \ntrue\n                      \n# Disable console root access by locking root password.\n\n  \nalerts_email\n:\n\n    \n-\n \n'admin@{{\n \nnetwork.domain\n \n}}'\n\n  \n# various options when luks is installed\n\n  \nluks\n:\n\n    \nyubikey\n:\n \nfalse\n\n\n\n\n\n\nOptions details\n\n\nAutomatic security updates\n\n\nBy default, automatic security updates are installed, using the\n\nunattended-upgrades\n package.\n\n\nThe changes are sent to the postmaster by default, using the recipient(s) defined in alerts_email variable.\n\n\nDefining administrators\n\n\nThis is done by setting a flag \nsudo: true\n for the users you want to grant administrator\u2019s rights, for instance:\n\n\n# list of users\n\n\nusers\n:\n\n\n-\n \nuid\n:\n \njohn\n\n  \ncn\n:\n \nJohn Doe\n\n  \nfirst_name\n:\n \nJohn\n\n  \nlast_name\n:\n \nDoe\n\n  \nmail\n:\n \njohn.doe@example.com\n\n  \npassword\n:\n \n'xIlm*uu7'\n\n\n  \nsudo\n:\n \ntrue\n\n\n\n\n\n\nGrant some users remote access\n\n\nThis is done by adding a public key to the user definition, for instance:\n\n\n# list of users\n\n\nusers\n:\n\n\n-\n \nuid\n:\n \njohn\n\n  \ncn\n:\n \nJohn Doe\n\n  \nfirst_name\n:\n \nJohn\n\n  \nlast_name\n:\n \nDoe\n\n  \nmail\n:\n \njohn.doe@example.com\n\n  \npassword\n:\n \n'xIlm*uu7'\n\n  \n# Allow remote access using SSH\n\n\n  \nssh_key\n:\n\n\n    \ntype\n:\n \necdsa-sha2-nistp384\n\n    \ncomment\n:\n \njohn@homebox\n\n    \ndata\n:\n \n>-\n\n      \nAAAAE2VjZHNhLXNoYTItbmlzdHAzODQAAAAIbmlzdHAzODQAAABhBE+E0hiYkPywn43g2J5s5t8mGq\n\n      \nmuUwObvFN05lCYpEQYv002lMeZEcD9rN80ZBGXJ49J0pfHmuRYScHIt3SjP7Eau3UrGebHvXSBzqPI\n\n      \nxcLmuv8NO2siwhqWmZfvrXEWlQ==\n\n\n\n\n\n\nLocking root access\n\n\nThe root account is locked by default, which means only SSH access is possible. However, if you have defined\nadministrators, you can now activate the \nsudo\n command to become root for these accounts and completely disable root\nSSH login:\n\n\n# Security settings\n\n\nsecurity\n:\n\n  \nssh_disable_root_access_with_password\n:\n \ntrue\n\n  \nssh_disable_root_access\n:\n \ntrue\n\n  \nlock_root_password\n:\n \ntrue\n\n\n\n\n\n\nUsing a Yubikey to boot\n\n\nIf your system is encrypted with LUKS, you can use a \nYubikey\n to decrypt the\nmain disk. This will be the simplest and safest option to decrypt your main drive.\n\n\n# Security settings\n\n\nsecurity\n:\n\n  \n\u2026\n\n  \nluks\n:\n\n    \nyubikey\n:\n \ntrue\n\n\n\n\n\n\nOnce the system is installed, run the provided script to \u201cenroll\u201d your key:\n\n\nroot@osaka:~ \n# yubikey-enroll.sh\n\nThis script will Register your Yubikey to decrypt the main drive.\nPlug your Yubikey that will be used to decrypt the hard drive. Continue \n(\ny/n\n)\n ?\ny\nPartition: /dev/sda5\nKey Slot \n0\n: ENABLED\nKey Slot \n1\n: DISABLED\nKey Slot \n2\n: DISABLED\nKey Slot \n3\n: DISABLED\nKey Slot \n4\n: DISABLED\nKey Slot \n5\n: DISABLED\nKey Slot \n6\n: DISABLED\nKey Slot \n7\n: ENABLED\nThe key will be registered in the slot \n1\n\n\n\n\n\n\nThe script will automatically choose a free slot.",
            "title": "Security configuration"
        },
        {
            "location": "/security-configuration/#default-security-settings",
            "text": "The default settings are   Automatically install security updates using unattended upgrades.  Send alerts to the postmaster.  Force root SSH login to use public key cryptography, and not a password.  Disable the root password.   ###############################################################################  # Extra security values  security_default : \n   auto_update :   true                               # Install security updates automatically, using unattended-upgrades \n   ssh_disable_root_access_with_password :   true     # Force SSH authentication to use public / private key \n   ssh_disable_root_access :   false                  # At the end of the installation, completely disable remote \n                                                 # root access via SSH and force the use of sudo for the administrators \n   lock_root_password :   true                        # Disable console root access by locking root password. \n   alerts_email : \n     -   'admin@{{   network.domain   }}' \n   # various options when luks is installed \n   luks : \n     yubikey :   false",
            "title": "Default security settings"
        },
        {
            "location": "/security-configuration/#options-details",
            "text": "",
            "title": "Options details"
        },
        {
            "location": "/security-configuration/#automatic-security-updates",
            "text": "By default, automatic security updates are installed, using the unattended-upgrades  package.  The changes are sent to the postmaster by default, using the recipient(s) defined in alerts_email variable.",
            "title": "Automatic security updates"
        },
        {
            "location": "/security-configuration/#defining-administrators",
            "text": "This is done by setting a flag  sudo: true  for the users you want to grant administrator\u2019s rights, for instance:  # list of users  users :  -   uid :   john \n   cn :   John Doe \n   first_name :   John \n   last_name :   Doe \n   mail :   john.doe@example.com \n   password :   'xIlm*uu7'     sudo :   true",
            "title": "Defining administrators"
        },
        {
            "location": "/security-configuration/#grant-some-users-remote-access",
            "text": "This is done by adding a public key to the user definition, for instance:  # list of users  users :  -   uid :   john \n   cn :   John Doe \n   first_name :   John \n   last_name :   Doe \n   mail :   john.doe@example.com \n   password :   'xIlm*uu7' \n   # Allow remote access using SSH     ssh_key :       type :   ecdsa-sha2-nistp384 \n     comment :   john@homebox \n     data :   >- \n       AAAAE2VjZHNhLXNoYTItbmlzdHAzODQAAAAIbmlzdHAzODQAAABhBE+E0hiYkPywn43g2J5s5t8mGq \n       muUwObvFN05lCYpEQYv002lMeZEcD9rN80ZBGXJ49J0pfHmuRYScHIt3SjP7Eau3UrGebHvXSBzqPI \n       xcLmuv8NO2siwhqWmZfvrXEWlQ==",
            "title": "Grant some users remote access"
        },
        {
            "location": "/security-configuration/#locking-root-access",
            "text": "The root account is locked by default, which means only SSH access is possible. However, if you have defined\nadministrators, you can now activate the  sudo  command to become root for these accounts and completely disable root\nSSH login:  # Security settings  security : \n   ssh_disable_root_access_with_password :   true \n   ssh_disable_root_access :   true \n   lock_root_password :   true",
            "title": "Locking root access"
        },
        {
            "location": "/security-configuration/#using-a-yubikey-to-boot",
            "text": "If your system is encrypted with LUKS, you can use a  Yubikey  to decrypt the\nmain disk. This will be the simplest and safest option to decrypt your main drive.  # Security settings  security : \n   \u2026 \n   luks : \n     yubikey :   true   Once the system is installed, run the provided script to \u201cenroll\u201d your key:  root@osaka:~  # yubikey-enroll.sh \nThis script will Register your Yubikey to decrypt the main drive.\nPlug your Yubikey that will be used to decrypt the hard drive. Continue  ( y/n )  ?\ny\nPartition: /dev/sda5\nKey Slot  0 : ENABLED\nKey Slot  1 : DISABLED\nKey Slot  2 : DISABLED\nKey Slot  3 : DISABLED\nKey Slot  4 : DISABLED\nKey Slot  5 : DISABLED\nKey Slot  6 : DISABLED\nKey Slot  7 : ENABLED\nThe key will be registered in the slot  1   The script will automatically choose a free slot.",
            "title": "Using a Yubikey to boot"
        },
        {
            "location": "/transmission-configuration/",
            "text": "Default configuration\n\n\nThe default configuration for the Transmission daemon comes with the following options:\n\n\n\n\nNot installed by default\n\n\nURL not public by default, only accessible from a local network\n\n\nThe web interface and the RPC servers are protected with the LDAP credentials.\n\n\nDownloaded files can be accessed within your web browser, still using the LDAP credentials.\n\n\nThe daemon runs in a proper AppArmor profile.\n\n\nWeb interface over https\n\n\nRequire encryption\n\n\nDHT end PEX options enabled\n\n\nNo speed limit\n\n\nDestination folder set to \u201c/var/lib/transmission-daemon/downloads\u201d\n\n\n\n\nDefault options for the transmission daemon:\n\n\n###############################################################################\n\n\n# Transmission bittorrent client installation\n\n\ntransmission_default\n:\n\n  \ninstall\n:\n \nfalse\n\n  \npublic\n:\n \nfalse\n         \n# not open to public by default, only to local networks\n\n  \nallow\n:\n                \n# a list of IP address that can access the web interface\n\n    \n-\n \n192.168.0.0/16\n    \n# RFC1918 local networks\n\n    \n-\n \n172.16.0.0/12\n\n    \n-\n \n10.0.0.0/8\n\n  \n# Block list\n\n  \n# example: http://john.bitsurge.net/public/biglist.p2p.gz\n\n  \nblocklist_url\n:\n \n~\n\n  \n# Protocol options\n\n  \npex\n:\n \ntrue\n\n  \ndht\n:\n \ntrue\n\n  \nport_forwarding\n:\n \nfalse\n\n  \n# Encryption parameters\n\n  \n# 0 = unencrypted, 1 = prefer encrypted, 2 = require encrypted\n\n  \nencryption\n:\n \n2\n\n  \n# Directories\n\n  \ndownload_dir\n:\n \n/var/lib/transmission-daemon/downloads\n\n  \nincomplete_dir\n:\n \n/var/lib/transmission-daemon/incomplete\n\n  \n# Download limits\n\n  \nspeed_limit_down\n:\n \n0\n\n  \ndownload_limit\n:\n \n100\n\n  \ndownload_queue\n:\n \n5\n\n  \n# Upload limits\n\n  \nspeed_limit_up\n:\n \n0\n\n  \nupload_limit\n:\n \n100\n\n  \nseed_queue_size\n:\n \n5\n\n\n\n\n\n\n\n\nNote\n\n\nWhen you install transmission daemon, firewall rules are added automatically, allowing you to safely download\ncontent without revealing too much information about your system.\n\n\n\n\nWeb interface\n\n\nYou can access the web interface from any web browser, using https://transmission.example.com.  If you are not coming\nfrom a trusted IP address, you will have to enter a user name and a password.  the authentication is done using the LDAP\ncredentials.\n\n\nDownloading files\n\n\nYou can access the files downloaded from any web browser, using https://transmission.example.com/downloads/.  If you are\nnot coming from a trusted IP address, you will have to enter a user name and a password.  the authentication is done\nusing the LDAP credentials.  A nice and responsive web interface has been added to search files.\n\n\nAccess from Android\n\n\nInstall the Transmission remote client for Android on \nGoogle Play\n.",
            "title": "Transmission configuration"
        },
        {
            "location": "/transmission-configuration/#default-configuration",
            "text": "The default configuration for the Transmission daemon comes with the following options:   Not installed by default  URL not public by default, only accessible from a local network  The web interface and the RPC servers are protected with the LDAP credentials.  Downloaded files can be accessed within your web browser, still using the LDAP credentials.  The daemon runs in a proper AppArmor profile.  Web interface over https  Require encryption  DHT end PEX options enabled  No speed limit  Destination folder set to \u201c/var/lib/transmission-daemon/downloads\u201d   Default options for the transmission daemon:  ###############################################################################  # Transmission bittorrent client installation  transmission_default : \n   install :   false \n   public :   false           # not open to public by default, only to local networks \n   allow :                  # a list of IP address that can access the web interface \n     -   192.168.0.0/16      # RFC1918 local networks \n     -   172.16.0.0/12 \n     -   10.0.0.0/8 \n   # Block list \n   # example: http://john.bitsurge.net/public/biglist.p2p.gz \n   blocklist_url :   ~ \n   # Protocol options \n   pex :   true \n   dht :   true \n   port_forwarding :   false \n   # Encryption parameters \n   # 0 = unencrypted, 1 = prefer encrypted, 2 = require encrypted \n   encryption :   2 \n   # Directories \n   download_dir :   /var/lib/transmission-daemon/downloads \n   incomplete_dir :   /var/lib/transmission-daemon/incomplete \n   # Download limits \n   speed_limit_down :   0 \n   download_limit :   100 \n   download_queue :   5 \n   # Upload limits \n   speed_limit_up :   0 \n   upload_limit :   100 \n   seed_queue_size :   5    Note  When you install transmission daemon, firewall rules are added automatically, allowing you to safely download\ncontent without revealing too much information about your system.",
            "title": "Default configuration"
        },
        {
            "location": "/transmission-configuration/#web-interface",
            "text": "You can access the web interface from any web browser, using https://transmission.example.com.  If you are not coming\nfrom a trusted IP address, you will have to enter a user name and a password.  the authentication is done using the LDAP\ncredentials.",
            "title": "Web interface"
        },
        {
            "location": "/transmission-configuration/#downloading-files",
            "text": "You can access the files downloaded from any web browser, using https://transmission.example.com/downloads/.  If you are\nnot coming from a trusted IP address, you will have to enter a user name and a password.  the authentication is done\nusing the LDAP credentials.  A nice and responsive web interface has been added to search files.",
            "title": "Downloading files"
        },
        {
            "location": "/transmission-configuration/#access-from-android",
            "text": "Install the Transmission remote client for Android on  Google Play .",
            "title": "Access from Android"
        },
        {
            "location": "/bind-configuration/",
            "text": "Default configuration\n\n\nThe default configuration for the DNS server comes with the following options:\n\n\n\n\nInstalled by default\n\n\nForward to google and cloudflare DNS\n\n\nDNSSEC Not activated by default\n\n\n\n\nDefault options for the server:\n\n\nbind_default\n:\n\n  \n# Bind is actually in testing phase, feedback welcome\n\n  \ninstall\n:\n \ntrue\n\n  \n# Default servers to forward queries\n\n  \nforward\n:\n\n    \n-\n \n8.8.8.8\n\n    \n-\n \n8.8.4.4\n\n    \n-\n \n1.1.1.1\n\n  \n# Actually, reverse IP address creation only works for IPv4\n\n  \n# If you are using IPv6, create the reverse IP block here\n\n  \nreverse_ip\n:\n \nauto\n\n  \n# Timing configuration (see https://www.ripe.net/publications/docs/ripe-203)\n\n  \nrefresh\n:\n \n86400\n          \n# 24 hours\n\n  \nretry\n:\n \n7200\n             \n# 2 hours\n\n  \nexpire\n:\n \n3600000\n         \n# 10000 hours\n\n  \nneg_cache_ttl\n:\n \n172800\n   \n# 2 days\n\n  \nttl\n:\n \n3600\n               \n# 1 hour\n\n  \n# General configuration\n\n  \nmx_priority\n:\n \n10\n\n  \n# List of backup MX records, if the server is unreachable\n\n  \n# The default is an empty list\n\n  \nmx_backup\n:\n \n[]\n\n  \n# Example of records\n\n  \n# mx_backup:\n\n  \n#   - fqdn: spool.mail.gandi.net\n\n  \n#     priority: 10\n\n  \n#   - fqdn: fb.mail.gandi.net\n\n  \n#     priority: 50\n\n  \n# List of trusted servers to accept cache / recursive queries\n\n  \ntrusted\n:\n\n    \n-\n \nsrc\n:\n \n192.168.0.0/16\n\n      \ncomment\n:\n \nLAN\n\n    \n-\n \nsrc\n:\n \nlocalhost\n\n    \n-\n \nsrc\n:\n \nlocalnets\n\n      \ncomment\n:\n \nLocal networks\n\n  \n#  - src: 72.13.58.64\n\n  \n#    comment: https://dnssec-analyzer.verisignlabs.com\n\n  \n# DNSSEC options\n\n  \ndnssec\n:\n\n    \nactive\n:\n \nfalse\n\n    \nalgo\n:\n \nRSASHA256\n\n\n\n\n\n\nForwarding queries\n\n\nBy default, the Google public DNS servers are used, as well as the one from cloudflare.\n\n\nMore choice here: \nPublic DNS\n.\n\n\nBackup MX records\n\n\nIf your server is not online, for instance due to an internet outage, you can use this option to redirect emails\nreception to another server. In this case, the other MTA should be configured to accept emails for your domain.\n\n\nIf you use this option, you will probably consider importing the emails delivered to these \u201cbackup servers\u201d, to your own\nserver, using the \nexternal account\n functionality.\n\n\nTrusted servers\n\n\nEnter the list of trusted servers for recursion and cache query.\n\n\nDNSSEC extensions\n\n\nDNSSEC is not activated by default. Be sure your domain name supports it before activating it.\n\n\nMore details on the \nWikipedia page",
            "title": "DNS Server configuration"
        },
        {
            "location": "/bind-configuration/#default-configuration",
            "text": "The default configuration for the DNS server comes with the following options:   Installed by default  Forward to google and cloudflare DNS  DNSSEC Not activated by default   Default options for the server:  bind_default : \n   # Bind is actually in testing phase, feedback welcome \n   install :   true \n   # Default servers to forward queries \n   forward : \n     -   8.8.8.8 \n     -   8.8.4.4 \n     -   1.1.1.1 \n   # Actually, reverse IP address creation only works for IPv4 \n   # If you are using IPv6, create the reverse IP block here \n   reverse_ip :   auto \n   # Timing configuration (see https://www.ripe.net/publications/docs/ripe-203) \n   refresh :   86400            # 24 hours \n   retry :   7200               # 2 hours \n   expire :   3600000           # 10000 hours \n   neg_cache_ttl :   172800     # 2 days \n   ttl :   3600                 # 1 hour \n   # General configuration \n   mx_priority :   10 \n   # List of backup MX records, if the server is unreachable \n   # The default is an empty list \n   mx_backup :   [] \n   # Example of records \n   # mx_backup: \n   #   - fqdn: spool.mail.gandi.net \n   #     priority: 10 \n   #   - fqdn: fb.mail.gandi.net \n   #     priority: 50 \n   # List of trusted servers to accept cache / recursive queries \n   trusted : \n     -   src :   192.168.0.0/16 \n       comment :   LAN \n     -   src :   localhost \n     -   src :   localnets \n       comment :   Local networks \n   #  - src: 72.13.58.64 \n   #    comment: https://dnssec-analyzer.verisignlabs.com \n   # DNSSEC options \n   dnssec : \n     active :   false \n     algo :   RSASHA256",
            "title": "Default configuration"
        },
        {
            "location": "/bind-configuration/#forwarding-queries",
            "text": "By default, the Google public DNS servers are used, as well as the one from cloudflare.  More choice here:  Public DNS .",
            "title": "Forwarding queries"
        },
        {
            "location": "/bind-configuration/#backup-mx-records",
            "text": "If your server is not online, for instance due to an internet outage, you can use this option to redirect emails\nreception to another server. In this case, the other MTA should be configured to accept emails for your domain.  If you use this option, you will probably consider importing the emails delivered to these \u201cbackup servers\u201d, to your own\nserver, using the  external account  functionality.",
            "title": "Backup MX records"
        },
        {
            "location": "/bind-configuration/#trusted-servers",
            "text": "Enter the list of trusted servers for recursion and cache query.",
            "title": "Trusted servers"
        },
        {
            "location": "/bind-configuration/#dnssec-extensions",
            "text": "DNSSEC is not activated by default. Be sure your domain name supports it before activating it.  More details on the  Wikipedia page",
            "title": "DNSSEC extensions"
        },
        {
            "location": "/external-accounts/",
            "text": "Retrieving emails\n\n\nIt is possible to add external accounts (GMail, Outlook, Yahoo, IMAP, etc\u2026) to the platform.\nIn this case, your emails will be downloaded in background, every time you logon on your account.\n\n\nThis is a one way synchronisation only, the remote accounts are not modified.\n\n\nSecurity\n\n\nThe credentials and the settings are stored on your box only, encrypted with AES 256 bits scheme.  The description key\nis stored by the root account. The credentials are decrypted by the user account and kept in memory during the\nsynchronisation process.\n\n\nBehind the scene, the platform is using \nisync\n.\n\n\nWhatever you access your account using the webmail or using an email client, the emails from other accounts will be\ndownloaded transparently.\n\n\nThe folders hierarchy is reproduced on your server, with some adaptations for GMail, though.\n\n\n\n\nNote\n\n\n\n\nThe emails will be imported once only. The system is keeping a record of the emails indexes already imported.\n\n\nEmails from external accounts are downloaded in the background, when you are checking your emails, from any client.\n\n\nThe imported emails are re-filtered using the Sieve filters you have specified,\n\n\n\n\n\n\nExample\n\n\nBelow is an example for one user named \u201candre\u201d, with multiple external accounts:\n\n\nusers\n:\n\n\n-\n \nuid\n:\n \nandre\n\n  \ncn\n:\n \nAndr\u00e9 Rodier\n\n  \nfirst_name\n:\n \nAndr\u00e9\n\n  \nlast_name\n:\n \nRodier\n\n  \nmail\n:\n \nandre@homebox.space\n\n  \npassword\n:\n \nioherin937aaf\n\n  \naliases\n:\n\n    \n-\n \nandr\u00e9@homebox.space\n\n    \n-\n \nandy@homebox.space\n\n    \n-\n \nandrew@homebox.space\n\n\n  \nexternal_accounts\n:\n\n\n    \n-\n \nname\n:\n \nwork\n\n      \ntype\n:\n \nimap\n\n      \nhost\n:\n \nimap.company.com\n\n      \nuser\n:\n \narodier\n\n      \npassword\n:\n \n'Imlirhf*62e3'\n\n      \nmax_messages\n:\n \n10\n\n    \n-\n \nname\n:\n \nzoho\n\n      \ntype\n:\n \nimap\n\n      \nhost\n:\n \nimappro.zoho.com\n\n      \nuser\n:\n \nandre@rodier.me\n\n      \npassword\n:\n \n'mt6wiu*VFkjv'\n\n      \nmax_messages\n:\n \n10\n\n      \nget_junk\n:\n \ntrue\n\n    \n-\n \nname\n:\n \ngmail\n\n      \ntype\n:\n \ngmail\n\n      \nuser\n:\n \narodier427@gmail.com\n\n      \npassword\n:\n \nbqlcmryyxswmvofw\n\n      \nget_important\n:\n \nfalse\n\n      \nget_junk\n:\n \ntrue\n\n      \nget_trash\n:\n \ntrue\n\n      \nmax_messages\n:\n \n10\n\n    \n-\n \nname\n:\n \nyahoo\n\n      \ntype\n:\n \nymail\n\n      \nuser\n:\n \narodier666@ymail.com\n\n      \npassword\n:\n \npkxzibnnzakbizvq\n\n      \nget_junk\n:\n \ntrue\n\n      \nget_trash\n:\n \ntrue\n\n      \nmax_messages\n:\n \n10\n\n    \n-\n \nname\n:\n \noutlook\n\n      \ntype\n:\n \nlive.com\n\n      \nuser\n:\n \njbond007@live.co.uk\n\n      \npassword\n:\n \nuqspxcsghssipmfw\n\n      \nget_junk\n:\n \ntrue\n\n      \nget_trash\n:\n \ntrue\n\n      \nmax_messages\n:\n \n10\n\n\n\n\n\n\nDetails of the options\n\n\nThere are a few options to download emails detailled below.\n\n\nServer name: \u201cname\u201d\n\n\nThe name option is used to keep track of your email synchronisation state. It is totally arbitrary, although\nit is better to keep a logic name. This is mandatory.\n\n\nSpecify the server type: \u201ctype\u201d\n\n\nThe type option is mandatory, and represents some pre-recorded settings to import your email.\n\n\nIt can be for instance \u201cgmail\u201d, \u201c\nlive\n.com\u201d, \u201cymail\u201d (Yahoo), or plain IMAP.\n\n\nIf you are using IMAP, you will have to specify the server address.\n\n\nThe import system will try SSL and TLS for connection.\n\n\nSynchronise Junk emails too: \u201cget_junk\u201d\n\n\nIf you want to import and keep synchronised Junk/Spam emails too, set this option to true.\nIt is set to false by default.\n\n\nSynchronise Trash/Bin emails too: get_trash\n\n\nIf you do not want to import delete emails too, set this option to false. It is set to true by default.\n\n\nTesting the synchronisation: \u201cmax_messages\u201d\n\n\nThis option is useful if you want to test the import / synchronisation, and see how the folders will be synchronised.\nIn the example above, the system downloads the last 10 emails, but will reproduce the entire folders hierarchy.\n\n\nGMail Special cases\n\n\nGoogle Mail (aka GMail) has some specific features, that make the import trickier.\nHowever, the system makes some choice.\nFor instance, the folders hierarchy is reproduced, but without the ugly \u2018[Google Mail]\u2019 label.\n\n\n\n\n\n\n\n\nFolder\n\n\nDestination\n\n\n\n\n\n\n\n\n\n\n[Google Mail]/Sent Mail\n\n\n/Sent\n\n\n\n\n\n\n[Google Mail]/Drafts\n\n\n/Draft\n\n\n\n\n\n\n[Google Mail]/Archives\n\n\n/Archives\n\n\n\n\n\n\n[Google Mail]/Bin\n\n\n/Trash\n\n\n\n\n\n\n[Google Mail]/Spam\n\n\n/Junk\n\n\n\n\n\n\n[Google Mail]/Chat\n\n\nNot synchronised.\n\n\n\n\n\n\n[Google Mail]/Starred\n\n\nNot synchronised.\n\n\n\n\n\n\n[Google Mail]/Important\n\n\nOptionally synchronised.\n\n\n\n\n\n\n\n\nThe \u201cStarred\u201d folder is a virtual folder that represents a view of your starred emails.\nThe same behaviour will be added to this platform.\n\n\nSince Google Mail has merged IMAP folders and labels, some emails will be imported multiple times,\ninto multiple folders, if they have multiple labels.\nThere is nothing to do - yet - about this, but it is better to import an email multiple times rather than\nloosing emails.\n\n\nImportant emails\n\n\nAs a corollary, there is an option, specific to GMail, to download the emails marked as \u201cImportant\u201d in\na dedicated folder, the option is called \u201c\nget_important\n\u201d, and set to true by default.\n\n\nGet archives\n\n\nThis option is set to true by default. Set it to false if you do not want to download your entire email\narchives.\n\n\n\n\nWarning\n\n\nBe careful, some email providers will not let you download emails once archived, for instance Zoho.",
            "title": "External accounts"
        },
        {
            "location": "/external-accounts/#retrieving-emails",
            "text": "It is possible to add external accounts (GMail, Outlook, Yahoo, IMAP, etc\u2026) to the platform.\nIn this case, your emails will be downloaded in background, every time you logon on your account.  This is a one way synchronisation only, the remote accounts are not modified.",
            "title": "Retrieving emails"
        },
        {
            "location": "/external-accounts/#security",
            "text": "The credentials and the settings are stored on your box only, encrypted with AES 256 bits scheme.  The description key\nis stored by the root account. The credentials are decrypted by the user account and kept in memory during the\nsynchronisation process.  Behind the scene, the platform is using  isync .  Whatever you access your account using the webmail or using an email client, the emails from other accounts will be\ndownloaded transparently.  The folders hierarchy is reproduced on your server, with some adaptations for GMail, though.   Note   The emails will be imported once only. The system is keeping a record of the emails indexes already imported.  Emails from external accounts are downloaded in the background, when you are checking your emails, from any client.  The imported emails are re-filtered using the Sieve filters you have specified,",
            "title": "Security"
        },
        {
            "location": "/external-accounts/#example",
            "text": "Below is an example for one user named \u201candre\u201d, with multiple external accounts:  users :  -   uid :   andre \n   cn :   Andr\u00e9 Rodier \n   first_name :   Andr\u00e9 \n   last_name :   Rodier \n   mail :   andre@homebox.space \n   password :   ioherin937aaf \n   aliases : \n     -   andr\u00e9@homebox.space \n     -   andy@homebox.space \n     -   andrew@homebox.space     external_accounts :       -   name :   work \n       type :   imap \n       host :   imap.company.com \n       user :   arodier \n       password :   'Imlirhf*62e3' \n       max_messages :   10 \n     -   name :   zoho \n       type :   imap \n       host :   imappro.zoho.com \n       user :   andre@rodier.me \n       password :   'mt6wiu*VFkjv' \n       max_messages :   10 \n       get_junk :   true \n     -   name :   gmail \n       type :   gmail \n       user :   arodier427@gmail.com \n       password :   bqlcmryyxswmvofw \n       get_important :   false \n       get_junk :   true \n       get_trash :   true \n       max_messages :   10 \n     -   name :   yahoo \n       type :   ymail \n       user :   arodier666@ymail.com \n       password :   pkxzibnnzakbizvq \n       get_junk :   true \n       get_trash :   true \n       max_messages :   10 \n     -   name :   outlook \n       type :   live.com \n       user :   jbond007@live.co.uk \n       password :   uqspxcsghssipmfw \n       get_junk :   true \n       get_trash :   true \n       max_messages :   10",
            "title": "Example"
        },
        {
            "location": "/external-accounts/#details-of-the-options",
            "text": "There are a few options to download emails detailled below.",
            "title": "Details of the options"
        },
        {
            "location": "/external-accounts/#server-name-name",
            "text": "The name option is used to keep track of your email synchronisation state. It is totally arbitrary, although\nit is better to keep a logic name. This is mandatory.",
            "title": "Server name: \"name\""
        },
        {
            "location": "/external-accounts/#specify-the-server-type-type",
            "text": "The type option is mandatory, and represents some pre-recorded settings to import your email.  It can be for instance \u201cgmail\u201d, \u201c live .com\u201d, \u201cymail\u201d (Yahoo), or plain IMAP.  If you are using IMAP, you will have to specify the server address.  The import system will try SSL and TLS for connection.",
            "title": "Specify the server type: \"type\""
        },
        {
            "location": "/external-accounts/#synchronise-junk-emails-too-get_junk",
            "text": "If you want to import and keep synchronised Junk/Spam emails too, set this option to true.\nIt is set to false by default.",
            "title": "Synchronise Junk emails too: \"get_junk\""
        },
        {
            "location": "/external-accounts/#synchronise-trashbin-emails-too-get_trash",
            "text": "If you do not want to import delete emails too, set this option to false. It is set to true by default.",
            "title": "Synchronise Trash/Bin emails too: get_trash"
        },
        {
            "location": "/external-accounts/#testing-the-synchronisation-max_messages",
            "text": "This option is useful if you want to test the import / synchronisation, and see how the folders will be synchronised.\nIn the example above, the system downloads the last 10 emails, but will reproduce the entire folders hierarchy.",
            "title": "Testing the synchronisation: \"max_messages\""
        },
        {
            "location": "/external-accounts/#gmail-special-cases",
            "text": "Google Mail (aka GMail) has some specific features, that make the import trickier.\nHowever, the system makes some choice.\nFor instance, the folders hierarchy is reproduced, but without the ugly \u2018[Google Mail]\u2019 label.     Folder  Destination      [Google Mail]/Sent Mail  /Sent    [Google Mail]/Drafts  /Draft    [Google Mail]/Archives  /Archives    [Google Mail]/Bin  /Trash    [Google Mail]/Spam  /Junk    [Google Mail]/Chat  Not synchronised.    [Google Mail]/Starred  Not synchronised.    [Google Mail]/Important  Optionally synchronised.     The \u201cStarred\u201d folder is a virtual folder that represents a view of your starred emails.\nThe same behaviour will be added to this platform.  Since Google Mail has merged IMAP folders and labels, some emails will be imported multiple times,\ninto multiple folders, if they have multiple labels.\nThere is nothing to do - yet - about this, but it is better to import an email multiple times rather than\nloosing emails.",
            "title": "GMail Special cases"
        },
        {
            "location": "/external-accounts/#important-emails",
            "text": "As a corollary, there is an option, specific to GMail, to download the emails marked as \u201cImportant\u201d in\na dedicated folder, the option is called \u201c get_important \u201d, and set to true by default.",
            "title": "Important emails"
        },
        {
            "location": "/external-accounts/#get-archives",
            "text": "This option is set to true by default. Set it to false if you do not want to download your entire email\narchives.   Warning  Be careful, some email providers will not let you download emails once archived, for instance Zoho.",
            "title": "Get archives"
        },
        {
            "location": "/backup-home/",
            "text": "The platform supports incremental backup of the home directory. You can specify multiple backup\nstrategies, and multiple locations.\n\n\nSupported locations\n\n\nThe locations currently supported are:\n\n\n\n\ndir: local drive, only useful for testing; does not require another device.\n\n\nssh: remote backup on another server through SSH (borg backup need to be installed on the remote location).\n\n\nsshfs: remote backup on another server through SSH only (does not use remote borg server).\n\n\ncifs: samba share, probably on your local network.\n\n\nusb: named USB stick / NAS drive.\n\n\ns3fs: Backup on Amazon S3.\n\n\n\n\nFor each location, the following procedure is followed:\n\n\n\n\nThe backup location is mounted by the system.\n\n\nThe backup is created (borg create).\n\n\nThe backup is checked (borg check).\n\n\nThe backup location is unmounted by the system.\n\n\nAn email is sent, with the result of all the steps.\n\n\nIf Jabber is activated, an IM is sent to inform the backup is finished, with the end result.\n\n\n\n\nOne strategy example\n\n\nHere a non exhaustive example with multiple locations:\n\n\nbackup\n:\n\n  \ninstall\n:\n \ntrue\n\n  \ntype\n:\n \nborgbackup\n\n  \nlocations\n:\n\n  \n-\n \nname\n:\n \nnas1\n\n    \nautomount\n:\n \ntrue\n\n    \nuuid\n:\n \n6e2cd39d-1109-43de-aee5-a6491fdec689\n\n    \nurl\n:\n \nusb:///mnt/backup/nas1/homebox\n\n    \nactive\n:\n \nyes\n                      \n# The backup is currently active\n\n    \nfrequency\n:\n \ndaily\n                 \n# Run the backup every day\n\n    \nkeep_daily\n:\n \n3\n                    \n# Keep the last three days locally\n\n    \ncompression\n:\n \nlz4\n                 \n# Use the fast compression for daily backups\n\n  \n-\n \nname\n:\n \nbackup-station\n\n    \nurl\n:\n \nssh://backup-station.office.pm:/home/backup/homebox\n\n    \nactive\n:\n \nyes\n                      \n# The backup is currently active\n\n    \nfrequency\n:\n \ndaily\n                 \n# Run the backup every day\n\n    \nkeep_daily\n:\n \n7\n                    \n# Keep the last seven days (1 by default)\n\n    \nkeep_weekly\n:\n \n4\n                   \n# Keep the last four weeks (1 by default)\n\n    \nkeep_monthly\n:\n \n6\n                  \n# Keep the last six months (1 by default)\n\n    \ncompression\n:\n \nlz4\n                 \n# Use the fast compression for daily backups\n\n  \n-\n \nname\n:\n \nnas\n\n    \nurl\n:\n \nsmb://backup:giuwh97kwerr@nas1:/home/backup/homebox\n\n    \nactive\n:\n \nyes\n                      \n# The backup is currently active\n\n    \nfrequency\n:\n \nweekly\n                \n# Run the backup every week\n\n    \nkeep_weekly\n:\n \n4\n                   \n# Keep the last four weeks (1 by default)\n\n    \nkeep_monthly\n:\n \n6\n                  \n# Keep the last six months (1 by default)\n\n    \ncompression\n:\n \nzlib,9\n              \n# Use the good but slow compression for weekly backups\n\n    \nrate_limit\n:\n \n500\n                  \n# Network upload rate limit in kiByte/s\n\n\n\n\n\n\nThe locations are automatically mounted on demand when the backup starts, and dismounted once the backup finished. You\ncan have different backup frequencies, for instance daily, weekly or monthly.\n\n\n\n\nTip\n\n\nSet up a rate limit when creating a remote backup. This will prevent the backup process to consume all your\nbandwidth and affect the email delivery.\n\n\n\n\nBackup locations details\n\n\nFor any backup type, the destination directory need to exist. All the backups are encrypted using the same encryption\nkey. The encryption key backup is in your \nbackup directory\n, in encryption/backup-key.pwd\n\n\nLocal directory\n\n\nThis can be a temporary solution unless your main homebox drive is mounted in RAID (see\n\npreseed\n) or if you have mounted a remote location yourself.\n\n\nbackup\n:\n\n  \n...\n\n  \n- name\n:\n \nlocal\n\n    \nurl\n:\n \ndir://var/backups/homebox\n\n    \nactive\n:\n \nyes\n\n    \nfrequency\n:\n \ndaily\n\n    \nkeep_daily\n:\n \n7\n\n    \nkeep_monthly\n:\n \n12\n\n    \nidle_sec\n:\n \n60\n\n    \ncheck_frequency\n:\n \nweekly\n\n\n\n\n\n\nRemote server over SSH\n\n\nThis location scheme is using borg on a remote server, with an SSH connection. Therefore, the borg software need to be\ninstalled on the remote machine, with the appropriate permissions.\n\n\nFor instance, you want to backup your system on a sever accessible via backup.homebox.space, with\nthe user \u201calice\u201d:\n\n\nbackup\n:\n\n  \n...\n\n  \n- name\n:\n \nbackup-station\n\n    \nurl\n:\n \nssh://alice@backup.homebox.space:/home/alice/backup/homebox\n\n    \nactive\n:\n \nyes\n                      \n# The backup is currently active\n\n    \nfrequency\n:\n \ndaily\n                 \n# Run the backup every day\n\n    \nkeep_daily\n:\n \n7\n                    \n# Keep the last seven days (1 by default)\n\n    \nkeep_weekly\n:\n \n4\n                   \n# Keep the last four weeks (1 by default)\n\n    \ncompression\n:\n \nlz4\n                 \n# Use the fast compression for daily backups\n\n\n\n\n\n\nFor SSH backup, the authentication scheme used is public key authentication, i.e. no password.\n\n\nThe Ansible installation script automatically create a private and a public key for the root user,\nand send the public key to the postmaster, by email. You need to copy the key to the desired\nlocation on the remote instance, and configure your \nauthorized_keys\n roughly like this:\n\n\n# backup from homebox\n\n\ncommand\n=\n\"borg serve --restrict-to-path /home/alice/backup\"\n,restrict ssh-rsa AAAAE2VjZHN\u2026SZzah5h5U+m4MJumCRRCJQXxaQ\n==\n backup@homebox\n\n\n\n\n\nThe private and public keys are also saved in the deployment backup folder, into ssh-keys/root.\n\n\nRemote server, using SSHFS\n\n\nThis location scheme allows you to backup on a remote system over SSH, but does not need borg to be installed. Here an\nexample on an internal router:\n\n\nbackup\n:\n\n  \n...\n\n  \n- name\n:\n \nrouter\n\n    \nautomount\n:\n \ntrue\n\n    \nurl\n:\n \nsshfs://backup@bkp.router.lan:/var/backup/homebox\n\n    \nkeyName\n:\n \nbackup.ecdsa\n\n    \nactive\n:\n \nyes\n\n    \nfrequency\n:\n \ndaily\n\n    \nkeep_weekly\n:\n \n4\n\n    \nkeep_monthly\n:\n \n6\n\n\n\n\n\n\nThe key name will be used to configure SSH to connect with this key, in the ~/.ssh/config.d/backup-router\n\n\n# SSH configuration for router\nHost bkp.router.lan\n  User backup\n  UserKnownHostsFile /dev/null\n  CheckHostIP no\n  StrictHostKeyChecking no\n  IdentityFile ~/.ssh/backup.ecdsa\n\n\n\n\n\nOn a USB drive\n\n\nThis is the recommended way to backup your system when you are restrained to local backup. Here\nan example:\n\n\nbackup\n\n  \n...\n\n  \n- name\n:\n \nnas1\n\n    \nautomount\n:\n \ntrue\n\n    \nuuid\n:\n \n6d83f6d4-2769-46d0-b07b-675ab0863393\n\n    \nurl\n:\n \nusb:///mnt/backup/nas1/homebox-backup\n\n    \nactive\n:\n \nyes\n                      \n# The backup is currently active\n\n    \nfrequency\n:\n \ndaily\n                 \n# Run the backup every day\n\n    \nkeep_daily\n:\n \n3\n                    \n# Keep the last three days locally\n\n    \ncompression\n:\n \nlz4\n                 \n# Use the fast compression for daily backups\n\n\n\n\n\n\nThe exact syntax for the url takes one drive name and an optional directory name. You can have\nmultiple backups on the same device, by using a different sub-directory:\n\n\nurl: usb:///mnt/backup/<drive-name>[/sub-directory]\n\n\nThe filesystem UUID should be specified, and the initial folder should already exist on the\nexternal device. To obtain the UUID of your external drive, use blkid command. You do not need to\nbe root. For instance:\n\n\n$ /sbin/blkid /dev/sdb1\n/dev/sdb1: \nLABEL\n=\n\"PortableBackup\"\n \nUUID\n=\n\"6d83f6d4-2769-46d0-b07b-675ab0863393\"\n \nTYPE\n=\n\"ext4\"\n \nPARTLABEL\n=\n\"PortableBackup\"\n \nPARTUUID\n=\n\"01572f1c-bb90-4eda-bccf-6e5953a25f44\"\n\n\n\n\n\n\nOnce the backup is finished, the USB drive be automatically unmounted after 60 seconds of\ninactivity. This allows you to remove the usb drive safely.\n\n\nBackup on a network drive\n\n\nYou can also backup on a network drive, perhaps on your local network, using SMB protocol (Windows\nnetwork share). Here an example:\n\n\nbackup\n:\n\n  \n...\n\n  \n- name\n:\n \nhome.lan\n\n    \nurl\n:\n \ncifs://backup:eecPxKbeDvs02g7BEdwf@nas1.home.lan:/backup\n\n    \nactive\n:\n \nyes\n\n    \nfrequency\n:\n \nweekly\n\n    \nkeep_weekly\n:\n \n4\n\n    \nkeep_monthly\n:\n \n6\n\n\n\n\n\n\nBackup on Amazon S3\n\n\nYou can also backup on a S3 bucket on AWS cloud platform. Here an example:\n\n\nbackup\n:\n\n  \n...\n\n  \n- name\n:\n \ns3main\n\n    \nautomount\n:\n \ntrue\n\n    \nurl\n:\n \ns3fs:///mnt/backup/s3main/homebox\n\n    \nactive\n:\n \nyes\n\n    \nfrequency\n:\n \nweekly\n\n    \nkeep_weekly\n:\n \n4\n\n    \nkeep_monthly\n:\n \n6\n\n    \naccess_key_id\n:\n \nAKD1WAGJDIKWSX2TRPQR\n\n    \nsecret_access_key\n:\n \ngBiRu5hPSyswK17TNpp2IIf5sWDNJx6Vb9Gx3rjF\n\n    \nbucket_name\n:\n \nhomebox-backup.example.com\n\n    \nregion\n:\n \neu-west-2\n\n    \nrate_limit\n:\n \n500\n\n\n\n\n\n\nAnd here an appropriate example of bucket policy:\n\n\n{\n\n    \n\"Version\"\n:\n \n\"2012-10-17\"\n,\n\n    \n\"Id\"\n:\n \n\"Policy1559913732504\"\n,\n\n    \n\"Statement\"\n:\n \n[\n\n        \n{\n\n            \n\"Sid\"\n:\n \n\"Stmt1559913723346\"\n,\n\n            \n\"Effect\"\n:\n \n\"Allow\"\n,\n\n            \n\"Principal\"\n:\n \n{\n\n                \n\"AWS\"\n:\n \n\"arn:aws:iam::399724661369:user/homebox\"\n\n            \n},\n\n            \n\"Action\"\n:\n \n\"s3:*\"\n,\n\n            \n\"Resource\"\n:\n \n\"arn:aws:s3:::homebox-backup.example.com\"\n\n        \n}\n\n    \n]\n\n\n}\n\n\n\n\n\n\nYou can use the \nAmazon S3 policy generator\n.\n\n\nAs usual, everything is encrypted locally using borg backup. Therefore, no one will be able to\ndecrypt your files without the encryption key.\n\n\n\n\nNote\n\n\n\n\nThis location storage is actually under scrutiny, and might be removed if proven unstable.\n\n\nUnder the hood, \nS3FS\n is used, with the cache option activated, and located\n  in /home/.backup-cache/. Because this folder content is about the size if the whole backup, the /home partition\n  should have enough available disk space.\n\n\n\n\n\n\nBackup contents\n\n\nAt this time, only the content of the /home folders is back up, perhaps the emails. This should also allow you to\nrestore your emails after a fresh installation or in case of accidental deletion.\n\n\nAny file stored by the users in their home folders is back up too.\n\n\nSome folders are excluded from the backup, like the email indexes and temporary files.\n\n\n\n\nNote\n\n\n\n\nIf \nGogs\n is installed, the repository files are automatically excluded from backup.\n\n\nIf the Transmission bittorrent daemon is installed, the downloaded files are excluded as well.\n\n\n\n\n\n\nEmails reporting\n\n\nBy default, backup jobs are run overnight, and an email is sent to the postmaster, with a summary of the backup job:\n\n\nExample of backup success email\n\n\nBackup report for nas1: Success\nCreation status:\n------------------------------------------------------------------------------\nArchive name: home-2018-04-07 22:03:47.380483\nArchive fingerprint: b5ca1c8ff733e6450c861ac66ccc70fcdcffe13690a969c895bc8cf843f27059\nTime (start): Sat, 2018-04-07 22:03:48\nTime (end):   Sat, 2018-04-07 22:03:48\nDuration: 0.37 seconds\nNumber of files: 2825\n------------------------------------------------------------------------------\n                       Original size      Compressed size    Deduplicated size\nThis archive:              157.00 MB            123.53 MB             58.16 kB\nAll archives:              784.84 MB            617.59 MB            123.94 MB\n\n                       Unique chunks         Total chunks\nChunk index:                    2014                13830\n------------------------------------------------------------------------------\nterminating with success status, rc 0\n\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\nPrune status:\n------------------------------------------------------------------------------\n                       Original size      Compressed size    Deduplicated size\nDeleted data:                    0 B                  0 B                  0 B\nAll archives:              784.84 MB            617.59 MB            123.94 MB\n\n                       Unique chunks         Total chunks\nChunk index:                    2014                13830\n------------------------------------------------------------------------------\nterminating with success status, rc 0\n\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\nCheck status:\nStarting repository check\nStarting repository index check\nCompleted repository check, no problems found.\nStarting archive consistency check...\nAnalyzing archive home-2019-06-04 15:10:43.524553 (1/10)\nAnalyzing archive home-2019-06-04 17:42:15.409853 (2/10)\nAnalyzing archive home-2019-06-04 17:56:40.781983 (3/10)\nAnalyzing archive home-2019-06-04 18:01:27.745755 (4/10)\nAnalyzing archive home-2019-06-04 18:08:36.704945 (5/10)\nAnalyzing archive home-2019-06-05 06:25:04.664133 (6/10)\nAnalyzing archive home-2019-06-06T06:25:06 (7/10)\nAnalyzing archive home-2019-06-07T08:01:36 (8/10)\nAnalyzing archive home-2019-06-08T06:25:05 (9/10)\nAnalyzing archive home-2019-06-08T15:50:29 (10/10)\nArchive consistency check complete, no problems found.\n\n\n\n\n\nExample of backup error email\n\n\nBackup report for router: Error\nException when running backup, see logs for details\nCreation status:\nSynchronizing chunks cache...\nArchives: 1, w/ cached Idx: 0, w/ outdated Idx: 0, w/o cached Idx: 1.\nFetching and building archive index for home-2018-04-07 13:49:40.582441 ...\nMerging into master chunks index ...\nDone.\n------------------------------------------------------------------------------\nArchive name: home-2018-04-08 07:35:51.274554\nArchive fingerprint: 710bf94819fc6699cc04c050ba324541b40ef4849ed8e76603b5f0b816f1a75d\nTime (start): Sun, 2018-04-08 07:35:51\nTime (end):   Sun, 2018-04-08 07:35:51\nDuration: 0.08 seconds\nNumber of files: 52\n------------------------------------------------------------------------------\n                       Original size      Compressed size    Deduplicated size\nThis archive:               62.28 kB             37.01 kB             31.88 kB\nAll archives:              273.41 MB            241.18 MB            241.06 MB\n\n                       Unique chunks         Total chunks\nChunk index:                    2056                 2834\n------------------------------------------------------------------------------\nterminating with success status, rc 0\n\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\nPrune errors:\nAt least one of the \"keep-within\", \"keep-last\", \"keep-hourly\", \"keep-daily\", \"keep-weekly\", \"keep-monthly\" or \"keep-yearly\" settings must be specified.\nterminating with error status, rc 2\n\n\n\n\n\nSend reports using Jabber.\n\n\nHomebox comes with the option to send backup status using short messages in real time, using the Jabber server embedded\nin the platform. To do so, use the following settings:\n\n\nbackup\n:\n\n  \ninstall\n:\n \ntrue\n\n  \ntype\n:\n \nborgbackup\n\n  \nalerts\n:\n\n\n    \njabber\n:\n \ntrue\n\n\n    \nfrom\n:\n \npostmaster@homebox.space\n\n    \nrecipient\n:\n \nandre@homebox.space\n\n  \nlocations\n:\n\n  \n...\n\n\n\n\n\n\nA first message will be sent just before the backup process starts, and onother one once the process is finished, with\nthe status. The last message contains only the status. For a full report, you\u2019ll still have to check the email.\n\n\nExample of success message\n\n\n00:15 postmaster: Backup process finished successfully for location \"nas1\"\n\n\n\n\n\nExample of error message\n\n\n00:03 postmaster: Backup process failed for location 'nas1' (See the email for details)",
            "title": "Backup your home folders"
        },
        {
            "location": "/backup-home/#supported-locations",
            "text": "The locations currently supported are:   dir: local drive, only useful for testing; does not require another device.  ssh: remote backup on another server through SSH (borg backup need to be installed on the remote location).  sshfs: remote backup on another server through SSH only (does not use remote borg server).  cifs: samba share, probably on your local network.  usb: named USB stick / NAS drive.  s3fs: Backup on Amazon S3.   For each location, the following procedure is followed:   The backup location is mounted by the system.  The backup is created (borg create).  The backup is checked (borg check).  The backup location is unmounted by the system.  An email is sent, with the result of all the steps.  If Jabber is activated, an IM is sent to inform the backup is finished, with the end result.",
            "title": "Supported locations"
        },
        {
            "location": "/backup-home/#one-strategy-example",
            "text": "Here a non exhaustive example with multiple locations:  backup : \n   install :   true \n   type :   borgbackup \n   locations : \n   -   name :   nas1 \n     automount :   true \n     uuid :   6e2cd39d-1109-43de-aee5-a6491fdec689 \n     url :   usb:///mnt/backup/nas1/homebox \n     active :   yes                        # The backup is currently active \n     frequency :   daily                   # Run the backup every day \n     keep_daily :   3                      # Keep the last three days locally \n     compression :   lz4                   # Use the fast compression for daily backups \n   -   name :   backup-station \n     url :   ssh://backup-station.office.pm:/home/backup/homebox \n     active :   yes                        # The backup is currently active \n     frequency :   daily                   # Run the backup every day \n     keep_daily :   7                      # Keep the last seven days (1 by default) \n     keep_weekly :   4                     # Keep the last four weeks (1 by default) \n     keep_monthly :   6                    # Keep the last six months (1 by default) \n     compression :   lz4                   # Use the fast compression for daily backups \n   -   name :   nas \n     url :   smb://backup:giuwh97kwerr@nas1:/home/backup/homebox \n     active :   yes                        # The backup is currently active \n     frequency :   weekly                  # Run the backup every week \n     keep_weekly :   4                     # Keep the last four weeks (1 by default) \n     keep_monthly :   6                    # Keep the last six months (1 by default) \n     compression :   zlib,9                # Use the good but slow compression for weekly backups \n     rate_limit :   500                    # Network upload rate limit in kiByte/s   The locations are automatically mounted on demand when the backup starts, and dismounted once the backup finished. You\ncan have different backup frequencies, for instance daily, weekly or monthly.   Tip  Set up a rate limit when creating a remote backup. This will prevent the backup process to consume all your\nbandwidth and affect the email delivery.",
            "title": "One strategy example"
        },
        {
            "location": "/backup-home/#backup-locations-details",
            "text": "For any backup type, the destination directory need to exist. All the backups are encrypted using the same encryption\nkey. The encryption key backup is in your  backup directory , in encryption/backup-key.pwd",
            "title": "Backup locations details"
        },
        {
            "location": "/backup-home/#local-directory",
            "text": "This can be a temporary solution unless your main homebox drive is mounted in RAID (see preseed ) or if you have mounted a remote location yourself.  backup : \n   ... \n   - name :   local \n     url :   dir://var/backups/homebox \n     active :   yes \n     frequency :   daily \n     keep_daily :   7 \n     keep_monthly :   12 \n     idle_sec :   60 \n     check_frequency :   weekly",
            "title": "Local directory"
        },
        {
            "location": "/backup-home/#remote-server-over-ssh",
            "text": "This location scheme is using borg on a remote server, with an SSH connection. Therefore, the borg software need to be\ninstalled on the remote machine, with the appropriate permissions.  For instance, you want to backup your system on a sever accessible via backup.homebox.space, with\nthe user \u201calice\u201d:  backup : \n   ... \n   - name :   backup-station \n     url :   ssh://alice@backup.homebox.space:/home/alice/backup/homebox \n     active :   yes                        # The backup is currently active \n     frequency :   daily                   # Run the backup every day \n     keep_daily :   7                      # Keep the last seven days (1 by default) \n     keep_weekly :   4                     # Keep the last four weeks (1 by default) \n     compression :   lz4                   # Use the fast compression for daily backups   For SSH backup, the authentication scheme used is public key authentication, i.e. no password.  The Ansible installation script automatically create a private and a public key for the root user,\nand send the public key to the postmaster, by email. You need to copy the key to the desired\nlocation on the remote instance, and configure your  authorized_keys  roughly like this:  # backup from homebox  command = \"borg serve --restrict-to-path /home/alice/backup\" ,restrict ssh-rsa AAAAE2VjZHN\u2026SZzah5h5U+m4MJumCRRCJQXxaQ ==  backup@homebox  The private and public keys are also saved in the deployment backup folder, into ssh-keys/root.",
            "title": "Remote server over SSH"
        },
        {
            "location": "/backup-home/#remote-server-using-sshfs",
            "text": "This location scheme allows you to backup on a remote system over SSH, but does not need borg to be installed. Here an\nexample on an internal router:  backup : \n   ... \n   - name :   router \n     automount :   true \n     url :   sshfs://backup@bkp.router.lan:/var/backup/homebox \n     keyName :   backup.ecdsa \n     active :   yes \n     frequency :   daily \n     keep_weekly :   4 \n     keep_monthly :   6   The key name will be used to configure SSH to connect with this key, in the ~/.ssh/config.d/backup-router  # SSH configuration for router\nHost bkp.router.lan\n  User backup\n  UserKnownHostsFile /dev/null\n  CheckHostIP no\n  StrictHostKeyChecking no\n  IdentityFile ~/.ssh/backup.ecdsa",
            "title": "Remote server, using SSHFS"
        },
        {
            "location": "/backup-home/#on-a-usb-drive",
            "text": "This is the recommended way to backup your system when you are restrained to local backup. Here\nan example:  backup \n   ... \n   - name :   nas1 \n     automount :   true \n     uuid :   6d83f6d4-2769-46d0-b07b-675ab0863393 \n     url :   usb:///mnt/backup/nas1/homebox-backup \n     active :   yes                        # The backup is currently active \n     frequency :   daily                   # Run the backup every day \n     keep_daily :   3                      # Keep the last three days locally \n     compression :   lz4                   # Use the fast compression for daily backups   The exact syntax for the url takes one drive name and an optional directory name. You can have\nmultiple backups on the same device, by using a different sub-directory:  url: usb:///mnt/backup/<drive-name>[/sub-directory]  The filesystem UUID should be specified, and the initial folder should already exist on the\nexternal device. To obtain the UUID of your external drive, use blkid command. You do not need to\nbe root. For instance:  $ /sbin/blkid /dev/sdb1\n/dev/sdb1:  LABEL = \"PortableBackup\"   UUID = \"6d83f6d4-2769-46d0-b07b-675ab0863393\"   TYPE = \"ext4\"   PARTLABEL = \"PortableBackup\"   PARTUUID = \"01572f1c-bb90-4eda-bccf-6e5953a25f44\"   Once the backup is finished, the USB drive be automatically unmounted after 60 seconds of\ninactivity. This allows you to remove the usb drive safely.",
            "title": "On a USB drive"
        },
        {
            "location": "/backup-home/#backup-on-a-network-drive",
            "text": "You can also backup on a network drive, perhaps on your local network, using SMB protocol (Windows\nnetwork share). Here an example:  backup : \n   ... \n   - name :   home.lan \n     url :   cifs://backup:eecPxKbeDvs02g7BEdwf@nas1.home.lan:/backup \n     active :   yes \n     frequency :   weekly \n     keep_weekly :   4 \n     keep_monthly :   6",
            "title": "Backup on a network drive"
        },
        {
            "location": "/backup-home/#backup-on-amazon-s3",
            "text": "You can also backup on a S3 bucket on AWS cloud platform. Here an example:  backup : \n   ... \n   - name :   s3main \n     automount :   true \n     url :   s3fs:///mnt/backup/s3main/homebox \n     active :   yes \n     frequency :   weekly \n     keep_weekly :   4 \n     keep_monthly :   6 \n     access_key_id :   AKD1WAGJDIKWSX2TRPQR \n     secret_access_key :   gBiRu5hPSyswK17TNpp2IIf5sWDNJx6Vb9Gx3rjF \n     bucket_name :   homebox-backup.example.com \n     region :   eu-west-2 \n     rate_limit :   500   And here an appropriate example of bucket policy:  { \n     \"Version\" :   \"2012-10-17\" , \n     \"Id\" :   \"Policy1559913732504\" , \n     \"Statement\" :   [ \n         { \n             \"Sid\" :   \"Stmt1559913723346\" , \n             \"Effect\" :   \"Allow\" , \n             \"Principal\" :   { \n                 \"AWS\" :   \"arn:aws:iam::399724661369:user/homebox\" \n             }, \n             \"Action\" :   \"s3:*\" , \n             \"Resource\" :   \"arn:aws:s3:::homebox-backup.example.com\" \n         } \n     ]  }   You can use the  Amazon S3 policy generator .  As usual, everything is encrypted locally using borg backup. Therefore, no one will be able to\ndecrypt your files without the encryption key.   Note   This location storage is actually under scrutiny, and might be removed if proven unstable.  Under the hood,  S3FS  is used, with the cache option activated, and located\n  in /home/.backup-cache/. Because this folder content is about the size if the whole backup, the /home partition\n  should have enough available disk space.",
            "title": "Backup on Amazon S3"
        },
        {
            "location": "/backup-home/#backup-contents",
            "text": "At this time, only the content of the /home folders is back up, perhaps the emails. This should also allow you to\nrestore your emails after a fresh installation or in case of accidental deletion.  Any file stored by the users in their home folders is back up too.  Some folders are excluded from the backup, like the email indexes and temporary files.   Note   If  Gogs  is installed, the repository files are automatically excluded from backup.  If the Transmission bittorrent daemon is installed, the downloaded files are excluded as well.",
            "title": "Backup contents"
        },
        {
            "location": "/backup-home/#emails-reporting",
            "text": "By default, backup jobs are run overnight, and an email is sent to the postmaster, with a summary of the backup job:",
            "title": "Emails reporting"
        },
        {
            "location": "/backup-home/#example-of-backup-success-email",
            "text": "Backup report for nas1: Success\nCreation status:\n------------------------------------------------------------------------------\nArchive name: home-2018-04-07 22:03:47.380483\nArchive fingerprint: b5ca1c8ff733e6450c861ac66ccc70fcdcffe13690a969c895bc8cf843f27059\nTime (start): Sat, 2018-04-07 22:03:48\nTime (end):   Sat, 2018-04-07 22:03:48\nDuration: 0.37 seconds\nNumber of files: 2825\n------------------------------------------------------------------------------\n                       Original size      Compressed size    Deduplicated size\nThis archive:              157.00 MB            123.53 MB             58.16 kB\nAll archives:              784.84 MB            617.59 MB            123.94 MB\n\n                       Unique chunks         Total chunks\nChunk index:                    2014                13830\n------------------------------------------------------------------------------\nterminating with success status, rc 0\n\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\nPrune status:\n------------------------------------------------------------------------------\n                       Original size      Compressed size    Deduplicated size\nDeleted data:                    0 B                  0 B                  0 B\nAll archives:              784.84 MB            617.59 MB            123.94 MB\n\n                       Unique chunks         Total chunks\nChunk index:                    2014                13830\n------------------------------------------------------------------------------\nterminating with success status, rc 0\n\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\nCheck status:\nStarting repository check\nStarting repository index check\nCompleted repository check, no problems found.\nStarting archive consistency check...\nAnalyzing archive home-2019-06-04 15:10:43.524553 (1/10)\nAnalyzing archive home-2019-06-04 17:42:15.409853 (2/10)\nAnalyzing archive home-2019-06-04 17:56:40.781983 (3/10)\nAnalyzing archive home-2019-06-04 18:01:27.745755 (4/10)\nAnalyzing archive home-2019-06-04 18:08:36.704945 (5/10)\nAnalyzing archive home-2019-06-05 06:25:04.664133 (6/10)\nAnalyzing archive home-2019-06-06T06:25:06 (7/10)\nAnalyzing archive home-2019-06-07T08:01:36 (8/10)\nAnalyzing archive home-2019-06-08T06:25:05 (9/10)\nAnalyzing archive home-2019-06-08T15:50:29 (10/10)\nArchive consistency check complete, no problems found.",
            "title": "Example of backup success email"
        },
        {
            "location": "/backup-home/#example-of-backup-error-email",
            "text": "Backup report for router: Error\nException when running backup, see logs for details\nCreation status:\nSynchronizing chunks cache...\nArchives: 1, w/ cached Idx: 0, w/ outdated Idx: 0, w/o cached Idx: 1.\nFetching and building archive index for home-2018-04-07 13:49:40.582441 ...\nMerging into master chunks index ...\nDone.\n------------------------------------------------------------------------------\nArchive name: home-2018-04-08 07:35:51.274554\nArchive fingerprint: 710bf94819fc6699cc04c050ba324541b40ef4849ed8e76603b5f0b816f1a75d\nTime (start): Sun, 2018-04-08 07:35:51\nTime (end):   Sun, 2018-04-08 07:35:51\nDuration: 0.08 seconds\nNumber of files: 52\n------------------------------------------------------------------------------\n                       Original size      Compressed size    Deduplicated size\nThis archive:               62.28 kB             37.01 kB             31.88 kB\nAll archives:              273.41 MB            241.18 MB            241.06 MB\n\n                       Unique chunks         Total chunks\nChunk index:                    2056                 2834\n------------------------------------------------------------------------------\nterminating with success status, rc 0\n\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\nPrune errors:\nAt least one of the \"keep-within\", \"keep-last\", \"keep-hourly\", \"keep-daily\", \"keep-weekly\", \"keep-monthly\" or \"keep-yearly\" settings must be specified.\nterminating with error status, rc 2",
            "title": "Example of backup error email"
        },
        {
            "location": "/backup-home/#send-reports-using-jabber",
            "text": "Homebox comes with the option to send backup status using short messages in real time, using the Jabber server embedded\nin the platform. To do so, use the following settings:  backup : \n   install :   true \n   type :   borgbackup \n   alerts :       jabber :   true       from :   postmaster@homebox.space \n     recipient :   andre@homebox.space \n   locations : \n   ...   A first message will be sent just before the backup process starts, and onother one once the process is finished, with\nthe status. The last message contains only the status. For a full report, you\u2019ll still have to check the email.",
            "title": "Send reports using Jabber."
        },
        {
            "location": "/backup-home/#example-of-success-message",
            "text": "00:15 postmaster: Backup process finished successfully for location \"nas1\"",
            "title": "Example of success message"
        },
        {
            "location": "/backup-home/#example-of-error-message",
            "text": "00:03 postmaster: Backup process failed for location 'nas1' (See the email for details)",
            "title": "Example of error message"
        },
        {
            "location": "/backup-restore/",
            "text": "Partial restoration\n\n\nThis is necessary if you lost a specific email, or if you want to go back in time, and restore a bunch of emails you\ninadvertently deleted.\n\n\nAt this time, the partial restoration is manual and can be done only by root. An easier option to retrieve emails from\nbackups will be provided in a future version. In the mean time, the process has to be manual:\n\n\n\n\nConnect on the server, using SSH, as root.\n\n\nLoad the backup encryption key into your environment.\n\n\nList the backups snapshots, using \nborg list command\n\n\nMount the backup snapshot you are interested in, they are listed by date.\n   You can do this by using the \nborg mount command\n\n\nSearch in the mounted drive for the lost emails, using for instance the excellent midnight commander.\n\n\nCopy the emails at the place of your choice, perhaps in your /home/users/\n/mails/maildir/ folder to make them\n   accessible from an email client.\n\n\nMake sure the copied email files belongs to the right user, otherwise Dovecot won\u2019t be able to read these files.\n   belongs to the right user.\n\n\nThe last thing to do, before disconnecting, is to \u2018unmount\u2019 the backup snapshot, using the\n   \nborg umount command\n\n\nFinally, disconnect from SSH.\n\n\nOpen your email client.\n\n\n\n\nData restoration\n\n\nSomething bad happened, for instance you just deleted a lot of email, contacts or calendar events. In this case, before\nthe next backup occurs and backup your mistake, you can quickly restore your emails, calendar events and contacts, with\njust one line.\n\n\nSo, just run the main borgbackup installation script:\n\n\ncd\n install\nansible-playbook -v -i ../config/hosts.yml -t restore playbooks/borgbackup.yml\n\n\n\n\n\n\n\nNote\n\n\nThis step restores all the emails from the last backup. It does not restore your emails from a \u201cprevious\u201d\nstate. Therefore, it does not delete any emails that have been created \nafter\n the backup. The same is happening for\ncalendar events and contacts.\n\n\n\n\nComplete restoration\n\n\nThis is the disaster recovery option.\n\n\nSomething really bad happened, and you lost your box. Don\u2019t panic, if you have installed the system properly, you can\neasily restore it from scratch, with the all your users\u2019 data. This is done by adding one line in your sysetm.yml file!\n\n\nThe important thing is to have kept the \ndeployment backup folder\n in a safe place, for instance\non an encrypted USB drive.\n\n\nLet\u2019s say you have used Amazon S3 for the daily backup of your system. So, open your system.yml file with your favourite\neditor, and add the line \nrestore: true\n to the backup location you want to restore from. For instance:\n\n\nbackup\n:\n\n  \ninstall\n:\n \ntrue\n\n  \nalerts\n:\n\n    \nfrom\n:\n \n'postmaster@casimir.fx'\n\n    \nrecipient\n:\n \n'hendrick@universiteitleiden.nl'\n\n    \njabber\n:\n \ntrue\n\n  \nlocations\n:\n\n  \n-\n \nname\n:\n \ns3main\n\n\n    \nrestore\n:\n \ntrue\n\n\n    \nurl\n:\n \ns3fs://mnt/backup/s3main/casimir.fx\n\n    \nactive\n:\n \nyes\n\n    \nfrequency\n:\n \ndaily\n\n    \nkeep_daily\n:\n \n7\n\n    \nkeep_weekly\n:\n \n4\n\n    \nkeep_monthly\n:\n \n6\n\n    \naccess_key_id\n:\n \nAKIAM2HEGKRL50SDZTTC\n\n    \nsecret_access_key\n:\n \nMpHag/11PUXRVIDSKMV8YQZZDW95IGDV\n\n    \nbucket_name\n:\n \ncasimir.fx\n\n    \nregion\n:\n \neu-west-2\n\n    \ncheck_frequency\n:\n \nweekly\n\n\n\n\n\n\nNow, run the main installation script, to completely reinstall the system. For instance:\n\n\ncd\n install\nansible-playbook -v -i ../config/hosts.yml playbooks/main.yml\n\n\n\n\n\nDepending on the amount of data, the network speed and computer power, the whole installation is taking enough time for\nyou to have a well deserved break. Prepare yourself a nice cup of tea or coffee. Once installed, you should have all\nyour emails from the last backup restored.\n\n\n\n\nTip\n\n\nYou can perfectly restore from multiple location, by adding the line \nrestore: true\n to each backup location. In\nthis case, the data will be merged, so you won\u2019t have duplicate emails, calendar events or contacts.\n\n\n\n\n\n\nNote\n\n\nIn this example, an email and a Jabber message are sent after the system has been restored.",
            "title": "Backup restoration"
        },
        {
            "location": "/backup-restore/#partial-restoration",
            "text": "This is necessary if you lost a specific email, or if you want to go back in time, and restore a bunch of emails you\ninadvertently deleted.  At this time, the partial restoration is manual and can be done only by root. An easier option to retrieve emails from\nbackups will be provided in a future version. In the mean time, the process has to be manual:   Connect on the server, using SSH, as root.  Load the backup encryption key into your environment.  List the backups snapshots, using  borg list command  Mount the backup snapshot you are interested in, they are listed by date.\n   You can do this by using the  borg mount command  Search in the mounted drive for the lost emails, using for instance the excellent midnight commander.  Copy the emails at the place of your choice, perhaps in your /home/users/ /mails/maildir/ folder to make them\n   accessible from an email client.  Make sure the copied email files belongs to the right user, otherwise Dovecot won\u2019t be able to read these files.\n   belongs to the right user.  The last thing to do, before disconnecting, is to \u2018unmount\u2019 the backup snapshot, using the\n    borg umount command  Finally, disconnect from SSH.  Open your email client.",
            "title": "Partial restoration"
        },
        {
            "location": "/backup-restore/#data-restoration",
            "text": "Something bad happened, for instance you just deleted a lot of email, contacts or calendar events. In this case, before\nthe next backup occurs and backup your mistake, you can quickly restore your emails, calendar events and contacts, with\njust one line.  So, just run the main borgbackup installation script:  cd  install\nansible-playbook -v -i ../config/hosts.yml -t restore playbooks/borgbackup.yml   Note  This step restores all the emails from the last backup. It does not restore your emails from a \u201cprevious\u201d\nstate. Therefore, it does not delete any emails that have been created  after  the backup. The same is happening for\ncalendar events and contacts.",
            "title": "Data restoration"
        },
        {
            "location": "/backup-restore/#complete-restoration",
            "text": "This is the disaster recovery option.  Something really bad happened, and you lost your box. Don\u2019t panic, if you have installed the system properly, you can\neasily restore it from scratch, with the all your users\u2019 data. This is done by adding one line in your sysetm.yml file!  The important thing is to have kept the  deployment backup folder  in a safe place, for instance\non an encrypted USB drive.  Let\u2019s say you have used Amazon S3 for the daily backup of your system. So, open your system.yml file with your favourite\neditor, and add the line  restore: true  to the backup location you want to restore from. For instance:  backup : \n   install :   true \n   alerts : \n     from :   'postmaster@casimir.fx' \n     recipient :   'hendrick@universiteitleiden.nl' \n     jabber :   true \n   locations : \n   -   name :   s3main       restore :   true       url :   s3fs://mnt/backup/s3main/casimir.fx \n     active :   yes \n     frequency :   daily \n     keep_daily :   7 \n     keep_weekly :   4 \n     keep_monthly :   6 \n     access_key_id :   AKIAM2HEGKRL50SDZTTC \n     secret_access_key :   MpHag/11PUXRVIDSKMV8YQZZDW95IGDV \n     bucket_name :   casimir.fx \n     region :   eu-west-2 \n     check_frequency :   weekly   Now, run the main installation script, to completely reinstall the system. For instance:  cd  install\nansible-playbook -v -i ../config/hosts.yml playbooks/main.yml  Depending on the amount of data, the network speed and computer power, the whole installation is taking enough time for\nyou to have a well deserved break. Prepare yourself a nice cup of tea or coffee. Once installed, you should have all\nyour emails from the last backup restored.   Tip  You can perfectly restore from multiple location, by adding the line  restore: true  to each backup location. In\nthis case, the data will be merged, so you won\u2019t have duplicate emails, calendar events or contacts.    Note  In this example, an email and a Jabber message are sent after the system has been restored.",
            "title": "Complete restoration"
        },
        {
            "location": "/deployment-backup/",
            "text": "The files in these folders are excluded from the git repository. When deploying for the first time, they will contain\nsome important files, to avoid being regenerated every time you are running the Ansible scripts.\n\n\nThis is useful, both for archiving purposes and during the development phase. It will also alows you to restore your\nserver, with all the data, user accounts, certificates, passwords, encryption keys. etc. very easily.\n\n\nA sub-folder named after your domain is created in this \u201cbackup\u201d folder. So you can use the same repository to work on\nmultiple domains.\n\n\nCertificates\n\n\nWhen developing and testing homebox, you can optionally backup the letsencrypt certificates. This allows you to redeploy\nthe certificates without requesting new ones, and therefore decrease development cycle. This is also very important, to\navoid requesting the certificates again and again, and being blocked by LetsEncrypt.\n\n\nsystem\n:\n\n\n  \ndevel\n:\n \ntrue\n\n\n  \ndebug\n:\n \ntrue\n\n\n\n\n\n\nThe certificates requested are \n\u201cstaging\u201d letsencrypt certificates\n,\ni.e. they do not work without displaying a warning in the client\u2019s sofwate, unless a specific certificate authority is\ninstalled.\n\n\nWhen using a live version, the certificates are not saved, and need to be requested again on each deployment, unless\nyou are using the option \nsystem.keep_certs\n:\n\n\nsystem\n:\n\n  \ndevel\n:\n \nfalse\n\n  \ndebug\n:\n \nfalse\n\n\n  \nkeep_certs\n:\n \ntrue\n\n\n\n\n\n\n\n\nWarning\n\n\nThis allows you to backup live letsencrypt certificate, and can be useful in a pre-production environment, where a\ncontinuous integration test need real certificates. Make sure your workstation is secure enough.\n\n\n\n\nSee the system configuration section in the \ndevelopment page\n for more details.\n\n\nFor instance, here some of the certificates generated, for the domain \u201chomebox.space\u201d\n\n\n\n\nimap.homebox.space\n\n\nldap.homebox.space\n\n\nsmtp.homebox.space\n\n\nwebmail.homebox.space\n\n\nautodiscover.homebox.space (when using autodiscover from Outlook)\n\n\nwww\n.homebox.space and homebox.space (When activating the option simple web site)\n\n\n\n\nWhen deploying the live version, the certificates are generated on the server, and not backed up.\n\n\nDKIM Keys\n\n\nThis folder contains the DKIM keys generated on the server. The installation script will compare these DKIM public key\nwith the one recorded in your DNS, and will update it only if different.\n\n\nSystem passwords\n\n\nThe \u2018ldap\u2019 folder contains the passwords generated automatically for some accounts in the LDAP directory\n\n\n\n\nadmin.pwd: Super administrator password, read/write on the entire LDAP system\n\n\nmanager.pwd: Manager: read/write access to user accounts\n\n\nreadonly.pwd: readonly account to query the ldap server\n\n\nimport.pwd: Master account used to inject imported external emails into the user\u2019s emails.\n\n\npostmaster.pwd: Postmaster account, that receives, for instance, emails like postmaster@domain.com or\n  webmaster@domain.com.\n\n\n\n\nRspamd administration interface\n\n\nThe Antispam comes with an excellent \nweb interface\n that provides basic functions for\nsetting metric actions, scores, viewing statistic and learning.\n\n\nEncryption keys\n\n\nThe encrypted keys generated by the system are stored in the \nencryption\n folder.\n\n\nWhen you have activated the backup option, the backup encryption passphrase is stored in this folder in a file named\n\nbackup.pwd\n. \nDo not loose thise file if you want to be able to restore your system from scratch\n.\n\n\nThe file \nsystem-key.pwd\n contains a passphrase keys used to encrypt local files. This is actually used to encrypt the\ncredentials for the \nexternal accounts\n emails import.\n\n\nBackup Encryption keys\n\n\nThe backup encryption keys, generated by borg backup software are going inside the folder \nbackup-keys\n, These keys are\nnamed after your backup location. \nDo not loose thise file if you want to be able to restore your system from\nscratch\n.\n\n\nSSH Keys\n\n\nThis folder contains the ssh keys generated for the root user, when you are using backup via an SFTP folder. You can\ncopy the public ssh key on the backup server, for a user named \u201cbackup\u201d. This is explained in more details in the\n\nbackup documentation\n.",
            "title": "Backup your deployment"
        },
        {
            "location": "/deployment-backup/#certificates",
            "text": "When developing and testing homebox, you can optionally backup the letsencrypt certificates. This allows you to redeploy\nthe certificates without requesting new ones, and therefore decrease development cycle. This is also very important, to\navoid requesting the certificates again and again, and being blocked by LetsEncrypt.  system :     devel :   true     debug :   true   The certificates requested are  \u201cstaging\u201d letsencrypt certificates ,\ni.e. they do not work without displaying a warning in the client\u2019s sofwate, unless a specific certificate authority is\ninstalled.  When using a live version, the certificates are not saved, and need to be requested again on each deployment, unless\nyou are using the option  system.keep_certs :  system : \n   devel :   false \n   debug :   false     keep_certs :   true    Warning  This allows you to backup live letsencrypt certificate, and can be useful in a pre-production environment, where a\ncontinuous integration test need real certificates. Make sure your workstation is secure enough.   See the system configuration section in the  development page  for more details.  For instance, here some of the certificates generated, for the domain \u201chomebox.space\u201d   imap.homebox.space  ldap.homebox.space  smtp.homebox.space  webmail.homebox.space  autodiscover.homebox.space (when using autodiscover from Outlook)  www .homebox.space and homebox.space (When activating the option simple web site)   When deploying the live version, the certificates are generated on the server, and not backed up.",
            "title": "Certificates"
        },
        {
            "location": "/deployment-backup/#dkim-keys",
            "text": "This folder contains the DKIM keys generated on the server. The installation script will compare these DKIM public key\nwith the one recorded in your DNS, and will update it only if different.",
            "title": "DKIM Keys"
        },
        {
            "location": "/deployment-backup/#system-passwords",
            "text": "The \u2018ldap\u2019 folder contains the passwords generated automatically for some accounts in the LDAP directory   admin.pwd: Super administrator password, read/write on the entire LDAP system  manager.pwd: Manager: read/write access to user accounts  readonly.pwd: readonly account to query the ldap server  import.pwd: Master account used to inject imported external emails into the user\u2019s emails.  postmaster.pwd: Postmaster account, that receives, for instance, emails like postmaster@domain.com or\n  webmaster@domain.com.",
            "title": "System passwords"
        },
        {
            "location": "/deployment-backup/#rspamd-administration-interface",
            "text": "The Antispam comes with an excellent  web interface  that provides basic functions for\nsetting metric actions, scores, viewing statistic and learning.",
            "title": "Rspamd administration interface"
        },
        {
            "location": "/deployment-backup/#encryption-keys",
            "text": "The encrypted keys generated by the system are stored in the  encryption  folder.  When you have activated the backup option, the backup encryption passphrase is stored in this folder in a file named backup.pwd .  Do not loose thise file if you want to be able to restore your system from scratch .  The file  system-key.pwd  contains a passphrase keys used to encrypt local files. This is actually used to encrypt the\ncredentials for the  external accounts  emails import.",
            "title": "Encryption keys"
        },
        {
            "location": "/deployment-backup/#backup-encryption-keys",
            "text": "The backup encryption keys, generated by borg backup software are going inside the folder  backup-keys , These keys are\nnamed after your backup location.  Do not loose thise file if you want to be able to restore your system from\nscratch .",
            "title": "Backup Encryption keys"
        },
        {
            "location": "/deployment-backup/#ssh-keys",
            "text": "This folder contains the ssh keys generated for the root user, when you are using backup via an SFTP folder. You can\ncopy the public ssh key on the backup server, for a user named \u201cbackup\u201d. This is explained in more details in the backup documentation .",
            "title": "SSH Keys"
        },
        {
            "location": "/backup-server/",
            "text": "The homebox platform can be configured to act as a backup server for your home network, using\n\nborg-backup\n software.\n\n\nIdeal configuration\n\n\n\n\nThis configuration allows you to use encryption and incremental backups, with a plain basic local or remote storage,\nlike a USB RAID enclosure or a remote samba share.\n\n\nIt will automatically use the first backup location you have defined. For instance, if you have configured hombox to\nbackup on local USB drive and on a remote SAMBA share, the local drive will be used for storage:\n\n\nLocal backup only\n\n\n\n\nIf you do not have an external device to store the backup, you can still use homebox as a backup server. In this case,\nthe files will be stored in the home folder, for each user, using the same principle.\n\n\nThis is obviously less safe than using a remote or external device to backup. You can mitigate the risk by using\n\nsoftware RAID\n in the preseed file.\n\n\nTutorial\n\n\nIn this example, you will see how to set up a backup solution on a USB NAS attached to your homebox.\n\n\nYour backup configuration should look like this:\n\n\n# Install backup scripts\n\n\nbackup\n:\n\n  \ninstall\n:\n \ntrue\n\n  \ntype\n:\n \nborgbackup\n\n  \nalerts\n:\n\n    \njabber\n:\n \ntrue\n\n  \nlocations\n:\n\n  \n-\n \nname\n:\n \nnas1\n\n    \nautomount\n:\n \ntrue\n\n    \nurl\n:\n \nusb://mnt/backup/nas1/homebox\n\n    \nuuid\n:\n \nc09c23de-97b6-492b-9c7f-e3cd894862d1\n\n    \nactive\n:\n \nyes\n\n    \nfrequency\n:\n \ndaily\n\n    \nkeep_daily\n:\n \n7\n\n    \nkeep_monthly\n:\n \n12\n\n    \nidle_sec\n:\n \n60\n\n\n\n\n\n\nIn this example, each user will have a dedicated directory accessible over SSH, on the USB drive \u2018nas1\u2019. Under the hood,\nthis is done in the SSH authorized_keys configuration file on the server.\n\n\nThis is an example on how to back-up a folder in your home directory. You need to have borg-backup installed on your\nworkstations, and to have created an SSH key, dedicated for backup.\n\n\nStep 1: Configure the connection\n\n\nExample of the syntax to use in your \n~/.ssh/config\n configuration file:\n\n\nHost backup.homebox.space\n  User bob\n  IdentityFile ~/.ssh/backup.rsa\n\n\n\n\n\nStep 2: Initialise the backup\n\n\nFirst, you need to initialise a backup repository on your machine:\n\n\nEnter new passphrase:\nEnter same passphrase again:\nDo you want your passphrase to be displayed \nfor\n verification? \n[\nyN\n]\n:\n\nBy default repositories initialized with this version will produce security\nerrors \nif\n written to with an older version \n(\nup to and including Borg \n1\n.0.8\n)\n.\n\nIf you want to use these older versions, you can disable the check by running:\nborg upgrade --disable-tam ssh://bob@backup.homebox.space/mnt/backup/local/bob/books\n\nSee https://borgbackup.readthedocs.io/en/stable/changes.html#pre-1-0-9-manifest-spoofing-vulnerability \nfor\n details about the security implications.\n\nIMPORTANT: you will need both KEY AND PASSPHRASE to access this repo!\nUse \n\"borg key export\"\n to \nexport\n the key, optionally in printable format.\nWrite down the passphrase. Store both at safe place\n(\ns\n)\n.\n\n\n\n\n\nStep 3: create the first backup\n\n\nThen, create the backup itself:\n\n\nbob@workstation:~ $ borg create --progress bob@backup.homebox.space:/mnt/backup/nas1/bob/Documents::Documents Documents\nEnter passphrase \nfor\n key /home/bob/.config/borg/keys/backup_homebox_space__mnt_backup_nas1_bob_backups:",
            "title": "Backup server"
        },
        {
            "location": "/backup-server/#ideal-configuration",
            "text": "This configuration allows you to use encryption and incremental backups, with a plain basic local or remote storage,\nlike a USB RAID enclosure or a remote samba share.  It will automatically use the first backup location you have defined. For instance, if you have configured hombox to\nbackup on local USB drive and on a remote SAMBA share, the local drive will be used for storage:",
            "title": "Ideal configuration"
        },
        {
            "location": "/backup-server/#local-backup-only",
            "text": "If you do not have an external device to store the backup, you can still use homebox as a backup server. In this case,\nthe files will be stored in the home folder, for each user, using the same principle.  This is obviously less safe than using a remote or external device to backup. You can mitigate the risk by using software RAID  in the preseed file.",
            "title": "Local backup only"
        },
        {
            "location": "/backup-server/#tutorial",
            "text": "In this example, you will see how to set up a backup solution on a USB NAS attached to your homebox.  Your backup configuration should look like this:  # Install backup scripts  backup : \n   install :   true \n   type :   borgbackup \n   alerts : \n     jabber :   true \n   locations : \n   -   name :   nas1 \n     automount :   true \n     url :   usb://mnt/backup/nas1/homebox \n     uuid :   c09c23de-97b6-492b-9c7f-e3cd894862d1 \n     active :   yes \n     frequency :   daily \n     keep_daily :   7 \n     keep_monthly :   12 \n     idle_sec :   60   In this example, each user will have a dedicated directory accessible over SSH, on the USB drive \u2018nas1\u2019. Under the hood,\nthis is done in the SSH authorized_keys configuration file on the server.  This is an example on how to back-up a folder in your home directory. You need to have borg-backup installed on your\nworkstations, and to have created an SSH key, dedicated for backup.",
            "title": "Tutorial"
        },
        {
            "location": "/backup-server/#step-1-configure-the-connection",
            "text": "Example of the syntax to use in your  ~/.ssh/config  configuration file:  Host backup.homebox.space\n  User bob\n  IdentityFile ~/.ssh/backup.rsa",
            "title": "Step 1: Configure the connection"
        },
        {
            "location": "/backup-server/#step-2-initialise-the-backup",
            "text": "First, you need to initialise a backup repository on your machine:  Enter new passphrase:\nEnter same passphrase again:\nDo you want your passphrase to be displayed  for  verification?  [ yN ] :\n\nBy default repositories initialized with this version will produce security\nerrors  if  written to with an older version  ( up to and including Borg  1 .0.8 ) .\n\nIf you want to use these older versions, you can disable the check by running:\nborg upgrade --disable-tam ssh://bob@backup.homebox.space/mnt/backup/local/bob/books\n\nSee https://borgbackup.readthedocs.io/en/stable/changes.html#pre-1-0-9-manifest-spoofing-vulnerability  for  details about the security implications.\n\nIMPORTANT: you will need both KEY AND PASSPHRASE to access this repo!\nUse  \"borg key export\"  to  export  the key, optionally in printable format.\nWrite down the passphrase. Store both at safe place ( s ) .",
            "title": "Step 2: Initialise the backup"
        },
        {
            "location": "/backup-server/#step-3-create-the-first-backup",
            "text": "Then, create the backup itself:  bob@workstation:~ $ borg create --progress bob@backup.homebox.space:/mnt/backup/nas1/bob/Documents::Documents Documents\nEnter passphrase  for  key /home/bob/.config/borg/keys/backup_homebox_space__mnt_backup_nas1_bob_backups:",
            "title": "Step 3: create the first backup"
        },
        {
            "location": "/zabbix/",
            "text": "Zabbix monitoring\n\n\n\n\nDefault configuration\n\n\nBy default, the zabbix web interface is only accessible through the\nlocal network, via https. Also, the guest account is deleted upon\ninstallation.\n\n\nA strong password is generated for the administrator account. After\nthe deployment, the password is stored in the deployment backup\nfolder, in \nzabbix/admin.pwd\n.\n\n\nMinimal configuration\n\n\nzabbix\n:\n\n  \ninstall\n:\n \ntrue\n\n\n\n\n\n\nDefault configuration\n\n\n# Zabbix monitoring\n\n\nzabbix_default\n:\n\n  \ninstall\n:\n \nfalse\n\n  \nguest_account\n:\n \nfalse\n  \n# Allow guest account or not\n\n  \npublic\n:\n \nfalse\n         \n# not open to public by default\n\n  \nallow\n:\n                \n# a list of IP address that can access the web interface\n\n    \n-\n \n192.168.0.0/16\n    \n# RFC1918 local networks\n\n    \n-\n \n172.16.0.0/12\n\n    \n-\n \n10.0.0.0/8\n\n\n\n\n\n\nSetting up Jabber alerts\n\n\nTo receive alerts via the XMPP protocol, it is necessary to activate\nthe Jabber \nmedia type\n inthe Zabbix administration console.\n\n\nUse any account to send alerts, for instance the postmaster account.\n\n\n\n\nOnce this setup, the alerts are visible in any XMPP compatible client.",
            "title": "Monitoring with Zabbix"
        },
        {
            "location": "/zabbix/#zabbix-monitoring",
            "text": "",
            "title": "Zabbix monitoring"
        },
        {
            "location": "/zabbix/#default-configuration",
            "text": "By default, the zabbix web interface is only accessible through the\nlocal network, via https. Also, the guest account is deleted upon\ninstallation.  A strong password is generated for the administrator account. After\nthe deployment, the password is stored in the deployment backup\nfolder, in  zabbix/admin.pwd .",
            "title": "Default configuration"
        },
        {
            "location": "/zabbix/#minimal-configuration",
            "text": "zabbix : \n   install :   true",
            "title": "Minimal configuration"
        },
        {
            "location": "/zabbix/#default-configuration_1",
            "text": "# Zabbix monitoring  zabbix_default : \n   install :   false \n   guest_account :   false    # Allow guest account or not \n   public :   false           # not open to public by default \n   allow :                  # a list of IP address that can access the web interface \n     -   192.168.0.0/16      # RFC1918 local networks \n     -   172.16.0.0/12 \n     -   10.0.0.0/8",
            "title": "Default configuration"
        },
        {
            "location": "/zabbix/#setting-up-jabber-alerts",
            "text": "To receive alerts via the XMPP protocol, it is necessary to activate\nthe Jabber  media type  inthe Zabbix administration console.  Use any account to send alerts, for instance the postmaster account.   Once this setup, the alerts are visible in any XMPP compatible client.",
            "title": "Setting up Jabber alerts"
        },
        {
            "location": "/maintenance/",
            "text": "Connecting on your server\n\n\nTo connect on your server, you can use SSH to administer it, like doing your packages update.\n\n\nAdding or updating user accounts\n\n\nAt this date, there is no web interface or graphical user interface included to update the add, remove or edit user\naccounts. Maybe a web interface will be added later.  In the mean time, here some procedures you can follow.\n\n\nChanging passwords\n\n\nIf you only need to change an account password, you can use the command line interface and the passwd command via SSH.\n\n\npasswd john\n\n\n\n\n\nYou might have to respect the password policies in place, like minimal length and complexity.\n\n\nAdd or remove email aliases\n\n\nUpdating the email aliases for a user is very easy. First, modify the aliases section for the user, in the system.yml\nconfiguration file:\n\n\n-\n \nuid\n:\n \nmike\n\n  \ncn\n:\n \nMike Dear\n\n  \nfirst_name\n:\n \nMike\n\n  \nlast_name\n:\n \nDear\n\n  \nmail\n:\n \nmike.dear@example.com\n\n  \npassword\n:\n \n'n~wI*rhf873'\n\n\n  \naliases\n:\n\n\n    \n-\n \nmike@homebox.space\n\n\n    \n-\n \nmikael@homebox.space\n\n\n\n\n\n\nThen, run the Ansible playbook called \nldap-refresh.yml\n. This playbook refresh the email aliases only, and does not\ntouch anything else. It will also remove any email alias previously added if it is not in the list.\n\n\nAdding a user account\n\n\nThe best way is to modify the users section ofyour system.yml configuration file and to run an Ansible scripts\nagain. The main advantage of this, is that the database will be up to date if you need to deploy your server again.\n\n\nFirst, add a new user in the users list:\n\n\nusers\n:\n\n  \n...\n\n\n-\n \nuid\n:\n \nmike\n\n  \ncn\n:\n \nMike Dear\n\n  \nfirst_name\n:\n \nMike\n\n  \nlast_name\n:\n \nDear\n\n  \nmail\n:\n \nmike.dear@example.com\n\n  \npassword\n:\n \n'n~wI*rhf873'\n\n  \naliases\n:\n\n    \n-\n \nmike@homebox.space\n\n\n\n\n\n\nThen, run the dedicated playbook to update users:\n\n\ncd\n install\nansible-playbook -v -i ../config/hosts.yml playbooks/update-users.yml\n\n\n\n\n\nThe home playbook create the home directories for this user.\n\n\nModifying a user account\n\n\nIf you want to directly modify a user account specified in your LDAP settings, there is a script installed in\n\n/usr/local/sbin/ldap-user-edit\n. With his script, you can directly modify an LDAP user account, from your system.\n\n\nIt is a wrapper around ldapvi, so you will be able to quicly edit any user, for instance to update an email address or\nan alias, or to fix a typo in the username. This is not meant to major modifications.\n\n\n\n\nWarning\n\n\nAny modification made this way will not be part of a disaster recovery. You will need to reflect the change in your\nsystem.yml too.\n\n\n\n\nRemoving user accounts\n\n\nThere is not yet an Ansible script to remove a user account, this will be added soon. In the mean time, any LDAP\ncompliant script, like \nldapdelete\n should be enough.\n\n\nUpdating the system\n\n\nThis can be done through SSH, like you are doing on any Debian server.\n\n\nAdding or removing components\n\n\nIf you have not modified the system configuration files too much, you should be able to add components just by updating\nyour system.yml configuration file, and running the Ansible scripts again.\n\n\nRemoving components entirely is not so easy, and is not entirely supported for now. However, you should be able to\nremove them using the standard Debian packaging system, i.e. \ndpkg\n.\n\n\nRemoving ClamAV\n\n\nBecause postfix is configured to filter emails through ClamAV, you will have to re-run the\nAnsible scripts to install Postfix again.\n\n\n\n\nRemove the Clamav packages\n\n\nUpdate your system.yml file\n\n\nRun the Ansible main.yml script again\n\n\n\n\nRemoving rspamd\n\n\nBecause postfix is configured to filter emails through ClamAV, you will have to re-run the\nAnsible scripts to install Postfix again.\n\n\n\n\nRemove the rspamd packages\n\n\nUpdate your system.yml file\n\n\nRun the Ansible main.yml script again\n\n\n\n\nAutomatic configuration sites\n\n\nThe easiest way is probably to remove the site from the enabled one, and restart nginx:\n\n\nFor \nMozilla Thunderbird\n Autoconfig\n\n\nrm -f /etc/nginx/sites-enabled/autoconfig.<your domain>\nsystemctl restart nginx\n\n\n\n\n\nFor \nMicrosoft Outlook\n Autodiscover\n\n\nrm -f /etc/nginx/sites-enabled/autodiscover.<your domain>\nsystemctl restart nginx\n\n\n\n\n\nRestarting the system\n\n\nIf you have installed the system with the main drive encrypted using LUKS, you need to keep a way to decrypt your drive,\nlocally or remotely\n\n\nWith physical access\n\n\nPlug a screen and a keyboard, and type your passphrase when the system boot.\n\n\nWith physical access and a Yubikey\n\n\nIf you chose to decrypt your drive with a Yubikey, just insert the Yubikey, and press enter.\n\n\nRemotely over SSH\n\n\nWhen the system starts, a small SSH server is started, which allows you to decrypt the drive remotely.\nHere an example using a command line SSH client:\n\n\nandre@london:~ $ ssh root@rodier.me\n\nTo unlock root partition, and maybe others like swap, run \n`\ncryptroot-unlock\n`\n\n\n\nBusyBox v1.22.1 \n(\nDebian \n1\n:1.22.0-19+b3\n)\n built-in shell \n(\nash\n)\n\nEnter \n'help'\n \nfor\n a list of built-in commands.\n\n~ \n# cryptroot-unlock\n\nPlease unlock disk sda5_crypt:\ncryptsetup: sda5_crypt \nset\n up successfully\n~ \n# Connection to 192.168.32.12 closed by remote host.\n\nConnection to \n192\n.168.32.12 closed.",
            "title": "Maintenance"
        },
        {
            "location": "/maintenance/#connecting-on-your-server",
            "text": "To connect on your server, you can use SSH to administer it, like doing your packages update.",
            "title": "Connecting on your server"
        },
        {
            "location": "/maintenance/#adding-or-updating-user-accounts",
            "text": "At this date, there is no web interface or graphical user interface included to update the add, remove or edit user\naccounts. Maybe a web interface will be added later.  In the mean time, here some procedures you can follow.",
            "title": "Adding or updating user accounts"
        },
        {
            "location": "/maintenance/#changing-passwords",
            "text": "If you only need to change an account password, you can use the command line interface and the passwd command via SSH.  passwd john  You might have to respect the password policies in place, like minimal length and complexity.",
            "title": "Changing passwords"
        },
        {
            "location": "/maintenance/#add-or-remove-email-aliases",
            "text": "Updating the email aliases for a user is very easy. First, modify the aliases section for the user, in the system.yml\nconfiguration file:  -   uid :   mike \n   cn :   Mike Dear \n   first_name :   Mike \n   last_name :   Dear \n   mail :   mike.dear@example.com \n   password :   'n~wI*rhf873'     aliases :       -   mike@homebox.space       -   mikael@homebox.space   Then, run the Ansible playbook called  ldap-refresh.yml . This playbook refresh the email aliases only, and does not\ntouch anything else. It will also remove any email alias previously added if it is not in the list.",
            "title": "Add or remove email aliases"
        },
        {
            "location": "/maintenance/#adding-a-user-account",
            "text": "The best way is to modify the users section ofyour system.yml configuration file and to run an Ansible scripts\nagain. The main advantage of this, is that the database will be up to date if you need to deploy your server again.  First, add a new user in the users list:  users : \n   ...  -   uid :   mike \n   cn :   Mike Dear \n   first_name :   Mike \n   last_name :   Dear \n   mail :   mike.dear@example.com \n   password :   'n~wI*rhf873' \n   aliases : \n     -   mike@homebox.space   Then, run the dedicated playbook to update users:  cd  install\nansible-playbook -v -i ../config/hosts.yml playbooks/update-users.yml  The home playbook create the home directories for this user.",
            "title": "Adding a user account"
        },
        {
            "location": "/maintenance/#modifying-a-user-account",
            "text": "If you want to directly modify a user account specified in your LDAP settings, there is a script installed in /usr/local/sbin/ldap-user-edit . With his script, you can directly modify an LDAP user account, from your system.  It is a wrapper around ldapvi, so you will be able to quicly edit any user, for instance to update an email address or\nan alias, or to fix a typo in the username. This is not meant to major modifications.   Warning  Any modification made this way will not be part of a disaster recovery. You will need to reflect the change in your\nsystem.yml too.",
            "title": "Modifying a user account"
        },
        {
            "location": "/maintenance/#removing-user-accounts",
            "text": "There is not yet an Ansible script to remove a user account, this will be added soon. In the mean time, any LDAP\ncompliant script, like  ldapdelete  should be enough.",
            "title": "Removing user accounts"
        },
        {
            "location": "/maintenance/#updating-the-system",
            "text": "This can be done through SSH, like you are doing on any Debian server.",
            "title": "Updating the system"
        },
        {
            "location": "/maintenance/#adding-or-removing-components",
            "text": "If you have not modified the system configuration files too much, you should be able to add components just by updating\nyour system.yml configuration file, and running the Ansible scripts again.  Removing components entirely is not so easy, and is not entirely supported for now. However, you should be able to\nremove them using the standard Debian packaging system, i.e.  dpkg .",
            "title": "Adding or removing components"
        },
        {
            "location": "/maintenance/#removing-clamav",
            "text": "Because postfix is configured to filter emails through ClamAV, you will have to re-run the\nAnsible scripts to install Postfix again.   Remove the Clamav packages  Update your system.yml file  Run the Ansible main.yml script again",
            "title": "Removing ClamAV"
        },
        {
            "location": "/maintenance/#removing-rspamd",
            "text": "Because postfix is configured to filter emails through ClamAV, you will have to re-run the\nAnsible scripts to install Postfix again.   Remove the rspamd packages  Update your system.yml file  Run the Ansible main.yml script again",
            "title": "Removing rspamd"
        },
        {
            "location": "/maintenance/#automatic-configuration-sites",
            "text": "The easiest way is probably to remove the site from the enabled one, and restart nginx:  For  Mozilla Thunderbird  Autoconfig  rm -f /etc/nginx/sites-enabled/autoconfig.<your domain>\nsystemctl restart nginx  For  Microsoft Outlook  Autodiscover  rm -f /etc/nginx/sites-enabled/autodiscover.<your domain>\nsystemctl restart nginx",
            "title": "Automatic configuration sites"
        },
        {
            "location": "/maintenance/#restarting-the-system",
            "text": "If you have installed the system with the main drive encrypted using LUKS, you need to keep a way to decrypt your drive,\nlocally or remotely",
            "title": "Restarting the system"
        },
        {
            "location": "/maintenance/#with-physical-access",
            "text": "Plug a screen and a keyboard, and type your passphrase when the system boot.",
            "title": "With physical access"
        },
        {
            "location": "/maintenance/#with-physical-access-and-a-yubikey",
            "text": "If you chose to decrypt your drive with a Yubikey, just insert the Yubikey, and press enter.",
            "title": "With physical access and a Yubikey"
        },
        {
            "location": "/maintenance/#remotely-over-ssh",
            "text": "When the system starts, a small SSH server is started, which allows you to decrypt the drive remotely.\nHere an example using a command line SSH client:  andre@london:~ $ ssh root@rodier.me\n\nTo unlock root partition, and maybe others like swap, run  ` cryptroot-unlock ` \n\n\nBusyBox v1.22.1  ( Debian  1 :1.22.0-19+b3 )  built-in shell  ( ash ) \nEnter  'help'   for  a list of built-in commands.\n\n~  # cryptroot-unlock \nPlease unlock disk sda5_crypt:\ncryptsetup: sda5_crypt  set  up successfully\n~  # Connection to 192.168.32.12 closed by remote host. \nConnection to  192 .168.32.12 closed.",
            "title": "Remotely over SSH"
        },
        {
            "location": "/development/",
            "text": "External mailing lists\n\n\nIf something goes wrong, here a few resources:\n\n\n\n\nThe \nPostfix mailing lists\n.\n\n\nThe \nDovecot mailing lists\n.\n\n\nThe \nDebian mailing lists\n.\n\n\nOur \ngithub page\n\n\nFinally, \nDuckduckgo\n or \nGoogle\n.\n\n\n\n\nFolders content\n\n\nThe repository contains a few folders you should be familiar with:\n\n\n\n\nconfig: The main Yaml configuration files for your homebox device.\n\n\npreseed: Docker environment to create an automatic ISO image installer for Debian.\n\n\ninstall: Ansible scripts to install or test the whole server environment.\n\n\nbackup: A very useful folder that contains some important files like the passwords and certificates generated when\n  deploying the system. This allows you to \u201creplay\u201d the deployment on a new server after a disaster, without loosing any\n  information. This folder is generated automatically on the first deployment, and ignored by git\n\n\ntests: Ansible playbooks to test the platform.\n\n\nsandbox: Put anything you don\u2019t want to commit here.\n\n\ndocs: This project documentation.\n\n\nuninstall: Ansible scripts to uninstall some of the components. This allows you to test them.\n\n\n\n\nBranches\n\n\n\n\nThe current developments are done in the \ndev\n branch.\n\n\nThe master branch is kept for releases.\n\n\n\n\nStarting in May 2019, the approach will be to use gitflow, from the dev branch.\n\n\nTest machine\n\n\nYou can start to develop using a virtual machine on your workstation, for instance using\nKVM or VirtualBox. The environment runs on Debian Stable. You can install it using a\nminimalistic ISO image, called \nnetinst\n.\n\n\nI suggest you to use a virtual machine to test, especially with snapshots capabilities.\nBy using snapshots, you can rollback to any stage and run the Ansible scripts again. On\nLinux, KVM/libvirt is the best choice, and VirtualBox might be acceptable.\n\n\nFor instance:\n\n\napt-get install libvirt virt-manager\n\n\nPreseed\n\n\nThere is a preseed folder that creates an an ISO image for automatic installation.  It is\nusing Docker, and builds an automatic installer from a YAML configuration file.\nThe \npreseed page\n give more details about this feature.\n\n\n\n\nNote\n\n\nThis installer installs Debian only, it does not deploy the platform.\n\n\n\n\nRouter configuration\n\n\nUnless your IP address changes too often or your port 25 is blocked, you do not need to\nhave a fixed IP address.\n\n\nHowever, the more you want to test, the more your router need to be configured:\n\n\n\n\nTCP/80 (HTTP): Used to query letsencrypt for the certificates. Open it at least to\n  obtain the SSL using LetsEncrypt. You can then close the port once you have the\n  certificates.\n\n\nTCP/25: SMTP, to receive and transfer emails from and to other SMTP servers on\n  internet. You need this one only to test the reception and transmission of external\n  emails.\n\n\n\n\nNow, all the rest can be done internally, without exposing your test machine. These ports\ndon\u2019t need to be forwarded by your router during the development time:\n\n\n\n\nTCP/143 and TCP/993 : IMAP and IMAPS\n\n\nTCP/110 and TCP/995 : POP3 and POP3S\n\n\nTCP/587 : \nSubmission\n.\n\n\nTCP/465 : \nSMTPS\n (this on is kept for\n  compatibility with some old devices, but perhaps will be removed soon)\n\n\nTCP/4190 : ManageSieve. Used to remotely access your mail filters, for instance with\n  \nthunderbird sieve plugin\n.\n\n\nTCP/443 : HTTPS access for the webmail and also Outlook autodiscover feature.\n\n\nTCP/5222 and TCP/5269 : Jabber, clients to server and server to server implementation.\n\n\nUDP/53 and TCP/53 : DNS Server.\n\n\n\n\nBridging your workstation\n\n\nIf you are using a virtual machine, it is better to use a bridge on your workstation, to\ntransparently forward the traffic from internet.\n\n\n\n\nOn Debian: https://wiki.debian.org/BridgeNetworkConnections\n\n\nOn Linux arch: \nNetwork bridge\n\n\nA fancy guide on Ubuntu:\n  \nLinux bridge with Network Manager\n\n\n\n\nDNS Setup\n\n\nThere is a script that actually updates automatically DNS entries, if you are using Gandi.\nFor development, the simplest is to add a wilcard entry in your DNS, that would point to\nyour virtual machine.\n\n\nThe initial creation of DNS records for certificate generation should take some time. So,\nit is better to do this before anything else.\n\n\nOtherwise, you can use the DNS server implemented with Bind.\n\n\nCreate your hosts file\n\n\n  \ncd\n config\n  cp hosts-example.yml hosts.yml\n\n\n\n\n\nThe host file is in YAML format, and contains only one host, which is your homebox server.\n\n\nHere an example:\n\n\nall\n:\n\n  \nhosts\n:\n\n    \nhomebox\n:\n\n      \nansible_host\n:\n \n192.168.42.1\n\n      \nansible_user\n:\n \nroot\n\n      \nansible_port\n:\n \n22\n\n\n\n\n\n\nI have actually tested with the Ansible remote user as root. However, it should be\npossible to run as an admin user and use sudo with little modifications.\n\n\nSystem configuration\n\n\nFirst, as you would do for a live environment, copy the sample configuration to create\nyour own:\n\n\ncd\n config\ncp system-example.yml system.yml\n\n\n\n\n\nThe file is self explanatory, and inside, you will find the following block:\n\n\nsystem\n:\n\n  \nrelease\n:\n \nstretch\n\n  \nlogin\n:\n \ntrue\n\n  \ndevel\n:\n \ntrue\n\n  \ndebug\n:\n \ntrue\n\n\n\n\n\n\nThe \u201cdebug\u201d flag\n\n\nSetting the debug flag to true will activate a lot of debug options in Dovecot, OpenLDAP, Postfix, etc\u2026  You can then\nfilter in the console, using for instance \njournalctl -u postfix -u dovecot*\n to view postfix and dovecot logs\nrespectively.\n\n\nThe \u201cdevel\u201d flag\n\n\nWhen you set this flag to true, various settings are changed in the development.\n\n\n\n\nThe certificates deployed are staging certificates only, which allows you to request more to LetsEncrypt.\n\n\nThe certificates are backed up on your local machine, allowing you to redeploy without asking again the same\n  certificates, which is also faster.\n\n\n\n\nIf you set this flag to true, and you want to test your system from a local computer, you will need to add the staging\nversion of the root certificate authority. They cab be downloaded on the on the \nLetsEncrypt staging environment\npage\n.\n\n\nDevelopment playbook\n\n\nThe first playbook to run is probably \u201cdev-support.yml\u201d. It installs some diagnostic and convenience packages on the\nserver, to make your life easier during the development phase.\n\n\nFor instance, these packages are installed:\n\n\n\n\nmc\n\n\ntelnet\n\n\ndnsutils\n\n\nwhois\n\n\ntmux\n\n\npfqueue\n\n\naptitude\n\n\nman\n\n\nless\n\n\nvim\n\n\nnet-tools\n\n\nfile\n\n\nswaks\n\n\ncurl\n\n\nlocate\n\n\ncolorized-logs\n\n\n\n\nbash-completion\n\n\n\n\n\n\nThe script also configures a basic bashrc / zshrc.\n\n\n\n\nIt is also adding the LetsEncrypt staging root certificate authority to the system.\n\n\n\n\nInstallation playbooks\n\n\nThe main playbook \u2018main.yml\u2019 and includes all other playbooks, with some of them conditional, as some components are\noptional.\n\n\nAutomatic backup\n\n\nOnce the script has been run, the backup folder contains important files, like certificates, passwords, etc. See (see\nthe \ndeployment backup\n page for details).\n\n\nDevelopment cleanup\n\n\nThis playbook do the opposite of dev-support, by uninstalling the packages used for development, and restoring the\nbashrc to its default state. You probably want to run this script before putting your server in production.\n\n\nIt is also removing the LetsEncrypt staging root certificate authority from the system.\n\n\nTests / Diagnostic playbooks.\n\n\nThere is also a tests folder that contains test playbooks.  These playbooks are running a list of system and integration\ntests on your development server.  This is useful for diagnostic purposes and also during the development phase, to be\nsure nothing is broken before committing anything.\n\n\nIt does not replace a full test suite in a pre-production environment, but has been enough so far to catch common\nmistakes made in the scripts.\n\n\nThe following roles are run:\n\n\n\n\nInstall the development packages above,\n\n\nBasic system tests\n\n\nLDAP server: Binding, users list, SSL certificate, etc.\n\n\nHome folders: Presence and permissions\n\n\nAntivirus rspamd: Current state\n\n\nService opendmarc: Current state\n\n\nSMTP certificate: presence and validity\n\n\nService opendkim: Current state, key validdity\n\n\nService postfix: Current state, certificate, emails sending and receiving\n\n\nPOP3 certificate: presence and validity\n\n\nIMAP certificate: presence and validity\n\n\nService dovecot: current state, user authentication, email resolution\n\n\nWeb site for roundcube: basic access, SSL certificate test\n\n\nWeb site \u201cautoconfig\u201d for Thunderbird: Check the validity of the XML generated\n\n\nWeb Site \u201cautodiscover\u201d for Outlook: HTTPS certificate, check the validity of the XML\n  generated\n\n\nAntivirus tests, for instance check that an email with a virus is bounced.\n\n\nFull text search inside attachments\n\n\nDNS records when the DNS server is installed.\n\n\n\n\nProfiling the playbook\n\n\nYou can profile the time taken by the whole playbook, using the Ansible profile_roles plugin:\n\n\n[defaults]\n\n\nretry_files_enabled\n \n=\n \nFalse\n\n\ndisplay_skipped_hosts\n \n=\n \nFalse\n\n\nstdout_callback\n \n=\n \nyaml\n\n\ncallback_whitelist\n \n=\n \nprofile_roles\n\n\nroles_path\n \n=\n \n.:{{ playbook_dir }}/../../common/roles/\n\n\nconnection_plugins\n \n=\n \n{{ playbook_dir }}/../../common/connection-plugins/\n\n\nremote_tmp\n \n=\n \n/tmp/\n\n\n\n\n\n\nThen, once you have finished to run the playbook, you will see the total time. For instance:\n\n\nFor a full deployment:\n\n\nPLAY RECAP *********************************************************************\nhomebox                    : ok=644  changed=394  unreachable=0    failed=0\nlocalhost                  : ok=0    changed=0    unreachable=0    failed=0\n\nSaturday 22 June 2019  15:18:09 +0100 (0:00:00.424)       0:18:59.596 *********\n===============================================================================\ndovecot --------------------------------------------------------------- 176.27s\nsystem-prepare -------------------------------------------------------- 118.33s\npostfix --------------------------------------------------------------- 112.06s\ncertificates ---------------------------------------------------------- 100.98s\nload-defaults ---------------------------------------------------------- 81.55s\nroundcube -------------------------------------------------------------- 67.77s\nldap ------------------------------------------------------------------- 66.80s\nclamav ----------------------------------------------------------------- 59.39s\nexternal-ip ------------------------------------------------------------ 39.54s\nsogo ------------------------------------------------------------------- 38.57s\nopendkim --------------------------------------------------------------- 27.84s\ndns-server-bind -------------------------------------------------------- 27.40s\nsetup ------------------------------------------------------------------ 25.43s\nrspamd ----------------------------------------------------------------- 24.34s\nopendmarc -------------------------------------------------------------- 23.52s\npackages --------------------------------------------------------------- 21.38s\nwebsite-simple --------------------------------------------------------- 17.81s\nsystem-cleanup --------------------------------------------------------- 16.34s\nuser-setup ------------------------------------------------------------- 15.64s\nautoconfig ------------------------------------------------------------- 14.98s\nautodiscover ----------------------------------------------------------- 14.98s\nremote-access ---------------------------------------------------------- 14.89s\nnginx ------------------------------------------------------------------ 13.14s\nimapproxy --------------------------------------------------------------- 8.58s\ndns-server-bind-refresh ------------------------------------------------- 2.69s\nwell-known-services ----------------------------------------------------- 2.10s\ndns-server-check-propagation -------------------------------------------- 1.22s\nejabberd ---------------------------------------------------------------- 0.75s\ngogs -------------------------------------------------------------------- 0.66s\ntransmission ------------------------------------------------------------ 0.63s\nborg-backup ------------------------------------------------------------- 0.58s\nzabbix-server ----------------------------------------------------------- 0.54s\nluks-remote ------------------------------------------------------------- 0.50s\nfwknop-server ----------------------------------------------------------- 0.40s\nprivoxy ----------------------------------------------------------------- 0.31s\naccess-check ------------------------------------------------------------ 0.26s\nbackup-server ----------------------------------------------------------- 0.19s\ntor --------------------------------------------------------------------- 0.18s\nimport-accounts --------------------------------------------------------- 0.18s\nrspamd-web -------------------------------------------------------------- 0.18s\nfwknop-client ----------------------------------------------------------- 0.17s\nssh-keygen -------------------------------------------------------------- 0.13s\naccess-report ----------------------------------------------------------- 0.12s\nphp-fpm ----------------------------------------------------------------- 0.08s\nextra-certs ------------------------------------------------------------- 0.06s\nsendxmpp ---------------------------------------------------------------- 0.05s\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\ntotal ---------------------------------------------------------------- 1139.50s\n\n\n\n\n\nAnd for an update:\n\n\nPLAY RECAP *********************************************************************\nhomebox                    : ok=557  changed=66   unreachable=0    failed=0\nlocalhost                  : ok=0    changed=0    unreachable=0    failed=0\n\nSaturday 22 June 2019  14:50:39 +0100 (0:00:00.442)       0:09:57.571 *********\n===============================================================================\nload-defaults ---------------------------------------------------------- 85.87s\ncertificates ----------------------------------------------------------- 78.07s\ndovecot ---------------------------------------------------------------- 54.67s\npostfix ---------------------------------------------------------------- 42.22s\nexternal-ip ------------------------------------------------------------ 36.11s\nldap ------------------------------------------------------------------- 34.02s\nsystem-prepare --------------------------------------------------------- 27.48s\nsetup ------------------------------------------------------------------ 23.86s\ndns-server-bind -------------------------------------------------------- 22.62s\nopendkim --------------------------------------------------------------- 22.37s\nrspamd ----------------------------------------------------------------- 22.30s\nopendmarc -------------------------------------------------------------- 18.06s\nroundcube -------------------------------------------------------------- 17.91s\nuser-setup ------------------------------------------------------------- 15.80s\nnginx ------------------------------------------------------------------ 15.27s\nsogo ------------------------------------------------------------------- 14.75s\nremote-access ---------------------------------------------------------- 13.83s\nwebsite-simple ---------------------------------------------------------- 8.27s\nsystem-cleanup ---------------------------------------------------------- 7.65s\nclamav ------------------------------------------------------------------ 6.65s\nautoconfig -------------------------------------------------------------- 5.68s\nautodiscover ------------------------------------------------------------ 5.37s\nimapproxy --------------------------------------------------------------- 4.82s\npackages ---------------------------------------------------------------- 3.09s\ndns-server-bind-refresh ------------------------------------------------- 1.93s\nwell-known-services ----------------------------------------------------- 1.35s\ndns-server-check-propagation -------------------------------------------- 0.98s\nejabberd ---------------------------------------------------------------- 0.77s\ntransmission ------------------------------------------------------------ 0.75s\ngogs -------------------------------------------------------------------- 0.68s\nborg-backup ------------------------------------------------------------- 0.62s\nzabbix-server ----------------------------------------------------------- 0.58s\nluks-remote ------------------------------------------------------------- 0.53s\nfwknop-server ----------------------------------------------------------- 0.43s\nprivoxy ----------------------------------------------------------------- 0.32s\naccess-check ------------------------------------------------------------ 0.28s\nrspamd-web -------------------------------------------------------------- 0.24s\nbackup-server ----------------------------------------------------------- 0.21s\ntor --------------------------------------------------------------------- 0.20s\nfwknop-client ----------------------------------------------------------- 0.18s\nimport-accounts --------------------------------------------------------- 0.18s\naccess-report ----------------------------------------------------------- 0.16s\nssh-keygen -------------------------------------------------------------- 0.14s\nphp-fpm ----------------------------------------------------------------- 0.09s\nextra-certs ------------------------------------------------------------- 0.06s\nsendxmpp ---------------------------------------------------------------- 0.06s\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\ntotal ----------------------------------------------------------------- 597.48s\n\n\n\n\n\nSome development tools to consider\n\n\n\n\nThe fantastic tmux, mandatory IMHO: \ntmux github page\n.\n\n\nEmacs or vim, but if you are not ready, \nVisualStudio code\n is not too bad as well,\n  and is very well integrated in Debian / Ubuntu.\n\n\nTest your SMTP server compliance: \nmxtoolbox.com\n.\n\n\nDNSSEC records debugger : https://dnssec-analyzer.verisignlabs.com/\n\n\nDNS propagation checker: https://www.whatsmydns.net/",
            "title": "Testing and development"
        },
        {
            "location": "/development/#external-mailing-lists",
            "text": "If something goes wrong, here a few resources:   The  Postfix mailing lists .  The  Dovecot mailing lists .  The  Debian mailing lists .  Our  github page  Finally,  Duckduckgo  or  Google .",
            "title": "External mailing lists"
        },
        {
            "location": "/development/#folders-content",
            "text": "The repository contains a few folders you should be familiar with:   config: The main Yaml configuration files for your homebox device.  preseed: Docker environment to create an automatic ISO image installer for Debian.  install: Ansible scripts to install or test the whole server environment.  backup: A very useful folder that contains some important files like the passwords and certificates generated when\n  deploying the system. This allows you to \u201creplay\u201d the deployment on a new server after a disaster, without loosing any\n  information. This folder is generated automatically on the first deployment, and ignored by git  tests: Ansible playbooks to test the platform.  sandbox: Put anything you don\u2019t want to commit here.  docs: This project documentation.  uninstall: Ansible scripts to uninstall some of the components. This allows you to test them.",
            "title": "Folders content"
        },
        {
            "location": "/development/#branches",
            "text": "The current developments are done in the  dev  branch.  The master branch is kept for releases.   Starting in May 2019, the approach will be to use gitflow, from the dev branch.",
            "title": "Branches"
        },
        {
            "location": "/development/#test-machine",
            "text": "You can start to develop using a virtual machine on your workstation, for instance using\nKVM or VirtualBox. The environment runs on Debian Stable. You can install it using a\nminimalistic ISO image, called  netinst .  I suggest you to use a virtual machine to test, especially with snapshots capabilities.\nBy using snapshots, you can rollback to any stage and run the Ansible scripts again. On\nLinux, KVM/libvirt is the best choice, and VirtualBox might be acceptable.  For instance:  apt-get install libvirt virt-manager",
            "title": "Test machine"
        },
        {
            "location": "/development/#preseed",
            "text": "There is a preseed folder that creates an an ISO image for automatic installation.  It is\nusing Docker, and builds an automatic installer from a YAML configuration file.\nThe  preseed page  give more details about this feature.   Note  This installer installs Debian only, it does not deploy the platform.",
            "title": "Preseed"
        },
        {
            "location": "/development/#router-configuration",
            "text": "Unless your IP address changes too often or your port 25 is blocked, you do not need to\nhave a fixed IP address.  However, the more you want to test, the more your router need to be configured:   TCP/80 (HTTP): Used to query letsencrypt for the certificates. Open it at least to\n  obtain the SSL using LetsEncrypt. You can then close the port once you have the\n  certificates.  TCP/25: SMTP, to receive and transfer emails from and to other SMTP servers on\n  internet. You need this one only to test the reception and transmission of external\n  emails.   Now, all the rest can be done internally, without exposing your test machine. These ports\ndon\u2019t need to be forwarded by your router during the development time:   TCP/143 and TCP/993 : IMAP and IMAPS  TCP/110 and TCP/995 : POP3 and POP3S  TCP/587 :  Submission .  TCP/465 :  SMTPS  (this on is kept for\n  compatibility with some old devices, but perhaps will be removed soon)  TCP/4190 : ManageSieve. Used to remotely access your mail filters, for instance with\n   thunderbird sieve plugin .  TCP/443 : HTTPS access for the webmail and also Outlook autodiscover feature.  TCP/5222 and TCP/5269 : Jabber, clients to server and server to server implementation.  UDP/53 and TCP/53 : DNS Server.",
            "title": "Router configuration"
        },
        {
            "location": "/development/#bridging-your-workstation",
            "text": "If you are using a virtual machine, it is better to use a bridge on your workstation, to\ntransparently forward the traffic from internet.   On Debian: https://wiki.debian.org/BridgeNetworkConnections  On Linux arch:  Network bridge  A fancy guide on Ubuntu:\n   Linux bridge with Network Manager",
            "title": "Bridging your workstation"
        },
        {
            "location": "/development/#dns-setup",
            "text": "There is a script that actually updates automatically DNS entries, if you are using Gandi.\nFor development, the simplest is to add a wilcard entry in your DNS, that would point to\nyour virtual machine.  The initial creation of DNS records for certificate generation should take some time. So,\nit is better to do this before anything else.  Otherwise, you can use the DNS server implemented with Bind.",
            "title": "DNS Setup"
        },
        {
            "location": "/development/#create-your-hosts-file",
            "text": "cd  config\n  cp hosts-example.yml hosts.yml  The host file is in YAML format, and contains only one host, which is your homebox server.  Here an example:  all : \n   hosts : \n     homebox : \n       ansible_host :   192.168.42.1 \n       ansible_user :   root \n       ansible_port :   22   I have actually tested with the Ansible remote user as root. However, it should be\npossible to run as an admin user and use sudo with little modifications.",
            "title": "Create your hosts file"
        },
        {
            "location": "/development/#system-configuration",
            "text": "First, as you would do for a live environment, copy the sample configuration to create\nyour own:  cd  config\ncp system-example.yml system.yml  The file is self explanatory, and inside, you will find the following block:  system : \n   release :   stretch \n   login :   true \n   devel :   true \n   debug :   true",
            "title": "System configuration"
        },
        {
            "location": "/development/#the-debug-flag",
            "text": "Setting the debug flag to true will activate a lot of debug options in Dovecot, OpenLDAP, Postfix, etc\u2026  You can then\nfilter in the console, using for instance  journalctl -u postfix -u dovecot*  to view postfix and dovecot logs\nrespectively.",
            "title": "The \"debug\" flag"
        },
        {
            "location": "/development/#the-devel-flag",
            "text": "When you set this flag to true, various settings are changed in the development.   The certificates deployed are staging certificates only, which allows you to request more to LetsEncrypt.  The certificates are backed up on your local machine, allowing you to redeploy without asking again the same\n  certificates, which is also faster.   If you set this flag to true, and you want to test your system from a local computer, you will need to add the staging\nversion of the root certificate authority. They cab be downloaded on the on the  LetsEncrypt staging environment\npage .",
            "title": "The \"devel\" flag"
        },
        {
            "location": "/development/#development-playbook",
            "text": "The first playbook to run is probably \u201cdev-support.yml\u201d. It installs some diagnostic and convenience packages on the\nserver, to make your life easier during the development phase.  For instance, these packages are installed:   mc  telnet  dnsutils  whois  tmux  pfqueue  aptitude  man  less  vim  net-tools  file  swaks  curl  locate  colorized-logs   bash-completion    The script also configures a basic bashrc / zshrc.   It is also adding the LetsEncrypt staging root certificate authority to the system.",
            "title": "Development playbook"
        },
        {
            "location": "/development/#installation-playbooks",
            "text": "The main playbook \u2018main.yml\u2019 and includes all other playbooks, with some of them conditional, as some components are\noptional.",
            "title": "Installation playbooks"
        },
        {
            "location": "/development/#automatic-backup",
            "text": "Once the script has been run, the backup folder contains important files, like certificates, passwords, etc. See (see\nthe  deployment backup  page for details).",
            "title": "Automatic backup"
        },
        {
            "location": "/development/#development-cleanup",
            "text": "This playbook do the opposite of dev-support, by uninstalling the packages used for development, and restoring the\nbashrc to its default state. You probably want to run this script before putting your server in production.  It is also removing the LetsEncrypt staging root certificate authority from the system.",
            "title": "Development cleanup"
        },
        {
            "location": "/development/#tests-diagnostic-playbooks",
            "text": "There is also a tests folder that contains test playbooks.  These playbooks are running a list of system and integration\ntests on your development server.  This is useful for diagnostic purposes and also during the development phase, to be\nsure nothing is broken before committing anything.  It does not replace a full test suite in a pre-production environment, but has been enough so far to catch common\nmistakes made in the scripts.  The following roles are run:   Install the development packages above,  Basic system tests  LDAP server: Binding, users list, SSL certificate, etc.  Home folders: Presence and permissions  Antivirus rspamd: Current state  Service opendmarc: Current state  SMTP certificate: presence and validity  Service opendkim: Current state, key validdity  Service postfix: Current state, certificate, emails sending and receiving  POP3 certificate: presence and validity  IMAP certificate: presence and validity  Service dovecot: current state, user authentication, email resolution  Web site for roundcube: basic access, SSL certificate test  Web site \u201cautoconfig\u201d for Thunderbird: Check the validity of the XML generated  Web Site \u201cautodiscover\u201d for Outlook: HTTPS certificate, check the validity of the XML\n  generated  Antivirus tests, for instance check that an email with a virus is bounced.  Full text search inside attachments  DNS records when the DNS server is installed.",
            "title": "Tests / Diagnostic playbooks."
        },
        {
            "location": "/development/#profiling-the-playbook",
            "text": "You can profile the time taken by the whole playbook, using the Ansible profile_roles plugin:  [defaults]  retry_files_enabled   =   False  display_skipped_hosts   =   False  stdout_callback   =   yaml  callback_whitelist   =   profile_roles  roles_path   =   .:{{ playbook_dir }}/../../common/roles/  connection_plugins   =   {{ playbook_dir }}/../../common/connection-plugins/  remote_tmp   =   /tmp/   Then, once you have finished to run the playbook, you will see the total time. For instance:  For a full deployment:  PLAY RECAP *********************************************************************\nhomebox                    : ok=644  changed=394  unreachable=0    failed=0\nlocalhost                  : ok=0    changed=0    unreachable=0    failed=0\n\nSaturday 22 June 2019  15:18:09 +0100 (0:00:00.424)       0:18:59.596 *********\n===============================================================================\ndovecot --------------------------------------------------------------- 176.27s\nsystem-prepare -------------------------------------------------------- 118.33s\npostfix --------------------------------------------------------------- 112.06s\ncertificates ---------------------------------------------------------- 100.98s\nload-defaults ---------------------------------------------------------- 81.55s\nroundcube -------------------------------------------------------------- 67.77s\nldap ------------------------------------------------------------------- 66.80s\nclamav ----------------------------------------------------------------- 59.39s\nexternal-ip ------------------------------------------------------------ 39.54s\nsogo ------------------------------------------------------------------- 38.57s\nopendkim --------------------------------------------------------------- 27.84s\ndns-server-bind -------------------------------------------------------- 27.40s\nsetup ------------------------------------------------------------------ 25.43s\nrspamd ----------------------------------------------------------------- 24.34s\nopendmarc -------------------------------------------------------------- 23.52s\npackages --------------------------------------------------------------- 21.38s\nwebsite-simple --------------------------------------------------------- 17.81s\nsystem-cleanup --------------------------------------------------------- 16.34s\nuser-setup ------------------------------------------------------------- 15.64s\nautoconfig ------------------------------------------------------------- 14.98s\nautodiscover ----------------------------------------------------------- 14.98s\nremote-access ---------------------------------------------------------- 14.89s\nnginx ------------------------------------------------------------------ 13.14s\nimapproxy --------------------------------------------------------------- 8.58s\ndns-server-bind-refresh ------------------------------------------------- 2.69s\nwell-known-services ----------------------------------------------------- 2.10s\ndns-server-check-propagation -------------------------------------------- 1.22s\nejabberd ---------------------------------------------------------------- 0.75s\ngogs -------------------------------------------------------------------- 0.66s\ntransmission ------------------------------------------------------------ 0.63s\nborg-backup ------------------------------------------------------------- 0.58s\nzabbix-server ----------------------------------------------------------- 0.54s\nluks-remote ------------------------------------------------------------- 0.50s\nfwknop-server ----------------------------------------------------------- 0.40s\nprivoxy ----------------------------------------------------------------- 0.31s\naccess-check ------------------------------------------------------------ 0.26s\nbackup-server ----------------------------------------------------------- 0.19s\ntor --------------------------------------------------------------------- 0.18s\nimport-accounts --------------------------------------------------------- 0.18s\nrspamd-web -------------------------------------------------------------- 0.18s\nfwknop-client ----------------------------------------------------------- 0.17s\nssh-keygen -------------------------------------------------------------- 0.13s\naccess-report ----------------------------------------------------------- 0.12s\nphp-fpm ----------------------------------------------------------------- 0.08s\nextra-certs ------------------------------------------------------------- 0.06s\nsendxmpp ---------------------------------------------------------------- 0.05s\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\ntotal ---------------------------------------------------------------- 1139.50s  And for an update:  PLAY RECAP *********************************************************************\nhomebox                    : ok=557  changed=66   unreachable=0    failed=0\nlocalhost                  : ok=0    changed=0    unreachable=0    failed=0\n\nSaturday 22 June 2019  14:50:39 +0100 (0:00:00.442)       0:09:57.571 *********\n===============================================================================\nload-defaults ---------------------------------------------------------- 85.87s\ncertificates ----------------------------------------------------------- 78.07s\ndovecot ---------------------------------------------------------------- 54.67s\npostfix ---------------------------------------------------------------- 42.22s\nexternal-ip ------------------------------------------------------------ 36.11s\nldap ------------------------------------------------------------------- 34.02s\nsystem-prepare --------------------------------------------------------- 27.48s\nsetup ------------------------------------------------------------------ 23.86s\ndns-server-bind -------------------------------------------------------- 22.62s\nopendkim --------------------------------------------------------------- 22.37s\nrspamd ----------------------------------------------------------------- 22.30s\nopendmarc -------------------------------------------------------------- 18.06s\nroundcube -------------------------------------------------------------- 17.91s\nuser-setup ------------------------------------------------------------- 15.80s\nnginx ------------------------------------------------------------------ 15.27s\nsogo ------------------------------------------------------------------- 14.75s\nremote-access ---------------------------------------------------------- 13.83s\nwebsite-simple ---------------------------------------------------------- 8.27s\nsystem-cleanup ---------------------------------------------------------- 7.65s\nclamav ------------------------------------------------------------------ 6.65s\nautoconfig -------------------------------------------------------------- 5.68s\nautodiscover ------------------------------------------------------------ 5.37s\nimapproxy --------------------------------------------------------------- 4.82s\npackages ---------------------------------------------------------------- 3.09s\ndns-server-bind-refresh ------------------------------------------------- 1.93s\nwell-known-services ----------------------------------------------------- 1.35s\ndns-server-check-propagation -------------------------------------------- 0.98s\nejabberd ---------------------------------------------------------------- 0.77s\ntransmission ------------------------------------------------------------ 0.75s\ngogs -------------------------------------------------------------------- 0.68s\nborg-backup ------------------------------------------------------------- 0.62s\nzabbix-server ----------------------------------------------------------- 0.58s\nluks-remote ------------------------------------------------------------- 0.53s\nfwknop-server ----------------------------------------------------------- 0.43s\nprivoxy ----------------------------------------------------------------- 0.32s\naccess-check ------------------------------------------------------------ 0.28s\nrspamd-web -------------------------------------------------------------- 0.24s\nbackup-server ----------------------------------------------------------- 0.21s\ntor --------------------------------------------------------------------- 0.20s\nfwknop-client ----------------------------------------------------------- 0.18s\nimport-accounts --------------------------------------------------------- 0.18s\naccess-report ----------------------------------------------------------- 0.16s\nssh-keygen -------------------------------------------------------------- 0.14s\nphp-fpm ----------------------------------------------------------------- 0.09s\nextra-certs ------------------------------------------------------------- 0.06s\nsendxmpp ---------------------------------------------------------------- 0.06s\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\ntotal ----------------------------------------------------------------- 597.48s",
            "title": "Profiling the playbook"
        },
        {
            "location": "/development/#some-development-tools-to-consider",
            "text": "The fantastic tmux, mandatory IMHO:  tmux github page .  Emacs or vim, but if you are not ready,  VisualStudio code  is not too bad as well,\n  and is very well integrated in Debian / Ubuntu.  Test your SMTP server compliance:  mxtoolbox.com .  DNSSEC records debugger : https://dnssec-analyzer.verisignlabs.com/  DNS propagation checker: https://www.whatsmydns.net/",
            "title": "Some development tools to consider"
        },
        {
            "location": "/codeofconduct/",
            "text": "Alternatives\n\n\nThere is already a lot of excellent projects on internet to help emails self-hosting, and I am providing links in the\n\nindex page\n.\n\n\nThis one is different in the approach used, and I do not want to deviate.\n\n\nIt is made to be unobtrusive with a standard Debian distribution, stable and highly secure.\n\n\nSecurity\n\n\nSecurity is the main concern of this solution. All the packages are coming from the \nofficial Debian repository\n or\nfrom a \nwell maintained repository\n.  There is no \ngit clone\n or manual download here, ever.  Once installed, you\nshould be able to manage it like any Debian server.\n\n\nAny new service should be compatible with \nAppArmor\n, to secure the system and\nto protect from any zero-day vulnerability.\n\n\nI am privileging stability and security over features, this is why you will not have the latest version of RoundCube and\nother components.\n\n\nStandard compliance\n\n\nIt is also standard compliant. For instance, the system generates and \npublish\n automatically your DKIM, SPF and DMARC\nrecords.\n\n\nAny service that requires authentication should use LDAP. so the user don\u2019t have to remember another password.\n\n\nShell scripts\n\n\n\n\nWhen shell scripts are needed, \ndash\n should be preferred over bash.\n\n\nEach shell should be checked with shellcheck binary.\n\n\n\n\nCurrent status\n\n\n\n\nAlthough the platform is actually stable enough to be used in production, it is not yet a turn-key solution for lambda\n  users.\n\n\nSome functionalities - not activated by default - have not been tested in a live environment for long enough.\n\n\n\n\nSome components are missing, and will be added when appropriate:\n\n\n\n\nA proper Debian repository for the security updates of the scripts, if this is needed.\n\n\nA proper roadmap, with major and minor version numbers.\n\n\nA mailing list, mostly for announces.\n\n\nAn official web site\n\n\n\n\nI have more long term ideas in mind, I will document them more in details later.",
            "title": "Code of conduct"
        },
        {
            "location": "/codeofconduct/#alternatives",
            "text": "There is already a lot of excellent projects on internet to help emails self-hosting, and I am providing links in the index page .  This one is different in the approach used, and I do not want to deviate.  It is made to be unobtrusive with a standard Debian distribution, stable and highly secure.",
            "title": "Alternatives"
        },
        {
            "location": "/codeofconduct/#security",
            "text": "Security is the main concern of this solution. All the packages are coming from the  official Debian repository  or\nfrom a  well maintained repository .  There is no  git clone  or manual download here, ever.  Once installed, you\nshould be able to manage it like any Debian server.  Any new service should be compatible with  AppArmor , to secure the system and\nto protect from any zero-day vulnerability.  I am privileging stability and security over features, this is why you will not have the latest version of RoundCube and\nother components.",
            "title": "Security"
        },
        {
            "location": "/codeofconduct/#standard-compliance",
            "text": "It is also standard compliant. For instance, the system generates and  publish  automatically your DKIM, SPF and DMARC\nrecords.  Any service that requires authentication should use LDAP. so the user don\u2019t have to remember another password.",
            "title": "Standard compliance"
        },
        {
            "location": "/codeofconduct/#shell-scripts",
            "text": "When shell scripts are needed,  dash  should be preferred over bash.  Each shell should be checked with shellcheck binary.",
            "title": "Shell scripts"
        },
        {
            "location": "/codeofconduct/#current-status",
            "text": "Although the platform is actually stable enough to be used in production, it is not yet a turn-key solution for lambda\n  users.  Some functionalities - not activated by default - have not been tested in a live environment for long enough.   Some components are missing, and will be added when appropriate:   A proper Debian repository for the security updates of the scripts, if this is needed.  A proper roadmap, with major and minor version numbers.  A mailing list, mostly for announces.  An official web site   I have more long term ideas in mind, I will document them more in details later.",
            "title": "Current status"
        }
    ]
}