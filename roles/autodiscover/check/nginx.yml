---

- name: Download the XML autodiscover file
  tags: systemctl, autodiscover
  vars:
    email: 'postmaster@{{ network.domain }}'
  ansible.builtin.uri:
    url: 'https://autodiscover.{{ network.domain }}/autodiscover/autodiscover.xml'
    method: POST
    body: ''
    status_code: 200
    dest: /tmp/autodiscover.xml

- name: Check the autodiscover answer is valid
  tags: systemctl, autodiscover
  ansible.builtin.shell: xmllint /tmp/autodiscover.xml
  changed_when: false

- name: Remove the downloaded file
  tags: systemctl, autodiscover
  ansible.builtin.file:
    path: /tmp/autodiscover.xml
    state: absent
