---

# This seems to be required on first boot on cloud servers
- name: Remove packages not required
  ansible.builtin.include_tasks: pre-clean.yml

- name: Move ansible logs to a separate file
  ansible.builtin.include_tasks: ansible-logs.yml

- name: Network related tasks
  ansible.builtin.include_tasks: network.yml
  tags: network

- name: Track changes in the system
  when: system.track_changes
  ansible.builtin.include_tasks: track-changes.yml

- name: Initialise and update the packages repository
  ansible.builtin.include_tasks: apt.yml

- name: Install the base required packages
  ansible.builtin.include_tasks: packages.yml

- name: Remove exim and install postfix
  ansible.builtin.include_tasks: postfix.yml

- name: Configure the locales
  ansible.builtin.include_tasks: locales.yml

- name: Configure the basic SSL settings
  ansible.builtin.include_tasks: ssl.yml

- name: Configure the packages repository
  ansible.builtin.include_tasks: apticron.yml

- name: Configure the proxy
  ansible.builtin.include_tasks: proxy.yml
  tags: proxy

- name: Create prometheus directory structure
  when: prometheus.install
  ansible.builtin.include_tasks: prometheus.yml

- name: Configure automatic upgrades
  ansible.builtin.include_tasks: unattended-upgrades.yml
  tags: autoupdate

# Ensure the environment variables are cleared
- name: Reset the SSH connection
  ansible.builtin.meta: reset_connection
