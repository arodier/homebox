---

- name: Load or create the password for the admin user
  no_log: '{{ not system.devel }}'
  set_fact:
    admin_password: >-
      {{ lookup(creds.store, network.domain + "/user/admin"
      + creds.opts.create) }}

- name: Set uid and gid numbers
  set_fact:
    uid_number: '{{ system.admin.uid_number | default(2000+999 | random) }}'
    gid_number: '{{ system.admin.gid_number | default(2000+999 | random) }}'

- name: Create Administrators group
  group:
    name: '{{ system.admin.group_name }}'
    gid: '{{ gid_number | int }}'

- name: Create the Administration user
  user:
    name: '{{ system.admin.name }}'
    group: '{{ system.admin.group_name }}'
    groups: sudo
    password: '{{ admin_password | password_hash("sha512") }}'
    uid: '{{ uid_number | int }}'
