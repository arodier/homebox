---

- name: Check if PowerDNS is running
  shell:
    systemctl is-active pdns

- name: Check DNS propagation
  register: external_ip_check
  shell: >-
    host -t {{ external_ip_type }} main.{{ network.domain }}
    1.1.1.1
  retries: '{{ dns.propagation.retries | default(10) }}'
  delay: '{{ dns.propagation.delay | default(60) }}'
  until: external_ip_check.rc == 0

- name: Check DNS propagation for backup IP address
  register: backup_ip_check
  when: backup_ip is defined
  shell: >-
    host -t {{ backup_ip_type }} main.{{ network.domain }}
    1.1.1.1
  retries: '{{ dns.propagation.retries | default(10) }}'
  delay: '{{ dns.propagation.delay | default(60) }}'
  until: backup_ip_check.rc == 0
