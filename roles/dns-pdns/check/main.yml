---

- name: Check if PowerDNS is running
  shell:
    systemctl is-active pdns

# This is checking that the DNS server has been fully propagated
- name: Check DNS propagation
  register: external_ip_check
  shell: >-
    host main.{{ network.domain }}
  retries: '{{ dns.propagation.retries | default(10) }}'
  delay: '{{ dns.propagation.delay | default(60) }}'
  until: external_ip_check.rc == 0

# This is checking that the DNS server has been fully propagated
- name: Check DNS propagation for backup IP address
  register: backup_ip_check
  when: backup_ip is defined
  shell: >-
    host backup.{{ network.domain }}
  retries: '{{ dns.propagation.retries | default(10) }}'
  delay: '{{ dns.propagation.delay | default(60) }}'
  until: backup_ip_check.rc == 0
