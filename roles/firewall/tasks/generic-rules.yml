---

# the value firewall.ssh is here for compatibility with the stretch version

- name: Create the nftables directory
  file:
    path: /etc/nftables
    state: directory

- name: Install the nftable package
  register: nft_pkg
  apt:
    name: nftables
    state: present

- name: Restart nftables now
  when: nft_pkg.changed
  systemd:
    name: nftables
    state: restarted

- name: Copy the main rules files
  notify: Restart nftables
  template:
    src: '{{ name }}.nft'
    dest: /etc/nftables/{{ name }}.nft
    mode: 0600
  loop: '{{ rule_files }}'
  loop_control:
    loop_var: name

- name: Copy the nftables parent configuration file
  notify: Restart nftables
  template:
    src: main.nft
    dest: /etc/nftables.conf
    mode: '0600'
