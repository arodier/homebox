---

- name: Load network information
  ansible.builtin.include_tasks: install/facts.yml
  tags: facts

- name: Install the required packages
  ansible.builtin.include_tasks: install/packages.yml

- name: Prepare logging settings
  ansible.builtin.include_tasks: install/logging.yml
  tags: logging

- name: Set the generic firewall rules
  ansible.builtin.include_tasks: install/generic-rules.yml
  tags: rules

- name: Create sets to store trusted and banned networks
  when: security.fail2ban
  ansible.builtin.include_tasks: install/autoban.yml
  tags: rules, autoban

- name: Set the remote access firewall rules for private networks
  ansible.builtin.include_tasks: install/private-access.yml
  tags: rules

- name: Install and configure fail2ban
  when: security.fail2ban
  ansible.builtin.include_tasks: install/fail2ban.yml
  tags: f2b, scripts

- name: Configure SSH
  ansible.builtin.include_tasks: install/ssh-config.yml
  tags: ssh

- name: Start the firewall
  ansible.builtin.include_tasks: install/start.yml
  tags: systemd
