---

# These tasks are deployinga specific list of “trusted” abd “banned” IP addresses,
# dynamically updated by services like dovecot, postfix, suricata, etc.

- name: Truted IP addresses rules
  notify: Restart nftables
  ansible.builtin.template:
    src: rules/20-trusted-ips.nft
    dest: /etc/nftables/20-trusted-ips.nft
  tags: rules, autoban

- name: Banned IP addresses rules
  notify: Restart nftables
  ansible.builtin.template:
    src: rules/25-banned-ips.nft
    dest: /etc/nftables/25-banned-ips.nft
  tags: rules, autoban

- name: deploy the save/load script
  ansible.builtin.copy:
    src: nftables-lists.sh
    dest: /usr/local/sbin/nftables-lists
    mode: '0700'
  tags: rules, autoban

- name: deploy the systemd service
  notify:
    - Reload systemd
    - Enable nftables list service
  ansible.builtin.copy:
    src: nftables-lists.service
    dest: /etc/systemd/system/nftables-lists.service
  tags: rules, autoban
