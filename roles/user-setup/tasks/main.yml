---

- name: Initialise or load the passwords
  include_tasks: load-passwords.yml

- name: Activate system authentication
  include_tasks: system-auth.yml

- name: Ensure the users are now available
  meta: flush_handlers

- name: Configure pam modules
  include_tasks: pam-modules.yml

- name: Create user directories
  include_tasks: create-dirs.yml

- name: Initialise each user
  include_tasks: init-user.yml
  loop: '{{ users }}'
  loop_control:
    loop_var: user

- name: Initialise postmaster account
  include_tasks: init-postmaster.yml
