---

- name: Install some clamav AppArmor profiles
  notify: Restart clamav services
  register: aa_templates
  ansible.builtin.template:
    src: apparmor.conf
    dest: /etc/apparmor.d/usr.sbin.clamsmtpd
  tags: apparmor

- name: Activate AppArmor profiles
  when: aa_templates.changed
  notify: Restart AppArmor service
  # possible ambiguous replacement: command : ansible.builtin.command | community.ciscosmb.command | community.routeros.command
  ansible.builtin.command: 'aa-enforce {{ aa_config }}'
  loop:
    - usr.bin.freshclam
    - usr.sbin.clamd
  loop_control:
    loop_var: aa_config
  tags: apparmor
