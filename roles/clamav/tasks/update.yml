---

- name: Start clamav freshclam service
  register: clamav_freshclam
  service:
    name: clamav-freshclam
    state: started
    enabled: yes

- name: Wait for the freshclam service
  when: clamav_packages.changed
  wait_for:
    path: /var/lib/clamav/daily.cvd
    sleep: 1
    timeout: 300

- name: Start clamav service
  register: clamav_daemon
  service:
    name: clamav-daemon
    state: started
    enabled: yes
  retries: 12
  until: clamav_daemon is not failed
  delay: 10
