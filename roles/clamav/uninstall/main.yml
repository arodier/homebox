---

- name: Uninstall clamav antivirus suite
  apt:
    name: '{{ packages }}'
    state: absent
    purge: true
    autoremove: true

- name: Remove AppArmor profiles
  notify: Restart AppArmor service
  file:
    path: /etc/apparmor.d/usr.sbin.clamsmtpd
    state: absent

- name: Remove config folders
  file:
    path: '{{ path }}'
    state: absent
  loop:
    - /etc/clamsmtp
    - /etc/clamav
  loop_control:
    loop_var: path

- name: Remove logs folder
  file:
    path: '{{ path }}'
    state: absent
  loop:
    - /var/log/clamsmtp
    - /var/log/clamav
  loop_control:
    loop_var: path

- name: Remove lib store folder
  file:
    path: /var/lib/clamav
    state: absent

- name: Remove whitelisted domain
  notify: Restart tinyproxy
  lineinfile:
    path: /etc/tinyproxy/filter
    line: database.clamav.net
    state: absent
