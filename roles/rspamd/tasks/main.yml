---

- name: Install the packages
  include_tasks: packages.yml

- name: Load the passwords
  include_tasks: passwords.yml

- name: Configure the packages
  include_tasks: config.yml

- name: Install the firewall rules
  include_tasks: firewall.yml
  tags: nft

- name: Configure AppArmor
  include_tasks: apparmor.yml

- name: Add the filter to postfix
  include_tasks: postfix.yml

- name: Configure rspamd to use the proxy
  include_tasks: proxy.yml

- name: Add Prometheus alerts
  when: prometheus.install
  include_tasks: prometheus.yml
  tags: prometheus

- name: Include DMARC reporting if activated
  when: dmarc.send_reports.active
  include_tasks: dmarc-reporting.yml
