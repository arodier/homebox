---

- name: Check if the DNS record already exist
  register: dns_entry
  getent:
    database: hosts
    key: cockpit.{{ network.domain }}
  ignore_errors: true

- name: Create the DNS record if not existing
  when: dns_entry.failed
  shell: >-
    pdnsutil add-record {{ network.domain }}
    cockpit CNAME main.{{ network.domain }}
  changed_when: true
