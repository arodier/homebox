---

- name: Load or create the password for the read-only account
  no_log: '{{ not system.devel }}'
  ansible.builtin.set_fact:
    ldap_ro_password: '{{ lookup(creds.store, creds.prefix + "/ldap/readonly") }}'
  tags: facts

- name: Compute the users DN
  ansible.builtin.set_fact:
    ldap_users_dn: 'ou=users,dc={{ network.domain.split(".") | join(",dc=") }}'
  tags: facts

- name: Set the readonly userâ€™ DN
  ansible.builtin.set_fact:
    ldap_readonly_dn: 'cn=readonly account,{{ ldap_users_dn }}'
  tags: facts

- name: Create or get the database account password
  no_log: '{{ not system.devel }}'
  ansible.builtin.set_fact:
    ejabberd_db_password: >-
      {{ lookup(creds.store, creds.prefix + "/postgresql/ejabberd"
      + creds.opts.create + creds.opts.system) }}
  tags: facts
