---

- name: Install packages needed for dovecot fts
  apt:
    update_cache: yes
    cache_valid_time: 86400
    name: '{{ dovecot.fts_packages }}'
    state: present

- name: Copy decode2text script
  copy:
    src: fts/decode2text
    dest: /usr/local/bin/decode2text
    mode: 0755

- name: Make sure the log file exist
  file:
    path: /var/log/decode2text.log
    mode: 0644
    owner: dovecot
    group: dovecot
    state: touch

- name: Copy fts mime configuration files
  template:
    src: '{{ file.src }}'
    dest: '{{ file.dest }}'
  loop:
    - src: fts/mime-supported.conf
      dest: /etc/dovecot/fts-mime-types.conf
  loop_control:
    loop_var: file
