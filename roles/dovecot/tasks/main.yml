---

- name: Set facts
  include_tasks: facts.yml

- name: Install the required packages
  include_tasks: packages.yml

- name: Configure firewall
  include_tasks: firewall.yml

- name: Configure IMAP DNS records
  include_tasks: dns-imap.yml

- name: Configure POP3 DNS records
  when: mail.pop3
  include_tasks: dns-pop3.yml

- name: Configure certificates
  include_tasks: certificates.yml

- name: Set some configuration files
  include_tasks: config.yml

- name: Configure sieve scripts
  include_tasks: sieve.yml

- name: Configure antispam
  include_tasks: antispam.yml

- name: Import imersonate tasks
  when: mail.impersonate.active
  include_tasks: impersonate.yml

- name: Run import tasks
  when: mail.import.active
  include_tasks: import.yml

- name: AppArmor tasks
  include_tasks: apparmor.yml

- name: Backup configuration tasks
  include_tasks: backup.yml

- name: Include full text search tasks
  when: mail.fts.active
  include_tasks: fts.yml

- name: Include virtual mailboxes tasks
  when: mail.virtual_folders.active
  include_tasks: virtual.yml

- name: Set-up user encryption
  include_tasks: encryption.yml
  loop: '{{ users }}'
  loop_control:
    loop_var: user
