---

- name: Create dkim folder
  ansible.builtin.file:
    path: /var/spool/postfix/opendkim
    state: directory
    owner: opendkim
    group: opendkim
    mode: 0750

- name: Create the configuration file
  notify: Restart opendkim
  ansible.builtin.template:
    src: opendkim.conf
    dest: /etc/opendkim.conf

- name: Create the keys and signing table
  notify: Restart opendkim
  ansible.builtin.template:
    src: '{{ file }}'
    dest: '/etc/opendkim/{{ file }}'
  loop:
    - keytable
    - signingtable
    - trusted-hosts
  loop_control:
    loop_var: file
