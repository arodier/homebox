---

- name: Set the facts
  ansible.builtin.include_tasks: install/facts.yml

- name: Install the packages
  ansible.builtin.include_tasks: install/packages.yml

- name: Configure the certificates
  ansible.builtin.include_tasks: install/certificates.yml
  tags: certs

- name: Configure nginx
  ansible.builtin.include_tasks: install/nginx.yml
  tags: nginx

- name: Configure the database
  ansible.builtin.include_tasks: install/database.yml

- name: Configure the sieve filters
  ansible.builtin.include_tasks: install/sieve.yml

- name: Configure AppArmor
  ansible.builtin.include_tasks: install/apparmor.yml

- name: Create DNS records
  ansible.builtin.include_tasks: install/dns.yml

- name: Add Prometheus alerts
  when: prometheus.install
  ansible.builtin.include_tasks: install/prometheus.yml
  tags: prometheus

- name: Configure
  ansible.builtin.include_tasks: install/config.yml

- name: Cleanup after the installation
  ansible.builtin.include_tasks: install/cleanup.yml
