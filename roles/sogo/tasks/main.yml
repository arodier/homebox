---

- name: Set the facts
  include_tasks: facts.yml

- name: Install the packages
  include_tasks: packages.yml

- name: Configure the certificates
  include_tasks: certificates.yml
  tags: certs

- name: Configure nginx
  include_tasks: nginx.yml
  tags: nginx

- name: Configure the database
  include_tasks: database.yml

- name: Configure the sieve filters
  include_tasks: sieve.yml

- name: Configure AppArmor
  include_tasks: apparmor.yml

- name: Create DNS records
  include_tasks: dns.yml

- name: Add Prometheus alerts
  when: prometheus.install
  tags: prometheus
  include_tasks: prometheus.yml

- name: Configure
  include_tasks: config.yml

- name: Cleanup after the installation
  include_tasks: cleanup.yml
