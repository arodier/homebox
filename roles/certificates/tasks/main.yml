---

- name: Common facts
  ansible.builtin.include_tasks: facts.yml
  tags: facts

- name: Install the packages needed
  ansible.builtin.include_tasks: packages.yml
  tags: apt

- name: Run the common pre installation tasks
  ansible.builtin.include_tasks: pre-install-common.yml
  tags: preinstall, proxy

- name: Verify and create each certificate if needed
  ansible.builtin.include_tasks: check-and-create.yml
  loop: '{{ certificates }}'
  loop_control:
    loop_var: certificate
  tags: certs

- name: Run the common post installation tasks
  ansible.builtin.include_tasks: post-install-common.yml
  tags: postinstall

- name: Deploy the custom scripts
  ansible.builtin.include_tasks: scripts.yml
  tags: scripts

- name: Deploy the systemd service and timer
  ansible.builtin.include_tasks: service.yml
  tags: service

- name: Update proxy settings
  ansible.builtin.include_tasks: proxy.yml
  tags: proxy
