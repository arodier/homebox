---

- name: Ensure the required packages are installed
  apt:
    name: [ rsync, ssl-cert ]
    state: present

- name: Create the lego configuration directory
  file:
    path: /var/lib/lego
    state: directory
    mode: 0750
    group: ssl-cert

- name: Create the directory to store certificates files
  file:
    path: /var/lib/lego/certificates
    state: directory
    mode: 0750
    group: ssl-cert

- name: Push the certificate on the server
  synchronize:
    mode: push
    src: '{{ backup_dir }}/certificates'
    dest: /var/lib/lego/
    archive: true
    owner: true
    rsync_opts:
      - '--chown=root:ssl-cert'
