---

- name: Ensure the required packages are installed
  apt:
    name: [ rsync ]
    state: present

- name: Create the certificates cache directory
  file:
    path: /var/lib/lego/certificates
    state: directory

- name: Push the certificate on the server
  synchronize:
    mode: push
    src: '{{ backup_dir }}/certificates'
    dest: /var/lib/lego/
    archive: true
    owner: true
    rsync_opts:
      - '--chown=root:root'
