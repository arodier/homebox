---

- name: Remove nginx
  apt:
    name: '{{ packages }}'
    state: absent
    purge: true
    autoremove: true

- name: Remove nginx secure configuration
  file:
    path: /etc/nginx
    state: absent

- name: Remove nginx logs
  file:
    path: /var/log/nginx
    state: absent

- name: Remove the nftables rules files
  notify: Restart nftables
  file:
    path: /etc/nftables/50-in-http.nft
    state: absent

- name: Remove nginx default site
  file:
    path: /var/www/html
    state: absent

- name: Remove nginx AppArmor profile
  notify: Restart AppArmor service
  file:
    path: /etc/apparmor.d/usr.sbin.nginx
    state: absent

- name: Remove DNS entry for www
  vars:
    dns_records:
      - name: www
        value: main.{{ network.domain }}
        type: cname
  include_role:
    name: dns-record
    tasks_from: uninstall/main.yml
