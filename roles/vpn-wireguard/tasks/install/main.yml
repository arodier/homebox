---

- name: Set the facts
  ansible.builtin.include_tasks: install/facts.yml

- name: Install the packages
  ansible.builtin.include_tasks: install/packages.yml

- name: Create the server keys
  ansible.builtin.include_tasks: install/server-keys.yml

- name: Configure user keys
  ansible.builtin.include_tasks: install/client-keys.yml
  loop: '{{ users }}'
  loop_control:
    loop_var: user

- name: Configure the server
  ansible.builtin.include_tasks: install/server-config.yml
  tags: config

- name: Configure the firewall
  ansible.builtin.include_tasks: install/firewall.yml
  tags: nftables
