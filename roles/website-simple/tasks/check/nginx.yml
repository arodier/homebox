---

- name: Set URLs to test
  ansible.builtin.set_fact:
    test_urls:
      - www.{{ network.domain }}/
      - www.{{ network.domain }}//test/this?sub#url

- name: Check the that the root site returns 302 in http mode
  register: http_access
  ansible.builtin.uri:
    url: 'http://{{ url }}'
    follow_redirects: none
    method: GET
  failed_when: >-
    http_access.status != 301
    or http_access.location != "https://" + url
  loop: '{{ test_urls }}'
  loop_control:
    loop_var: url

- name: Check the that I can access the website
  ansible.builtin.uri:
    url: 'https://www.{{ network.domain }}/'
    return_content: true
