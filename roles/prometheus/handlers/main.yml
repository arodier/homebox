---

- name: Activate AppArmor profile
  # possible ambiguous replacement: command : ansible.builtin.command | community.ciscosmb.command | community.routeros.command
  ansible.builtin.command: 'aa-enforce usr.sbin.nginx'

- name: Restart AppArmor service
  systemd:
    name: apparmor
    state: restarted
    no_block: true

- name: Test nginx config
  ansible.builtin.shell: nginx -t
  changed_when: false

- name: Restart nginx
  systemd:
    name: nginx
    state: restarted
    no_block: true

- name: Restart Prometheus
  systemd:
    name: prometheus
    state: restarted
    no_block: true

- name: Restart Prometheus node exporter
  systemd:
    name: prometheus-node-exporter
    state: restarted
    no_block: true

- name: Restart Prometheus blackbox exporter
  systemd:
    name: prometheus-blackbox-exporter
    state: restarted
    no_block: true

- name: Restart Prometheus alert manager
  systemd:
    name: prometheus-alertmanager
    state: restarted
    no_block: true

- name: Restart Prometheus XMPP alerts
  systemd:
    name: prometheus-xmpp-alerts
    state: restarted
    no_block: true
