---

groups:
  - name: '[[ mp.name ]]_fs_recording'
    interval: '[[ mp.interval | default("60s") ]]'
    rules:
      - record: node_exporter:[[ mp.name ]]_fs:used
        expr: >-
          100 -
          100 * (node_filesystem_avail_bytes{mountpoint="[[ mp.path ]]"}
          / node_filesystem_size_bytes{mountpoint="[[ mp.path ]]"})

  - name: '[[ mp.name ]]_fs_alerting_rules'
    rules:
      - alert: '[[ mp.name ]] partition disk space'
        expr: node_exporter:[[ mp.name ]]_fs:used >= {{ mp.threshold | default(80) }}
        for: '[[ mp.for | default("5m") ]]'
        labels:
          severity: '[[ mp.severity | default("page") ]]'
        annotations:
          summary: '[[ mp.name ]] file system disk space monitoring'
          description: >-
            This alert monitors the available disk space on the [[ mp.name ]] file system.
            and raise an alert if the disk space is above
            {{ mp.threshold | default(80) }}% for five minutes.
            The current disk space usage is {{ $value | printf "%.1f" }}%.
