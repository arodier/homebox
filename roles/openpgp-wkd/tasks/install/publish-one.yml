---

# Expects :
# - `well_known_dir`: base directory for the `hu` directory and `policy` file
# - `public_keys`: the list of public keys with ascii armor with corresponding
#                  uid and wkd_hash

- name: Create the directories for the openpgp keys
  file:
    path: '{{ well_known_dir }}/hu'
    state: directory

- name: Create an empty policy file as required
  file:
    path: '{{ well_known_dir }}/policy'
    state: touch
    modification_time: preserve
    access_time: preserve

- name: Loop over wkd hashes for the direct method
  set_fact:
    encoded_uid: '{{ key_info.uid | wkd_hash }}'

- name: Loop over wkd hashes for the direct method
  copy:
    content: '{{ key_info.public_key }}'
    dest: '{{ well_known_dir }}/hu/{{ encoded_uid }}'

- name: Display encoded value
  debug:
    verbosity: 2
    msg: 'Encoded "{{ key_info.uid }}" to "{{ encoded_uid }}" using wkdhash.'
