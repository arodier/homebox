<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="André Rodier">
  
  <title>Email configuration - homebox installation</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link href="../css/extra.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Email configuration";
    var mkdocs_page_input_path = "email-configuration.md";
    var mkdocs_page_url = "/email-configuration/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> homebox installation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../features/">Features</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../prerequisites/">Before the installation</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../preseed/">Debian OS installation</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../installation/">Homebox Installation</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Email configuration</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#automatic-clients-configuration">Automatic clients configuration</a></li>
                
            
                <li class="toctree-l3"><a href="#antivirus-configuration">Antivirus configuration</a></li>
                
            
                <li class="toctree-l3"><a href="#master-users">Master users</a></li>
                
            
                <li class="toctree-l3"><a href="#import-external-accounts">Import external accounts</a></li>
                
            
                <li class="toctree-l3"><a href="#advanced-features">Advanced features</a></li>
                
                    <li><a class="toctree-l4" href="#international-email-addresses">International email addresses</a></li>
                
                    <li><a class="toctree-l4" href="#email-addresses-extensions">Email addresses extensions</a></li>
                
                    <li><a class="toctree-l4" href="#custom-postfix-options">Custom Postfix options</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../webmail-roundcube/">Roundcube Webmail</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../groupware-sogo/">Sogo Groupware</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../email-access-monitoring/">Email access monitoring</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../antispam-rspamd/">Antispam configuration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../jabber-configuration/">Jabber configuration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../gogs-configuration/">Gogs configuration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../tor-privoxy-configuration/">Tor / privoxy configuration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../firewall-configuration/">Firewall configuration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../security-configuration/">Security configuration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../transmission-configuration/">Transmission configuration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../bind-configuration/">DNS Server configuration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../external-accounts/">External accounts</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../backup-home/">Backup your home folders</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../backup-restore/">Backup restoration</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../deployment-backup/">Backup your deployment</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../backup-server/">Backup server</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../zabbix/">Monitoring with Zabbix</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../maintenance/">Maintenance</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../development/">Testing and development</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../codeofconduct/">Code of conduct</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">homebox installation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Email configuration</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/progmaticltd/homebox/" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="automatic-clients-configuration">Automatic clients configuration</h1>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">mail_default</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">max_attachment_size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">25</span>   <span class="c1"># In megabytes</span>
  <span class="l l-Scalar l-Scalar-Plain">autoconfig</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>          <span class="c1"># Support Thunderbird automatic configuration</span>
  <span class="l l-Scalar l-Scalar-Plain">autodiscover</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>       <span class="c1"># Support MS Outlook automatic configuration (uses https)</span>
</pre></div>


<p>The option “autoconfig” allows your users to automatically configure their email parameters in <em>Mozilla Thunderbird</em>.</p>
<p>For instance, for the domain homebox.space, this will create a subdomain entry &ldquo;autoconfig.homebox.space&rdquo;</p>
<p>The option “autodiscover” allows your _Microsoft Outlook_users to automatically configure their email parameters. For
instance, for the domain homebox.space, this will create a subdomain entry &ldquo;autodiscover.homebox.space&rdquo;, accessible in
https, with a dedicated SSL certificate.</p>
<h1 id="antivirus-configuration">Antivirus configuration</h1>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">mail</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">...</span>
  <span class="l l-Scalar l-Scalar-Plain">antivirus</span><span class="p p-Indicator">:</span>                <span class="c1"># Check inbound and outbound emails for viruses</span>
    <span class="l l-Scalar l-Scalar-Plain">port</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">34000</span>             <span class="c1"># port to use for the antivirus daemon</span>
    <span class="l l-Scalar l-Scalar-Plain">active</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>            <span class="c1"># or false</span>
    <span class="l l-Scalar l-Scalar-Plain">action</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">drop</span>            <span class="c1"># Action to do when a virus is found in an email: bounce or drop</span>
                            <span class="c1"># be careful, bouncing external emails is a way to expose clamav usage</span>
    <span class="l l-Scalar l-Scalar-Plain">quarantine</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>         <span class="c1"># Place emails with a virus in quarantine, for further analysis</span>
    <span class="l l-Scalar l-Scalar-Plain">use_proxy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>        <span class="c1"># use tor / privoxy to dowload updates</span>
</pre></div>


<p>The platform can scan the emails received and sent, using <a href="https://clamav.net/">ClamAV</a>.</p>
<ul>
<li>You can disable the antivirus, by setting ‘active’ to false.</li>
<li>By default, emails with viruses are dropped silently, but you can set the action to ‘bounce’ if you wish to send an
  alert to the external senders.</li>
</ul>
<h1 id="master-users">Master users</h1>
<p>As Dovecot is used, it is possible to activate the &ldquo;impersonate&rdquo; or <em>master users</em> feature.  If you activate this
option, a <em>master</em> user will be created, allowing you to logon as any user.  The RoundCube impersonate plugin will be
activated as well.</p>
<p>Example with this configuration:</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">mail</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">…</span>
  <span class="l l-Scalar l-Scalar-Plain">impersonate</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">active</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">master</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">master</span>
    <span class="l l-Scalar l-Scalar-Plain">separator</span><span class="p p-Indicator">:</span> <span class="s">&#39;/&#39;</span>
</pre></div>


<p>If one user is called john, you can now login as john, using &ldquo;john/master&rdquo; and the master user password.</p>
<p>The password is automatically generated, and saved in the backup folder, in the file <strong>ldap/master.pwd</strong>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Every time the <em>master account</em> feature is used, a notice is sent to the original user, both by email and with
Jabber when installed.</p>
</div>
<h1 id="import-external-accounts">Import external accounts</h1>
<p>There are two ways of importing other emails. The easiest way is to use SOGo web interface. In this case, you will see
your other account emails in the web interface.</p>
<p>The other option is to use the yaml configuration file. The advantage is once this set up, external emails will be
automatically imported in your main account, regardless of the client you are using.</p>
<p>This is detailed in the section <a href="../external-accounts/">External accounts</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>One important thing to know is that this feature automatically creates a Dovecot <em>master user</em>, that will be used to
import the emails into the folders. However, this master user can only log in from the system itself, so there is no
danger of using the import user to access someone&rsquo;s emails. If someone tried the use the import account, the
connection would be refused, and an email alert will be sent to the postmaster.</p>
</div>
<h1 id="advanced-features">Advanced features</h1>
<p>When this flag is set to true, some advanced features will be
available, and a more recent version of Dovecot will be installed,
from the Debian backports repository.</p>
<h2 id="international-email-addresses">International email addresses</h2>
<p>Your main email address should be without ASCII characters only, but the aliases can contains accents,
for instance:</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">users</span><span class="p p-Indicator">:</span>
<span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">uid</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">andre</span>
  <span class="l l-Scalar l-Scalar-Plain">cn</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">André Rodier</span>
  <span class="l l-Scalar l-Scalar-Plain">first_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">André</span>
  <span class="l l-Scalar l-Scalar-Plain">last_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Rodier</span>
  <span class="l l-Scalar l-Scalar-Plain">mail</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">andre@homebox.space</span>
  <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Xhlojwei$u987%</span>
  <span class="l l-Scalar l-Scalar-Plain">aliases</span><span class="p p-Indicator">:</span>
<span class="hll">    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">andré.rodier@homebox.space</span>
</span>    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">andré@homebox.space</span>
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is possible if all the software and the platforms involved support it. Not all major email providers are supporting
this, Yahoo mail, for instance, does not even let you send an email with an internationalised user name.
This feature is not entirely tested yet, but is working so far between two homebox servers and SOGo or evolution.</p>
</div>
<h2 id="email-addresses-extensions">Email addresses extensions</h2>
<p>The flag &ldquo;recipient_delimiter&rdquo; let you send an email directly to a folder, by using a character to separate the email
address and the folder name with a character. The most common character is &ldquo;+&rdquo; although you can use any character.</p>
<p>Example with this configuration:</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">mail</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">recipient_delimiter</span><span class="p p-Indicator">:</span> <span class="s">&#39;+&#39;</span>
</pre></div>


<p>For a user with an email address like <strong>john@homebox.space</strong>, any email sent to <strong>john+lists@homebox.space</strong> will be
stored in the folder &ldquo;lists&rdquo;.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the folder does not exists, the email will be placed in your INBOX.</p>
</div>
<h2 id="custom-postfix-options">Custom Postfix options</h2>
<p>You can add any compatible postfix configuration, by defining the variable &ldquo;extra-settings&rdquo; into your system.yml
file. In this case, anything this variable contains will be added into the main.cf file.  The <a href="http://www.postfix.org/documentation.html">postfix
documentation</a> should help you.</p>
<p>Example: You want to send a copy of any email received to another external address, and allow the VRFY command:</p>
<div class="codehilite"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">mail</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">postfix</span><span class="p p-Indicator">:</span>
<span class="hll">    <span class="l l-Scalar l-Scalar-Plain">extra_settings</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
</span><span class="hll">      <span class="no">always_bcc = spyme@fbi.gov.us</span>
</span><span class="hll">      <span class="no">disable_vrfy_command = no</span>
</span></pre></div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../webmail-roundcube/" class="btn btn-neutral float-right" title="Roundcube Webmail">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../installation/" class="btn btn-neutral" title="Homebox Installation"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Creative Commons Attribution-ShareAlike 4.0 International License</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/progmaticltd/homebox/" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../installation/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../webmail-roundcube/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
